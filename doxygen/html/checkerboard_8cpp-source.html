<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>pbrt: checkerboard.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>checkerboard.cpp</h1><a href="checkerboard_8cpp.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 
00002 <span class="comment">/*</span>
00003 <span class="comment"> * pbrt source code Copyright(c) 1998-2005 Matt Pharr and Greg Humphreys</span>
00004 <span class="comment"> *</span>
00005 <span class="comment"> * All Rights Reserved.</span>
00006 <span class="comment"> * For educational use only; commercial use expressly forbidden.</span>
00007 <span class="comment"> * NO WARRANTY, express or implied, for this software.</span>
00008 <span class="comment"> * (See file License.txt for complete license)</span>
00009 <span class="comment"> */</span>
00010 
00011 <span class="comment">// checkerboard.cpp*</span>
00012 <span class="preprocessor">#include "<a class="code" href="pbrt_8h.html">pbrt.h</a>"</span>
00013 <span class="preprocessor">#include "<a class="code" href="texture_8h.html">texture.h</a>"</span>
00014 <span class="preprocessor">#include "<a class="code" href="paramset_8h.html">paramset.h</a>"</span>
00015 <span class="preprocessor">#include "<a class="code" href="sampling_8h.html">sampling.h</a>"</span>
00016 <span class="preprocessor">#include "<a class="code" href="shape_8h.html">shape.h</a>"</span>
00017 <span class="comment">// Checkerboard2D Private Types</span>
00018 <span class="keyword">enum</span> { <a class="code" href="checkerboard_8cpp.html#a10a5">NONE</a>, <a class="code" href="checkerboard_8cpp.html#a10a6">SUPERSAMPLE</a>, <a class="code" href="checkerboard_8cpp.html#a10a7">CLOSEDFORM</a> } <a class="code" href="checkerboard_8cpp.html#a4">aaMethod</a>;
00019 <span class="comment">// CheckerboardTexture Declarations</span>
<a name="l00020"></a><a class="code" href="classCheckerboard2D.html">00020</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keyword">class </span><a class="code" href="classCheckerboard2D.html">Checkerboard2D</a> : <span class="keyword">public</span> <a class="code" href="classTexture.html">Texture</a>&lt;T&gt; {
00021 <span class="keyword">public</span>:
00022         <span class="comment">// Checkerboard2D Public Methods</span>
<a name="l00023"></a><a class="code" href="classCheckerboard2D.html#a0">00023</a>         <a class="code" href="classCheckerboard2D.html">Checkerboard2D</a>(<a class="code" href="classTextureMapping2D.html">TextureMapping2D</a> *m,
00024                        <a class="code" href="classReference.html">Reference</a>&lt;<a class="code" href="classTexture.html">Texture&lt;T&gt;</a> &gt; c1,
00025                                <a class="code" href="classReference.html">Reference</a>&lt;<a class="code" href="classTexture.html">Texture&lt;T&gt;</a> &gt; c2,
00026                                    <span class="keyword">const</span> string &amp;aa) {
00027                 <a class="code" href="classCheckerboard2D.html#r2">mapping</a> = m;
00028                 <a class="code" href="classCheckerboard2D.html#r0">tex1</a> = c1;
00029                 <a class="code" href="classCheckerboard2D.html#r1">tex2</a> = c2;
00030                 <span class="comment">// Select anti-aliasing method for _Checkerboard2D_</span>
00031                 <span class="keywordflow">if</span> (aa == <span class="stringliteral">"none"</span>) <a class="code" href="checkerboard_8cpp.html#a4">aaMethod</a> = <a class="code" href="checkerboard_8cpp.html#a10a5">NONE</a>;
00032                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (aa == <span class="stringliteral">"supersample"</span>) <a class="code" href="checkerboard_8cpp.html#a4">aaMethod</a> = <a class="code" href="checkerboard_8cpp.html#a10a6">SUPERSAMPLE</a>;
00033                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (aa == <span class="stringliteral">"closedform"</span>) <a class="code" href="checkerboard_8cpp.html#a4">aaMethod</a> = <a class="code" href="checkerboard_8cpp.html#a10a7">CLOSEDFORM</a>;
00034                 <span class="keywordflow">else</span> {
00035                         <a class="code" href="util_8cpp.html#a15">Warning</a>(<span class="stringliteral">"Anti-aliasing mode \"%s\" not understood "</span>
00036                                 <span class="stringliteral">"by Checkerboard2D, defaulting"</span>
00037                                 <span class="stringliteral">"to \"supersample\""</span>, aa.c_str());
00038                         <a class="code" href="checkerboard_8cpp.html#a4">aaMethod</a> = <a class="code" href="checkerboard_8cpp.html#a10a6">SUPERSAMPLE</a>;
00039                 }
00040         }
<a name="l00041"></a><a class="code" href="classCheckerboard2D.html#a1">00041</a>         <a class="code" href="classCheckerboard2D.html#a1">~Checkerboard2D</a>() {
00042                 <span class="keyword">delete</span> <a class="code" href="classCheckerboard2D.html#r2">mapping</a>;
00043         }
<a name="l00044"></a><a class="code" href="classCheckerboard2D.html#a2">00044</a>         T <a class="code" href="classCheckerboard2D.html#a2">Evaluate</a>(<span class="keyword">const</span> <a class="code" href="structDifferentialGeometry.html">DifferentialGeometry</a> &amp;dg)<span class="keyword"> const </span>{
00045                 <span class="keywordtype">float</span> s, t, dsdx, dtdx, dsdy, dtdy;
00046                 <a class="code" href="classCheckerboard2D.html#r2">mapping</a>-&gt;<a class="code" href="classTextureMapping2D.html#a1">Map</a>(dg, &amp;s, &amp;t, &amp;dsdx, &amp;dtdx, &amp;dsdy, &amp;dtdy);
00047                 <span class="keywordflow">if</span> (<a class="code" href="checkerboard_8cpp.html#a4">aaMethod</a> == <a class="code" href="checkerboard_8cpp.html#a10a7">CLOSEDFORM</a>) {
00048                         <span class="comment">// Compute closed form box-filtered _Checkerboard2D_ value</span>
00049                         <span class="comment">// Evaluate single check if filter is entirely inside one of them</span>
00050                         <span class="keywordtype">float</span> ds = max(fabsf(dsdx), fabsf(dsdy));
00051                         <span class="keywordtype">float</span> dt = max(fabsf(dtdx), fabsf(dtdy));
00052                         <span class="keywordtype">float</span> s0 = s - ds, s1 = s + ds;
00053                         <span class="keywordtype">float</span> t0 = t - dt, t1 = t + dt;
00054                         <span class="keywordflow">if</span> (<a class="code" href="pbrt_8h.html#a106">Floor2Int</a>(s0) == <a class="code" href="pbrt_8h.html#a106">Floor2Int</a>(s1) &amp;&amp;
00055                                 <a class="code" href="pbrt_8h.html#a106">Floor2Int</a>(t0) == <a class="code" href="pbrt_8h.html#a106">Floor2Int</a>(t1)) {
00056                                 <span class="comment">// Point sample _Checkerboard2D_</span>
00057                                 <span class="keywordflow">if</span> ((<a class="code" href="pbrt_8h.html#a106">Floor2Int</a>(s) + <a class="code" href="pbrt_8h.html#a106">Floor2Int</a>(t)) % 2 == 0)
00058                                         <span class="keywordflow">return</span> <a class="code" href="classCheckerboard2D.html#r0">tex1</a>-&gt;Evaluate(dg);
00059                                 <span class="keywordflow">return</span> <a class="code" href="classCheckerboard2D.html#r1">tex2</a>-&gt;Evaluate(dg);
00060                         }
00061                         <span class="comment">// Apply box-filter to checkerboard region</span>
00062 <span class="preprocessor">                        #define BUMPINT(x) \</span>
00063 <span class="preprocessor">                                (Floor2Int((x)/2) + \</span>
00064 <span class="preprocessor">                                 2.f * max((x/2)-Floor2Int(x/2) - .5f, 0.f))</span>
00065 <span class="preprocessor"></span>                        <span class="keywordtype">float</span> sint = (<a class="code" href="checkerboard_8cpp.html#a0">BUMPINT</a>(s1) - <a class="code" href="checkerboard_8cpp.html#a0">BUMPINT</a>(s0)) / (2.f * ds);
00066                         <span class="keywordtype">float</span> tint = (<a class="code" href="checkerboard_8cpp.html#a0">BUMPINT</a>(t1) - <a class="code" href="checkerboard_8cpp.html#a0">BUMPINT</a>(t0)) / (2.f * dt);
00067                         <span class="keywordtype">float</span> area2 = sint + tint - 2.f * sint * tint;
00068                         <span class="keywordflow">if</span> (ds &gt; 1.f || dt &gt; 1.f)
00069                                 area2 = .5f;
00070                         <span class="keywordflow">return</span> (1.f - area2) * <a class="code" href="classCheckerboard2D.html#r0">tex1</a>-&gt;Evaluate(dg) +
00071                                 area2 * <a class="code" href="classCheckerboard2D.html#r1">tex2</a>-&gt;Evaluate(dg);
00072                 }
00073                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="checkerboard_8cpp.html#a4">aaMethod</a> == <a class="code" href="checkerboard_8cpp.html#a10a6">SUPERSAMPLE</a>) {
00074                         <span class="comment">// Supersample _Checkerboard2D_</span>
00075 <span class="preprocessor">                        #define SQRT_SAMPLES 4</span>
00076 <span class="preprocessor"></span><span class="preprocessor">                        #define N_SAMPLES (SQRT_SAMPLES * SQRT_SAMPLES)</span>
00077 <span class="preprocessor"></span>                        <span class="keywordtype">float</span> samples[2*<a class="code" href="checkerboard_8cpp.html#a2">N_SAMPLES</a>];
00078                         <a class="code" href="sampling_8h.html#a1">StratifiedSample2D</a>(samples, <a class="code" href="checkerboard_8cpp.html#a1">SQRT_SAMPLES</a>, <a class="code" href="checkerboard_8cpp.html#a1">SQRT_SAMPLES</a>);
00079                         T value = 0.;
00080                         <span class="keywordtype">float</span> filterSum = 0.;
00081                         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="checkerboard_8cpp.html#a2">N_SAMPLES</a>; ++i) {
00082                                 <span class="comment">// Compute new differential geometry for supersample location</span>
00083                                 <span class="keywordtype">float</span> dx = samples[2*i]   - 0.5f;
00084                                 <span class="keywordtype">float</span> dy = samples[2*i+1] - 0.5f;
00085                                 <a class="code" href="structDifferentialGeometry.html">DifferentialGeometry</a> dgs = dg;
00086                                 dgs.<a class="code" href="structDifferentialGeometry.html#o0">p</a> += dx * dgs.<a class="code" href="structDifferentialGeometry.html#o9">dpdx</a> + dy * dgs.<a class="code" href="structDifferentialGeometry.html#o10">dpdy</a>;
00087                                 dgs.<a class="code" href="structDifferentialGeometry.html#o2">u</a> += dx * dgs.<a class="code" href="structDifferentialGeometry.html#o11">dudx</a> + dy * dgs.<a class="code" href="structDifferentialGeometry.html#o13">dudy</a>;
00088                                 dgs.<a class="code" href="structDifferentialGeometry.html#o3">v</a> += dx * dgs.<a class="code" href="structDifferentialGeometry.html#o12">dvdx</a> + dy * dgs.<a class="code" href="structDifferentialGeometry.html#o14">dvdy</a>;
00089                                 dgs.<a class="code" href="structDifferentialGeometry.html#o11">dudx</a> /= <a class="code" href="checkerboard_8cpp.html#a2">N_SAMPLES</a>;
00090                                 dgs.<a class="code" href="structDifferentialGeometry.html#o13">dudy</a> /= <a class="code" href="checkerboard_8cpp.html#a2">N_SAMPLES</a>;
00091                                 dgs.<a class="code" href="structDifferentialGeometry.html#o12">dvdx</a> /= <a class="code" href="checkerboard_8cpp.html#a2">N_SAMPLES</a>;
00092                                 dgs.<a class="code" href="structDifferentialGeometry.html#o14">dvdy</a> /= <a class="code" href="checkerboard_8cpp.html#a2">N_SAMPLES</a>;
00093                                 <span class="comment">// Compute $(s,t)$ for supersample and evaluate sub-texture</span>
00094                                 <span class="keywordtype">float</span> ss, ts, dsdxs, dtdxs, dsdys, dtdys;
00095                                 <a class="code" href="classCheckerboard2D.html#r2">mapping</a>-&gt;<a class="code" href="classTextureMapping2D.html#a1">Map</a>(dgs, &amp;ss, &amp;ts, &amp;dsdxs, &amp;dtdxs, &amp;dsdys, &amp;dtdys);
00096                                 <span class="keywordtype">float</span> wt = expf(-2.f * (dx*dx + dy*dy));
00097                                 filterSum += wt;
00098                                 <span class="keywordflow">if</span> ((<a class="code" href="pbrt_8h.html#a106">Floor2Int</a>(ss) + <a class="code" href="pbrt_8h.html#a106">Floor2Int</a>(ts)) % 2 == 0)
00099                                         value += wt * <a class="code" href="classCheckerboard2D.html#r0">tex1</a>-&gt;Evaluate(dgs);
00100                                 <span class="keywordflow">else</span>
00101                                         value += wt * <a class="code" href="classCheckerboard2D.html#r1">tex2</a>-&gt;Evaluate(dgs);
00102                         }
00103                         <span class="keywordflow">return</span> value / filterSum;
00104 <span class="preprocessor">                        #undef N_SAMPLES // NOBOOK</span>
00105 <span class="preprocessor"></span>                }
00106                 <span class="comment">// Point sample _Checkerboard2D_</span>
00107                 <span class="keywordflow">if</span> ((<a class="code" href="pbrt_8h.html#a106">Floor2Int</a>(s) + <a class="code" href="pbrt_8h.html#a106">Floor2Int</a>(t)) % 2 == 0)
00108                         <span class="keywordflow">return</span> <a class="code" href="classCheckerboard2D.html#r0">tex1</a>-&gt;Evaluate(dg);
00109                 <span class="keywordflow">return</span> <a class="code" href="classCheckerboard2D.html#r1">tex2</a>-&gt;Evaluate(dg);
00110         }
00111 <span class="keyword">private</span>:
00112         <span class="comment">// Checkerboard2D Private Data</span>
<a name="l00113"></a><a class="code" href="classCheckerboard2D.html#r1">00113</a>         <a class="code" href="classReference.html">Reference&lt;Texture&lt;T&gt;</a> &gt; <a class="code" href="classCheckerboard2D.html#r0">tex1</a>, <a class="code" href="classCheckerboard2D.html#r1">tex2</a>;
<a name="l00114"></a><a class="code" href="classCheckerboard2D.html#r2">00114</a>         <a class="code" href="classTextureMapping2D.html">TextureMapping2D</a> *<a class="code" href="classCheckerboard2D.html#r2">mapping</a>;
00115 };
<a name="l00116"></a><a class="code" href="classCheckerboard3D.html">00116</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keyword">class </span><a class="code" href="classCheckerboard3D.html">Checkerboard3D</a> : <span class="keyword">public</span> <a class="code" href="classTexture.html">Texture</a>&lt;T&gt; {
00117 <span class="keyword">public</span>:
00118         <span class="comment">// Checkerboard3D Public Methods</span>
<a name="l00119"></a><a class="code" href="classCheckerboard3D.html#a0">00119</a>         <a class="code" href="classCheckerboard3D.html">Checkerboard3D</a>(<a class="code" href="classTextureMapping3D.html">TextureMapping3D</a> *m,
00120                        <a class="code" href="classReference.html">Reference</a>&lt;<a class="code" href="classTexture.html">Texture&lt;T&gt;</a> &gt; c1,
00121                                <a class="code" href="classReference.html">Reference</a>&lt;<a class="code" href="classTexture.html">Texture&lt;T&gt;</a> &gt; c2) {
00122                 <a class="code" href="classCheckerboard3D.html#r2">mapping</a> = m;
00123                 <a class="code" href="classCheckerboard3D.html#r0">tex1</a> = c1;
00124                 <a class="code" href="classCheckerboard3D.html#r1">tex2</a> = c2;
00125         }
<a name="l00126"></a><a class="code" href="classCheckerboard3D.html#a1">00126</a>         T <a class="code" href="classCheckerboard3D.html#a1">Evaluate</a>(<span class="keyword">const</span> <a class="code" href="structDifferentialGeometry.html">DifferentialGeometry</a> &amp;dg)<span class="keyword"> const </span>{
00127                 <span class="comment">// Supersample _Checkerboard3D_</span>
00128 <span class="preprocessor">                #define N_SAMPLES 4</span>
00129 <span class="preprocessor"></span>                <span class="keywordtype">float</span> samples[2*<a class="code" href="checkerboard_8cpp.html#a2">N_SAMPLES</a>*<a class="code" href="checkerboard_8cpp.html#a2">N_SAMPLES</a>];
00130                 <a class="code" href="sampling_8h.html#a1">StratifiedSample2D</a>(samples, <a class="code" href="checkerboard_8cpp.html#a2">N_SAMPLES</a>, <a class="code" href="checkerboard_8cpp.html#a2">N_SAMPLES</a>);
00131                 T value = 0.;
00132                 <span class="keywordtype">float</span> filterSum = 0.;
00133                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="checkerboard_8cpp.html#a2">N_SAMPLES</a>*<a class="code" href="checkerboard_8cpp.html#a2">N_SAMPLES</a>; ++i) {
00134                         <span class="comment">// Compute new differential geometry for supersample location</span>
00135                         <span class="keywordtype">float</span> dx = samples[2*i]   - 0.5f;
00136                         <span class="keywordtype">float</span> dy = samples[2*i+1] - 0.5f;
00137                         <a class="code" href="structDifferentialGeometry.html">DifferentialGeometry</a> dgs = dg;
00138                         dgs.<a class="code" href="structDifferentialGeometry.html#o0">p</a> += dx * dgs.<a class="code" href="structDifferentialGeometry.html#o9">dpdx</a> + dy * dgs.<a class="code" href="structDifferentialGeometry.html#o10">dpdy</a>;
00139                         dgs.<a class="code" href="structDifferentialGeometry.html#o2">u</a> += dx * dgs.<a class="code" href="structDifferentialGeometry.html#o11">dudx</a> + dy * dgs.<a class="code" href="structDifferentialGeometry.html#o13">dudy</a>;
00140                         dgs.<a class="code" href="structDifferentialGeometry.html#o3">v</a> += dx * dgs.<a class="code" href="structDifferentialGeometry.html#o12">dvdx</a> + dy * dgs.<a class="code" href="structDifferentialGeometry.html#o14">dvdy</a>;
00141                         dgs.<a class="code" href="structDifferentialGeometry.html#o11">dudx</a> /= <a class="code" href="checkerboard_8cpp.html#a2">N_SAMPLES</a>;
00142                         dgs.<a class="code" href="structDifferentialGeometry.html#o13">dudy</a> /= <a class="code" href="checkerboard_8cpp.html#a2">N_SAMPLES</a>;
00143                         dgs.<a class="code" href="structDifferentialGeometry.html#o12">dvdx</a> /= <a class="code" href="checkerboard_8cpp.html#a2">N_SAMPLES</a>;
00144                         dgs.<a class="code" href="structDifferentialGeometry.html#o14">dvdy</a> /= <a class="code" href="checkerboard_8cpp.html#a2">N_SAMPLES</a>;
00145                         <span class="comment">// Compute 3D supersample position and evaluate sub-texture</span>
00146                         <a class="code" href="classVector.html">Vector</a> dPPdx, dPPdy;
00147                         <a class="code" href="classPoint.html">Point</a> PP = <a class="code" href="classCheckerboard3D.html#r2">mapping</a>-&gt;<a class="code" href="classTextureMapping3D.html#a1">Map</a>(dgs, &amp;dPPdx, &amp;dPPdy);
00148                         <span class="keywordtype">float</span> wt = expf(-2.f * (dx*dx + dy*dy));
00149                         filterSum += wt;
00150                         <span class="keywordflow">if</span> ((<a class="code" href="pbrt_8h.html#a106">Floor2Int</a>(PP.<a class="code" href="classPoint.html#o0">x</a>) + <a class="code" href="pbrt_8h.html#a106">Floor2Int</a>(PP.<a class="code" href="classPoint.html#o1">y</a>) + <a class="code" href="pbrt_8h.html#a106">Floor2Int</a>(PP.<a class="code" href="classPoint.html#o2">z</a>)) % 2 == 0)
00151                                 value += wt * <a class="code" href="classCheckerboard3D.html#r0">tex1</a>-&gt;Evaluate(dgs);
00152                         <span class="keywordflow">else</span>
00153                                 value += wt * <a class="code" href="classCheckerboard3D.html#r1">tex2</a>-&gt;Evaluate(dgs);
00154                 }
00155                 <span class="keywordflow">return</span> value / filterSum;
00156         }
00157 <span class="keyword">private</span>:
00158         <span class="comment">// Checkerboard3D Private Data</span>
<a name="l00159"></a><a class="code" href="classCheckerboard3D.html#r1">00159</a>         <a class="code" href="classReference.html">Reference&lt;Texture&lt;T&gt;</a> &gt; <a class="code" href="classCheckerboard3D.html#r0">tex1</a>, <a class="code" href="classCheckerboard3D.html#r1">tex2</a>;
<a name="l00160"></a><a class="code" href="classCheckerboard3D.html#r2">00160</a>         <a class="code" href="classTextureMapping3D.html">TextureMapping3D</a> *<a class="code" href="classCheckerboard3D.html#r2">mapping</a>;
00161 };
00162 <span class="comment">// CheckerboardTexture Method Definitions</span>
<a name="l00163"></a><a class="code" href="checkerboard_8cpp.html#a8">00163</a> <span class="keyword">extern</span> <span class="stringliteral">"C"</span> <a class="code" href="pbrt_8h.html#a2">DLLEXPORT</a> <a class="code" href="classTexture.html">Texture&lt;float&gt;</a> * <a class="code" href="wrinkled_8cpp.html#a0">CreateFloatTexture</a>(<span class="keyword">const</span> <a class="code" href="classTransform.html">Transform</a> &amp;tex2world,
00164                 <span class="keyword">const</span> <a class="code" href="classTextureParams.html">TextureParams</a> &amp;tp) {
00165         <span class="keywordtype">int</span> dim = tp.<a class="code" href="classTextureParams.html#a5">FindInt</a>(<span class="stringliteral">"dimension"</span>, 2);
00166         <span class="keywordflow">if</span> (dim != 2 &amp;&amp; dim != 3) {
00167                 <a class="code" href="util_8cpp.html#a16">Error</a>(<span class="stringliteral">"%d dimensional checkerboard texture not supported"</span>, dim);
00168                 <span class="keywordflow">return</span> NULL;
00169         }
00170         <a class="code" href="classReference.html">Reference&lt;Texture&lt;float&gt;</a> &gt; tex1 = tp.<a class="code" href="classTextureParams.html#a2">GetFloatTexture</a>(<span class="stringliteral">"tex1"</span>, 1.f);
00171         <a class="code" href="classReference.html">Reference&lt;Texture&lt;float&gt;</a> &gt; tex2 = tp.<a class="code" href="classTextureParams.html#a2">GetFloatTexture</a>(<span class="stringliteral">"tex2"</span>, 0.f);
00172         <span class="keywordflow">if</span> (dim == 2) {
00173                 <span class="comment">// Initialize 2D texture mapping _map_ from _tp_</span>
00174                 <a class="code" href="classTextureMapping2D.html">TextureMapping2D</a> *map = NULL;
00175                 string type = tp.<a class="code" href="classTextureParams.html#a4">FindString</a>(<span class="stringliteral">"mapping"</span>);
00176                 <span class="keywordflow">if</span> (type == <span class="stringliteral">""</span> || type == <span class="stringliteral">"uv"</span>) {
00177                         <span class="keywordtype">float</span> su = tp.<a class="code" href="classTextureParams.html#a3">FindFloat</a>(<span class="stringliteral">"uscale"</span>, 1.);
00178                         <span class="keywordtype">float</span> sv = tp.<a class="code" href="classTextureParams.html#a3">FindFloat</a>(<span class="stringliteral">"vscale"</span>, 1.);
00179                         <span class="keywordtype">float</span> du = tp.<a class="code" href="classTextureParams.html#a3">FindFloat</a>(<span class="stringliteral">"udelta"</span>, 0.);
00180                         <span class="keywordtype">float</span> dv = tp.<a class="code" href="classTextureParams.html#a3">FindFloat</a>(<span class="stringliteral">"vdelta"</span>, 0.);
00181                         map = <span class="keyword">new</span> <a class="code" href="classUVMapping2D.html">UVMapping2D</a>(su, sv, du, dv);
00182                 }
00183                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == <span class="stringliteral">"spherical"</span>) map = <span class="keyword">new</span> <a class="code" href="classSphericalMapping2D.html">SphericalMapping2D</a>(tex2world.<a class="code" href="classTransform.html#a4">GetInverse</a>());
00184                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == <span class="stringliteral">"cylindrical"</span>) map = <span class="keyword">new</span> <a class="code" href="classCylindricalMapping2D.html">CylindricalMapping2D</a>(tex2world.<a class="code" href="classTransform.html#a4">GetInverse</a>());
00185                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == <span class="stringliteral">"planar"</span>)
00186                         map = <span class="keyword">new</span> <a class="code" href="classPlanarMapping2D.html">PlanarMapping2D</a>(tp.<a class="code" href="classTextureParams.html#a8">FindVector</a>(<span class="stringliteral">"v1"</span>, <a class="code" href="classVector.html">Vector</a>(1,0,0)),
00187                                 tp.<a class="code" href="classTextureParams.html#a8">FindVector</a>(<span class="stringliteral">"v2"</span>, <a class="code" href="classVector.html">Vector</a>(0,1,0)),
00188                                 tp.<a class="code" href="classTextureParams.html#a3">FindFloat</a>(<span class="stringliteral">"udelta"</span>, 0.f), tp.<a class="code" href="classTextureParams.html#a3">FindFloat</a>(<span class="stringliteral">"vdelta"</span>, 0.f));
00189                 <span class="keywordflow">else</span> {
00190                         <a class="code" href="util_8cpp.html#a16">Error</a>(<span class="stringliteral">"2D texture mapping \"%s\" unknown"</span>, type.c_str());
00191                         map = <span class="keyword">new</span> <a class="code" href="classUVMapping2D.html">UVMapping2D</a>;
00192                 }
00193                 string aamode = tp.<a class="code" href="classTextureParams.html#a4">FindString</a>(<span class="stringliteral">"aamode"</span>);
00194                 <span class="keywordflow">if</span> (aamode == <span class="stringliteral">""</span>) aamode = <span class="stringliteral">"closedform"</span>;
00195                 <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classCheckerboard2D.html">Checkerboard2D&lt;float&gt;</a>(map, tex1, tex2, aamode);
00196         }
00197         <span class="keywordflow">else</span> {
00198                 <span class="comment">// Initialize 3D texture mapping _map_ from _tp_</span>
00199                 <a class="code" href="classTextureMapping3D.html">TextureMapping3D</a> *map = <span class="keyword">new</span> <a class="code" href="classIdentityMapping3D.html">IdentityMapping3D</a>(tex2world);
00200                 <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classCheckerboard3D.html">Checkerboard3D&lt;float&gt;</a>(map, tex1, tex2);
00201         }
00202 }
00203 
<a name="l00204"></a><a class="code" href="checkerboard_8cpp.html#a9">00204</a> <span class="keyword">extern</span> <span class="stringliteral">"C"</span> <a class="code" href="pbrt_8h.html#a2">DLLEXPORT</a> <a class="code" href="classTexture.html">Texture&lt;Spectrum&gt;</a> * <a class="code" href="wrinkled_8cpp.html#a1">CreateSpectrumTexture</a>(<span class="keyword">const</span> <a class="code" href="classTransform.html">Transform</a> &amp;tex2world,
00205                 <span class="keyword">const</span> <a class="code" href="classTextureParams.html">TextureParams</a> &amp;tp) {
00206         <span class="keywordtype">int</span> dim = tp.<a class="code" href="classTextureParams.html#a5">FindInt</a>(<span class="stringliteral">"dimension"</span>, 2);
00207         <span class="keywordflow">if</span> (dim != 2 &amp;&amp; dim != 3) {
00208                 <a class="code" href="util_8cpp.html#a16">Error</a>(<span class="stringliteral">"%d dimensional checkerboard texture not supported"</span>, dim);
00209                 <span class="keywordflow">return</span> NULL;
00210         }
00211         <a class="code" href="classReference.html">Reference&lt;Texture&lt;Spectrum&gt;</a> &gt; tex1 = tp.<a class="code" href="classTextureParams.html#a1">GetSpectrumTexture</a>(<span class="stringliteral">"tex1"</span>, 1.f);
00212         <a class="code" href="classReference.html">Reference&lt;Texture&lt;Spectrum&gt;</a> &gt; tex2 = tp.<a class="code" href="classTextureParams.html#a1">GetSpectrumTexture</a>(<span class="stringliteral">"tex2"</span>, 0.f);
00213         <span class="keywordflow">if</span> (dim == 2) {
00214                 <span class="comment">// Initialize 2D texture mapping _map_ from _tp_</span>
00215                 <a class="code" href="classTextureMapping2D.html">TextureMapping2D</a> *map = NULL;
00216                 string type = tp.<a class="code" href="classTextureParams.html#a4">FindString</a>(<span class="stringliteral">"mapping"</span>);
00217                 <span class="keywordflow">if</span> (type == <span class="stringliteral">""</span> || type == <span class="stringliteral">"uv"</span>) {
00218                         <span class="keywordtype">float</span> su = tp.<a class="code" href="classTextureParams.html#a3">FindFloat</a>(<span class="stringliteral">"uscale"</span>, 1.);
00219                         <span class="keywordtype">float</span> sv = tp.<a class="code" href="classTextureParams.html#a3">FindFloat</a>(<span class="stringliteral">"vscale"</span>, 1.);
00220                         <span class="keywordtype">float</span> du = tp.<a class="code" href="classTextureParams.html#a3">FindFloat</a>(<span class="stringliteral">"udelta"</span>, 0.);
00221                         <span class="keywordtype">float</span> dv = tp.<a class="code" href="classTextureParams.html#a3">FindFloat</a>(<span class="stringliteral">"vdelta"</span>, 0.);
00222                         map = <span class="keyword">new</span> <a class="code" href="classUVMapping2D.html">UVMapping2D</a>(su, sv, du, dv);
00223                 }
00224                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == <span class="stringliteral">"spherical"</span>) map = <span class="keyword">new</span> <a class="code" href="classSphericalMapping2D.html">SphericalMapping2D</a>(tex2world.<a class="code" href="classTransform.html#a4">GetInverse</a>());
00225                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == <span class="stringliteral">"cylindrical"</span>) map = <span class="keyword">new</span> <a class="code" href="classCylindricalMapping2D.html">CylindricalMapping2D</a>(tex2world.<a class="code" href="classTransform.html#a4">GetInverse</a>());
00226                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == <span class="stringliteral">"planar"</span>)
00227                         map = <span class="keyword">new</span> <a class="code" href="classPlanarMapping2D.html">PlanarMapping2D</a>(tp.<a class="code" href="classTextureParams.html#a8">FindVector</a>(<span class="stringliteral">"v1"</span>, <a class="code" href="classVector.html">Vector</a>(1,0,0)),
00228                                 tp.<a class="code" href="classTextureParams.html#a8">FindVector</a>(<span class="stringliteral">"v2"</span>, <a class="code" href="classVector.html">Vector</a>(0,1,0)),
00229                                 tp.<a class="code" href="classTextureParams.html#a3">FindFloat</a>(<span class="stringliteral">"udelta"</span>, 0.f), tp.<a class="code" href="classTextureParams.html#a3">FindFloat</a>(<span class="stringliteral">"vdelta"</span>, 0.f));
00230                 <span class="keywordflow">else</span> {
00231                         <a class="code" href="util_8cpp.html#a16">Error</a>(<span class="stringliteral">"2D texture mapping \"%s\" unknown"</span>, type.c_str());
00232                         map = <span class="keyword">new</span> <a class="code" href="classUVMapping2D.html">UVMapping2D</a>;
00233                 }
00234                 string aamode = tp.<a class="code" href="classTextureParams.html#a4">FindString</a>(<span class="stringliteral">"aamode"</span>);
00235                 <span class="keywordflow">if</span> (aamode == <span class="stringliteral">""</span>) aamode = <span class="stringliteral">"closedform"</span>;
00236                 <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classCheckerboard2D.html">Checkerboard2D&lt;Spectrum&gt;</a>(map, tex1, tex2, aamode);
00237         }
00238         <span class="keywordflow">else</span> {
00239                 <span class="comment">// Initialize 3D texture mapping _map_ from _tp_</span>
00240                 <a class="code" href="classTextureMapping3D.html">TextureMapping3D</a> *map = <span class="keyword">new</span> <a class="code" href="classIdentityMapping3D.html">IdentityMapping3D</a>(tex2world);
00241                 <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classCheckerboard3D.html">Checkerboard3D&lt;Spectrum&gt;</a>(map, tex1, tex2);
00242         }
00243 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Mon Apr 25 19:00:19 2005 for pbrt by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
