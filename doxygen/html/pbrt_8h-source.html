<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>pbrt: pbrt.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>pbrt.h</h1><a href="pbrt_8h.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 
00002 <span class="comment">/*</span>
00003 <span class="comment"> * pbrt source code Copyright(c) 1998-2005 Matt Pharr and Greg Humphreys</span>
00004 <span class="comment"> *</span>
00005 <span class="comment"> * All Rights Reserved.</span>
00006 <span class="comment"> * For educational use only; commercial use expressly forbidden.</span>
00007 <span class="comment"> * NO WARRANTY, express or implied, for this software.</span>
00008 <span class="comment"> * (See file License.txt for complete license)</span>
00009 <span class="comment"> */</span>
00010 
00011 <span class="preprocessor">#ifndef PBRT_PBRT_H</span>
00012 <span class="preprocessor"></span><span class="preprocessor">#define PBRT_PBRT_H</span>
00013 <span class="preprocessor"></span><span class="comment">// pbrt.h*</span>
00014 <span class="comment">// Global Include Files</span>
00015 <span class="preprocessor">#if !defined(__APPLE__)</span>
00016 <span class="preprocessor"></span><span class="preprocessor">#include &lt;malloc.h&gt;</span> <span class="comment">// for _alloca, memalign</span>
00017 <span class="preprocessor">#endif</span>
00018 <span class="preprocessor"></span><span class="preprocessor">#if !defined(WIN32) &amp;&amp; !defined(__APPLE__)</span>
00019 <span class="preprocessor"></span><span class="preprocessor">#include &lt;alloca.h&gt;</span>
00020 <span class="preprocessor">#endif</span>
00021 <span class="preprocessor"></span><span class="preprocessor">#ifdef __linux__</span>
00022 <span class="preprocessor"></span><span class="preprocessor">#include &lt;fpu_control.h&gt;</span>
00023 <span class="preprocessor">#endif</span>
00024 <span class="preprocessor"></span><span class="preprocessor">#ifdef WIN32</span>
00025 <span class="preprocessor"></span><span class="preprocessor">#include &lt;float.h&gt;</span>
00026 <span class="preprocessor">#endif</span>
00027 <span class="preprocessor"></span><span class="preprocessor">#include &lt;math.h&gt;</span>
00028 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00029"></a><a class="code" href="pbrt_8h.html#a32">00029</a> <span class="preprocessor">#define _GNU_SOURCE 1 //NOBOOK</span>
00030 <span class="preprocessor"></span><span class="preprocessor">#include &lt;stdio.h&gt;</span>
00031 <span class="preprocessor">#include &lt;string.h&gt;</span>
00032 <span class="preprocessor">#include &lt;string&gt;</span>
00033 <span class="keyword">using</span> std::string;
00034 <span class="preprocessor">#include &lt;vector&gt;</span>
00035 <span class="keyword">using</span> std::vector;
00036 <span class="preprocessor">#include &lt;iostream&gt;</span>
00037 <span class="keyword">using</span> std::ostream;
00038 <span class="preprocessor">#include &lt;algorithm&gt;</span>
00039 <span class="keyword">using</span> std::min;
00040 <span class="keyword">using</span> std::max;
00041 <span class="keyword">using</span> std::swap;
00042 <span class="keyword">using</span> std::sort;
00043 <span class="preprocessor">#ifdef WIN32</span>
00044 <span class="preprocessor"></span><span class="preprocessor">#define WIN32_LEAN_AND_MEAN</span>
00045 <span class="preprocessor"></span><span class="preprocessor">#include &lt;windows.h&gt;</span>
00046 <span class="preprocessor">#endif</span>
00047 <span class="preprocessor"></span><span class="preprocessor">#include &lt;assert.h&gt;</span>
00048 <span class="comment">// Platform-specific definitions</span>
00049 <span class="preprocessor">#if defined(WIN32)</span>
00050 <span class="preprocessor"></span><span class="preprocessor">#define memalign(a,b) _aligned_malloc(b, a)</span>
00051 <span class="preprocessor"></span><span class="preprocessor">#elif defined(__APPLE__)</span>
00052 <span class="preprocessor"></span><span class="preprocessor">#define memalign(a,b) valloc(b)</span>
00053 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00054 <span class="preprocessor"></span><span class="preprocessor">#ifdef sgi</span>
00055 <span class="preprocessor"></span><span class="preprocessor">#define for if (0) ; else for</span>
00056 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00057 <span class="preprocessor"></span><span class="preprocessor">#ifdef __APPLE__</span>
00058 <span class="preprocessor"></span><span class="preprocessor">#define powf pow</span>
00059 <span class="preprocessor"></span><span class="preprocessor">#define sinf sin</span>
00060 <span class="preprocessor"></span><span class="preprocessor">#define cosf cos</span>
00061 <span class="preprocessor"></span><span class="preprocessor">#define tanf tan</span>
00062 <span class="preprocessor"></span><span class="preprocessor">#define asinf asin</span>
00063 <span class="preprocessor"></span><span class="preprocessor">#define acosf acos</span>
00064 <span class="preprocessor"></span><span class="preprocessor">#define atanf atan</span>
00065 <span class="preprocessor"></span><span class="preprocessor">#define atan2f atan2</span>
00066 <span class="preprocessor"></span><span class="preprocessor">#define logf log</span>
00067 <span class="preprocessor"></span><span class="preprocessor">#define log10f log10</span>
00068 <span class="preprocessor"></span><span class="preprocessor">#define expf exp</span>
00069 <span class="preprocessor"></span><span class="preprocessor">#define sqrtf sqrt</span>
00070 <span class="preprocessor"></span><span class="preprocessor">#if __GNUC__ == 3</span>
00071 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="stringliteral">"C"</span> {
00072   <span class="keywordtype">int</span> isinf(<span class="keywordtype">double</span>);
00073   <span class="keywordtype">int</span> isnan(<span class="keywordtype">double</span>);
00074 }
00075 <span class="preprocessor">#endif // ONLY GCC 3</span>
00076 <span class="preprocessor"></span><span class="preprocessor">#endif // __APPLE__</span>
00077 <span class="preprocessor"></span>
00078 <span class="preprocessor">#ifdef WIN32</span>
00079 <span class="preprocessor"></span><span class="preprocessor">#pragma warning (disable: 4267 4251 4065 4102)</span>
00080 <span class="preprocessor"></span><span class="preprocessor">#endif // WIN32</span>
00081 <span class="preprocessor"></span><span class="preprocessor">#ifdef WIN32</span>
00082 <span class="preprocessor"></span><span class="preprocessor">#pragma warning( disable: 4190 )</span>
00083 <span class="preprocessor"></span><span class="comment">// extern "C" nonsense when returning a template</span>
00084 <span class="preprocessor">#endif</span>
00085 <span class="preprocessor"></span><span class="preprocessor">#ifdef WIN32</span>
00086 <span class="preprocessor"></span><span class="preprocessor">#ifdef CORE_SOURCE</span>
00087 <span class="preprocessor"></span><span class="preprocessor">#define COREDLL __declspec(dllexport)</span>
00088 <span class="preprocessor"></span><span class="preprocessor">#else</span>
00089 <span class="preprocessor"></span><span class="preprocessor">#define COREDLL __declspec(dllimport)</span>
00090 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00091 <span class="preprocessor"></span><span class="preprocessor">#define DLLEXPORT __declspec(dllexport)</span>
00092 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00093"></a><a class="code" href="pbrt_8h.html#a33">00093</a> <span class="preprocessor"></span><span class="preprocessor">#define COREDLL</span>
<a name="l00094"></a><a class="code" href="pbrt_8h.html#a34">00094</a> <span class="preprocessor"></span><span class="preprocessor">#define DLLEXPORT</span>
00095 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00096 <span class="preprocessor"></span><span class="preprocessor">#ifdef WIN32</span>
00097 <span class="preprocessor"></span><span class="preprocessor">#define PBRT_PATH_SEP ";"</span>
00098 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00099"></a><a class="code" href="pbrt_8h.html#a35">00099</a> <span class="preprocessor"></span><span class="preprocessor">#define PBRT_PATH_SEP ":"</span>
00100 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00101 <span class="preprocessor"></span><span class="preprocessor">#ifdef WIN32</span>
00102 <span class="preprocessor"></span><span class="preprocessor">#define isnan _isnan</span>
00103 <span class="preprocessor"></span><span class="preprocessor">#define isinf(f) (!_finite((f)))</span>
00104 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00105 <span class="preprocessor"></span><span class="comment">// Global Type Declarations</span>
<a name="l00106"></a><a class="code" href="pbrt_8h.html#a48">00106</a> <span class="keyword">typedef</span> <span class="keywordtype">double</span> <a class="code" href="pbrt_8h.html#a48">StatsCounterType</a>;
<a name="l00107"></a><a class="code" href="pbrt_8h.html#a49">00107</a> <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="pbrt_8h.html#a49">u_char</a>;
<a name="l00108"></a><a class="code" href="pbrt_8h.html#a50">00108</a> <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="pbrt_8h.html#a50">u_short</a>;
<a name="l00109"></a><a class="code" href="pbrt_8h.html#a51">00109</a> <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="pbrt_8h.html#a51">u_int</a>;
<a name="l00110"></a><a class="code" href="pbrt_8h.html#a52">00110</a> <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="pbrt_8h.html#a52">u_long</a>;
00111 <span class="comment">// Global Forward Declarations</span>
00112 <span class="keyword">class </span><a class="code" href="classTimer.html">Timer</a>;
00113 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T, <span class="keywordtype">int</span> logBlockSize = 2&gt; <span class="keyword">class </span><a class="code" href="classBlockedArray.html">BlockedArray</a>;
00114 <span class="keyword">struct </span><a class="code" href="structMatrix4x4.html">Matrix4x4</a>;
00115 <span class="keyword">class </span><a class="code" href="classParamSet.html">ParamSet</a>;
00116 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keyword">struct </span><a class="code" href="structParamSetItem.html">ParamSetItem</a>;
00117 <span class="keyword">class </span><a class="code" href="classTextureParams.html">TextureParams</a>;
00118 <span class="keyword">class </span><a class="code" href="classShape.html">Shape</a>;
00119 <span class="keyword">class </span><a class="code" href="classScene.html">Scene</a>;
00120 <span class="keyword">class </span><a class="code" href="classVector.html">Vector</a>;
00121 <span class="keyword">class </span><a class="code" href="classPoint.html">Point</a>;
00122 <span class="keyword">class </span><a class="code" href="classNormal.html">Normal</a>;
00123 <span class="keyword">class </span><a class="code" href="classRay.html">Ray</a>;
00124 <span class="keyword">class </span><a class="code" href="classRayDifferential.html">RayDifferential</a>;
00125 <span class="keyword">class </span><a class="code" href="classBBox.html">BBox</a>;
00126 <span class="keyword">class </span><a class="code" href="classTransform.html">Transform</a>;
00127 <span class="keyword">struct </span><a class="code" href="structDifferentialGeometry.html">DifferentialGeometry</a>;
00128 <span class="keyword">class </span><a class="code" href="classPrimitive.html">Primitive</a>;
00129 <span class="keyword">struct </span><a class="code" href="structIntersection.html">Intersection</a>;
00130 <span class="keyword">class </span><a class="code" href="classGeometricPrimitive.html">GeometricPrimitive</a>;
00131 <span class="keyword">class </span><a class="code" href="classSpectrum.html">Spectrum</a>;
00132 <span class="keyword">class </span><a class="code" href="classCamera.html">Camera</a>;
00133 <span class="keyword">class </span><a class="code" href="classProjectiveCamera.html">ProjectiveCamera</a>;
00134 <span class="keyword">class </span><a class="code" href="classSampler.html">Sampler</a>;
00135 <span class="keyword">struct </span><a class="code" href="structSample.html">Sample</a>;
<a name="l00136"></a><a class="code" href="pbrt_8h.html#a36">00136</a> <span class="preprocessor">#define BC_GRID_SIZE 40</span>
<a name="l00137"></a><a class="code" href="pbrt_8h.html#a53">00137</a> <span class="preprocessor"></span><span class="keyword">typedef</span> vector&lt;int&gt; <a class="code" href="pbrt_8h.html#a53">SampleGrid</a>[<a class="code" href="pbrt_8h.html#a4">BC_GRID_SIZE</a>][<a class="code" href="pbrt_8h.html#a4">BC_GRID_SIZE</a>];
<a name="l00138"></a><a class="code" href="pbrt_8h.html#a37">00138</a> <span class="preprocessor">#define GRID(v) (int((v) * BC_GRID_SIZE))</span>
00139 <span class="preprocessor"></span><span class="keyword">class </span><a class="code" href="classFilter.html">Filter</a>;
00140 <span class="keyword">class </span><a class="code" href="classFilm.html">Film</a>;
00141 <span class="keyword">class </span><a class="code" href="classToneMap.html">ToneMap</a>;
00142 <span class="keyword">class </span><a class="code" href="classBxDF.html">BxDF</a>;
00143 <span class="keyword">class </span>BRDF;
00144 <span class="keyword">class </span>BTDF;
00145 <span class="keyword">class </span><a class="code" href="classFresnel.html">Fresnel</a>;
00146 <span class="keyword">class </span><a class="code" href="classFresnelConductor.html">FresnelConductor</a>;
00147 <span class="keyword">class </span><a class="code" href="classFresnelDielectric.html">FresnelDielectric</a>;
00148 <span class="keyword">class </span><a class="code" href="classFresnelNoOp.html">FresnelNoOp</a>;
00149 <span class="keyword">class </span><a class="code" href="classSpecularReflection.html">SpecularReflection</a>;
00150 <span class="keyword">class </span><a class="code" href="classSpecularTransmission.html">SpecularTransmission</a>;
00151 <span class="keyword">class </span><a class="code" href="classLambertian.html">Lambertian</a>;
00152 <span class="keyword">class </span><a class="code" href="classOrenNayar.html">OrenNayar</a>;
00153 <span class="keyword">class </span><a class="code" href="classMicrofacet.html">Microfacet</a>;
00154 <span class="keyword">class </span><a class="code" href="classMicrofacetDistribution.html">MicrofacetDistribution</a>;
00155 <span class="keyword">class </span><a class="code" href="classBSDF.html">BSDF</a>;
00156 <span class="keyword">class </span><a class="code" href="classMaterial.html">Material</a>;
00157 <span class="keyword">class </span><a class="code" href="classTextureMapping2D.html">TextureMapping2D</a>;
00158 <span class="keyword">class </span><a class="code" href="classUVMapping2D.html">UVMapping2D</a>;
00159 <span class="keyword">class </span><a class="code" href="classSphericalMapping2D.html">SphericalMapping2D</a>;
00160 <span class="keyword">class </span><a class="code" href="classCylindricalMapping2D.html">CylindricalMapping2D</a>;
00161 <span class="keyword">class </span><a class="code" href="classPlanarMapping2D.html">PlanarMapping2D</a>;
00162 <span class="keyword">class </span><a class="code" href="classTextureMapping3D.html">TextureMapping3D</a>;
00163 <span class="keyword">class </span><a class="code" href="classIdentityMapping3D.html">IdentityMapping3D</a>;
00164 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keyword">class </span><a class="code" href="classTexture.html">Texture</a>;
00165 <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">float</span> <a class="code" href="texture_8cpp.html#a5">Noise</a>(<span class="keywordtype">float</span> x, <span class="keywordtype">float</span> y = .5f, <span class="keywordtype">float</span> z = .5f);
00166 <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">float</span> <a class="code" href="texture_8cpp.html#a5">Noise</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point</a> &amp;P);
00167 <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">float</span> <a class="code" href="texture_8cpp.html#a6">FBm</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point</a> &amp;P, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a> &amp;dpdx, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a> &amp;dpdy,
00168         <span class="keywordtype">float</span> omega, <span class="keywordtype">int</span> octaves);
00169 <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">float</span> <a class="code" href="texture_8cpp.html#a7">Turbulence</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point</a> &amp;P, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a> &amp;dpdx, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a> &amp;dpdy,
00170         <span class="keywordtype">float</span> omega, <span class="keywordtype">int</span> octaves);
00171 <span class="keyword">class </span><a class="code" href="classVolumeRegion.html">VolumeRegion</a>;
00172 <span class="keyword">class </span><a class="code" href="classLight.html">Light</a>;
00173 <span class="keyword">struct </span><a class="code" href="structVisibilityTester.html">VisibilityTester</a>;
00174 <span class="keyword">class </span><a class="code" href="classAreaLight.html">AreaLight</a>;
00175 <span class="keyword">class </span><a class="code" href="classShapeSet.html">ShapeSet</a>;
00176 <span class="keyword">class </span><a class="code" href="classSurfaceIntegrator.html">SurfaceIntegrator</a>;
00177 <span class="keyword">class </span><a class="code" href="classIntegrator.html">Integrator</a>;
00178 <span class="keyword">class </span><a class="code" href="classVolumeIntegrator.html">VolumeIntegrator</a>;
00179 <span class="comment">// Global Constants</span>
00180 <span class="preprocessor">#ifdef WIN32</span>
00181 <span class="preprocessor"></span><span class="preprocessor">#define alloca _alloca</span>
00182 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00183 <span class="preprocessor"></span><span class="preprocessor">#ifdef M_PI</span>
00184 <span class="preprocessor"></span><span class="preprocessor">#undef M_PI</span>
00185 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00186"></a><a class="code" href="pbrt_8h.html#a38">00186</a> <span class="preprocessor"></span><span class="preprocessor">#define M_PI           3.14159265358979323846f</span>
<a name="l00187"></a><a class="code" href="pbrt_8h.html#a39">00187</a> <span class="preprocessor"></span><span class="preprocessor">#define INV_PI  0.31830988618379067154f</span>
<a name="l00188"></a><a class="code" href="pbrt_8h.html#a40">00188</a> <span class="preprocessor"></span><span class="preprocessor">#define INV_TWOPI  0.15915494309189533577f</span>
00189 <span class="preprocessor"></span><span class="preprocessor">#ifndef INFINITY</span>
<a name="l00190"></a><a class="code" href="pbrt_8h.html#a41">00190</a> <span class="preprocessor"></span><span class="preprocessor">#define INFINITY FLT_MAX</span>
00191 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00192"></a><a class="code" href="pbrt_8h.html#a42">00192</a> <span class="preprocessor"></span><span class="preprocessor">#define PBRT_VERSION 1.02</span>
<a name="l00193"></a><a class="code" href="pbrt_8h.html#a43">00193</a> <span class="preprocessor"></span><span class="preprocessor">#define RAY_EPSILON 1e-3f</span>
<a name="l00194"></a><a class="code" href="pbrt_8h.html#a44">00194</a> <span class="preprocessor"></span><span class="preprocessor">#define COLOR_SAMPLES 3</span>
00195 <span class="preprocessor"></span><span class="comment">// Global Function Declarations</span>
00196 <span class="comment">// Setup printf format</span>
00197 <span class="preprocessor">#ifdef __GNUG__</span>
00198 <span class="preprocessor"></span><span class="preprocessor">#define PRINTF_FUNC __attribute__ \</span>
00199 <span class="preprocessor">        ((__format__ (__printf__, 1, 2)))</span>
00200 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00201"></a><a class="code" href="pbrt_8h.html#a45">00201</a> <span class="preprocessor"></span><span class="preprocessor">#define PRINTF_FUNC</span>
00202 <span class="preprocessor"></span><span class="preprocessor">#endif // __GNUG__</span>
00203 <span class="preprocessor"></span><span class="keyword">extern</span> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="util_8cpp.html#a14">Info</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *, ...) PRINTF_FUNC;
00204 extern COREDLL <span class="keywordtype">void</span> Warning(const <span class="keywordtype">char</span> *, ...) PRINTF_FUNC;
00205 extern COREDLL <span class="keywordtype">void</span> Error(const <span class="keywordtype">char</span> *, ...) PRINTF_FUNC;
00206 extern COREDLL <span class="keywordtype">void</span> Severe(const <span class="keywordtype">char</span> *, ...) PRINTF_FUNC;
00207 extern <span class="keywordtype">void</span> StatsPrint(FILE *dest);
00208 extern <span class="keywordtype">void</span> StatsCleanup();
00209 COREDLL <span class="keywordtype">void</span> *AllocAligned(size_t size);
00210 COREDLL <span class="keywordtype">void</span> FreeAligned(<span class="keywordtype">void</span> *);
00211 COREDLL <span class="keywordtype">bool</span> SolveLinearSystem2x2(const <span class="keywordtype">float</span> A[2][2], const <span class="keywordtype">float</span> B[2],
00212         <span class="keywordtype">float</span> x[2]);
00213 COREDLL <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> genrand_int32(<span class="keywordtype">void</span>);
00214 COREDLL extern <span class="keywordtype">float</span> genrand_real1(<span class="keywordtype">void</span>);
00215 COREDLL extern <span class="keywordtype">float</span> genrand_real2(<span class="keywordtype">void</span>);
00216 COREDLL <a class="code" href="classSpectrum.html">Spectrum</a> *ReadImage(const string &amp;name, <span class="keywordtype">int</span> *xSize,
00217         <span class="keywordtype">int</span> *ySize);
00218 COREDLL <span class="keywordtype">void</span> WriteRGBAImage(const string &amp;name,
00219         <span class="keywordtype">float</span> *pixels, <span class="keywordtype">float</span> *alpha, <span class="keywordtype">int</span> XRes, <span class="keywordtype">int</span> YRes,
00220         <span class="keywordtype">int</span> totalXRes, <span class="keywordtype">int</span> totalYRes, <span class="keywordtype">int</span> xOffset, <span class="keywordtype">int</span> yOffset);
00221 COREDLL <span class="keywordtype">void</span> pbrtInit();
00222 COREDLL <span class="keywordtype">void</span> pbrtCleanup();
00223 COREDLL <a class="code" href="classTransform.html">Transform</a> Translate(const <a class="code" href="classVector.html">Vector</a> &amp;delta);
00224 COREDLL <a class="code" href="classTransform.html">Transform</a> Scale(<span class="keywordtype">float</span> x, <span class="keywordtype">float</span> y, <span class="keywordtype">float</span> z);
00225 extern COREDLL <a class="code" href="classTransform.html">Transform</a> RotateX(<span class="keywordtype">float</span> angle);
00226 extern COREDLL <a class="code" href="classTransform.html">Transform</a> RotateY(<span class="keywordtype">float</span> angle);
00227 extern COREDLL <a class="code" href="classTransform.html">Transform</a> RotateZ(<span class="keywordtype">float</span> angle);
00228 extern COREDLL <a class="code" href="classTransform.html">Transform</a> Rotate(<span class="keywordtype">float</span> angle, const <a class="code" href="classVector.html">Vector</a> &amp;axis);
00229 extern COREDLL <a class="code" href="classTransform.html">Transform</a> LookAt(const <a class="code" href="classPoint.html">Point</a> &amp;pos, const <a class="code" href="classPoint.html">Point</a> &amp;look,
00230                         const <a class="code" href="classVector.html">Vector</a> &amp;up);
00231 COREDLL <a class="code" href="classTransform.html">Transform</a> Orthographic(<span class="keywordtype">float</span> znear, <span class="keywordtype">float</span> zfar);
00232 COREDLL
00233 <a class="code" href="classTransform.html">Transform</a> Perspective(<span class="keywordtype">float</span> fov, <span class="keywordtype">float</span> znear, <span class="keywordtype">float</span> zfar);
00234 COREDLL <a class="code" href="classSpectrum.html">Spectrum</a> FrDiel(<span class="keywordtype">float</span> cosi, <span class="keywordtype">float</span> cost,
00235                         const <a class="code" href="classSpectrum.html">Spectrum</a> &amp;etai,
00236                                                 const <a class="code" href="classSpectrum.html">Spectrum</a> &amp;etat);
00237 COREDLL <a class="code" href="classSpectrum.html">Spectrum</a> FrCond(<span class="keywordtype">float</span> cosi,
00238                         const <a class="code" href="classSpectrum.html">Spectrum</a> &amp;n,
00239                                                 const <a class="code" href="classSpectrum.html">Spectrum</a> &amp;k);
00240 COREDLL
00241         <a class="code" href="classSpectrum.html">Spectrum</a> FresnelApproxEta(const <a class="code" href="classSpectrum.html">Spectrum</a> &amp;intensity);
00242 COREDLL
00243         <a class="code" href="classSpectrum.html">Spectrum</a> FresnelApproxK(const <a class="code" href="classSpectrum.html">Spectrum</a> &amp;intensity);
00244 COREDLL <span class="keywordtype">float</span> Lanczos(<span class="keywordtype">float</span>, <span class="keywordtype">float</span> tau=2);
00245 COREDLL <a class="code" href="classSpectrum.html">Spectrum</a> EstimateDirect(const <a class="code" href="classScene.html">Scene</a> *scene, const <a class="code" href="classLight.html">Light</a> *light, const <a class="code" href="classPoint.html">Point</a> &amp;p,
00246         const <a class="code" href="classNormal.html">Normal</a> &amp;n, const <a class="code" href="classVector.html">Vector</a> &amp;wo, <a class="code" href="classBSDF.html">BSDF</a> *bsdf,
00247         const <a class="code" href="structSample.html">Sample</a> *sample, <span class="keywordtype">int</span> lightSamp, <span class="keywordtype">int</span> bsdfSamp,
00248         <span class="keywordtype">int</span> bsdfComponent, u_int sampleNum);
00249 extern COREDLL <span class="keywordtype">void</span> ComputeStep1dCDF(<span class="keywordtype">float</span> *f, <span class="keywordtype">int</span> nValues, <span class="keywordtype">float</span> *c, <span class="keywordtype">float</span> *cdf);
00250 extern COREDLL <span class="keywordtype">float</span> SampleStep1d(<span class="keywordtype">float</span> *f, <span class="keywordtype">float</span> *cdf, <span class="keywordtype">float</span> c,
00251         <span class="keywordtype">int</span> nSteps, <span class="keywordtype">float</span> u, <span class="keywordtype">float</span> *weight);
00252 COREDLL <span class="keywordtype">void</span> ConcentricSampleDisk(<span class="keywordtype">float</span> u1, <span class="keywordtype">float</span> u2, <span class="keywordtype">float</span> *dx, <span class="keywordtype">float</span> *dy);
00253 COREDLL <span class="keywordtype">void</span> UniformSampleTriangle(<span class="keywordtype">float</span> ud1, <span class="keywordtype">float</span> ud2, <span class="keywordtype">float</span> *u, <span class="keywordtype">float</span> *v);
00254 COREDLL <span class="keywordtype">bool</span> ParseFile(const <span class="keywordtype">char</span> *filename);
00255 <span class="comment">// Global Classes</span>
<a name="l00256"></a><a class="code" href="structProgressReporter.html">00256</a> struct COREDLL <a class="code" href="structProgressReporter.html">ProgressReporter</a> {
00257         <span class="comment">// ProgressReporter Public Methods</span>
00258         ProgressReporter(<span class="keywordtype">int</span> totalWork, <span class="keyword">const</span> string &amp;title,
00259                 <span class="keywordtype">int</span> barLength=58);
00260         ~ProgressReporter();
00261         <span class="keywordtype">void</span> Update(<span class="keywordtype">int</span> num = 1) <span class="keyword">const</span>;
00262         <span class="keywordtype">void</span> Done() <span class="keyword">const</span>;
00263         <span class="comment">// ProgressReporter Data</span>
<a name="l00264"></a><a class="code" href="structProgressReporter.html#o0">00264</a>         <span class="keyword">const</span> <span class="keywordtype">int</span> totalPlusses;
<a name="l00265"></a><a class="code" href="structProgressReporter.html#o1">00265</a>         <span class="keywordtype">float</span> frequency;
<a name="l00266"></a><a class="code" href="structProgressReporter.html#o2">00266</a>         <span class="keyword">mutable</span> <span class="keywordtype">float</span> count;
<a name="l00267"></a><a class="code" href="structProgressReporter.html#o3">00267</a>         <span class="keyword">mutable</span> <span class="keywordtype">int</span> plussesPrinted;
<a name="l00268"></a><a class="code" href="structProgressReporter.html#o4">00268</a>         <span class="keyword">mutable</span> <a class="code" href="classTimer.html">Timer</a> *timer;
<a name="l00269"></a><a class="code" href="structProgressReporter.html#o5">00269</a>         FILE *outFile;
<a name="l00270"></a><a class="code" href="structProgressReporter.html#o6">00270</a>         <span class="keywordtype">char</span> *buf;
<a name="l00271"></a><a class="code" href="structProgressReporter.html#o7">00271</a>         <span class="keyword">mutable</span> <span class="keywordtype">char</span> *curSpace;
00272 };
<a name="l00273"></a><a class="code" href="classStatsCounter.html">00273</a> <span class="keyword">class </span><a class="code" href="pbrt_8h.html#a1">COREDLL</a> StatsCounter {
00274 <span class="keyword">public</span>:
00275         <span class="comment">// StatsCounter Public Methods</span>
00276         StatsCounter(<span class="keyword">const</span> string &amp;category, <span class="keyword">const</span> string &amp;name);
<a name="l00277"></a><a class="code" href="classStatsCounter.html#a1">00277</a>         <span class="keywordtype">void</span> operator++() { ++num; }
<a name="l00278"></a><a class="code" href="classStatsCounter.html#a2">00278</a>         <span class="keywordtype">void</span> operator++(<span class="keywordtype">int</span>) { ++num; }
<a name="l00279"></a><a class="code" href="classStatsCounter.html#a3">00279</a>         <span class="keywordtype">void</span> Max(StatsCounterType val) { num = max(val, num); }
<a name="l00280"></a><a class="code" href="classStatsCounter.html#a4">00280</a>         <span class="keywordtype">void</span> Min(StatsCounterType val) { num = min(val, num); }
<a name="l00281"></a><a class="code" href="classStatsCounter.html#a5">00281</a>         operator double()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> (<span class="keywordtype">double</span>)num; }
00282 <span class="keyword">private</span>:
00283         <span class="comment">// StatsCounter Private Data</span>
<a name="l00284"></a><a class="code" href="classStatsCounter.html#r0">00284</a>         <a class="code" href="pbrt_8h.html#a48">StatsCounterType</a> num;
00285 };
<a name="l00286"></a><a class="code" href="classStatsRatio.html">00286</a> <span class="keyword">class </span><a class="code" href="pbrt_8h.html#a1">COREDLL</a> StatsRatio {
00287 <span class="keyword">public</span>:
00288         <span class="comment">// StatsRatio Public Methods</span>
00289         StatsRatio(<span class="keyword">const</span> string &amp;category, <span class="keyword">const</span> string &amp;name);
<a name="l00290"></a><a class="code" href="classStatsRatio.html#a1">00290</a>         <span class="keywordtype">void</span> Add(<span class="keywordtype">int</span> a, <span class="keywordtype">int</span> b) { na += a; nb += b; }
00291 <span class="keyword">private</span>:
00292         <span class="comment">// StatsRatio Private Data</span>
<a name="l00293"></a><a class="code" href="classStatsRatio.html#r1">00293</a>         <a class="code" href="pbrt_8h.html#a48">StatsCounterType</a> na, nb;
00294 };
<a name="l00295"></a><a class="code" href="classStatsPercentage.html">00295</a> <span class="keyword">class </span><a class="code" href="pbrt_8h.html#a1">COREDLL</a> StatsPercentage {
00296 <span class="keyword">public</span>:
00297         <span class="comment">// StatsPercentage Public Methods</span>
<a name="l00298"></a><a class="code" href="classStatsPercentage.html#a0">00298</a>         <span class="keywordtype">void</span> Add(<span class="keywordtype">int</span> a, <span class="keywordtype">int</span> b) { na += a; nb += b; }
00299         StatsPercentage(<span class="keyword">const</span> string &amp;category, <span class="keyword">const</span> string &amp;name);
00300 <span class="keyword">private</span>:
00301         <span class="comment">// StatsPercentage Private Data</span>
<a name="l00302"></a><a class="code" href="classStatsPercentage.html#r1">00302</a>         <a class="code" href="pbrt_8h.html#a48">StatsCounterType</a> na, nb;
00303 };
<a name="l00304"></a><a class="code" href="classReferenceCounted.html">00304</a> <span class="keyword">class </span><a class="code" href="pbrt_8h.html#a1">COREDLL</a> ReferenceCounted {
00305 <span class="keyword">public</span>:
<a name="l00306"></a><a class="code" href="classReferenceCounted.html#a0">00306</a>         ReferenceCounted() { nReferences = 0; }
<a name="l00307"></a><a class="code" href="classReferenceCounted.html#o0">00307</a>         <span class="keywordtype">int</span> nReferences;
00308 <span class="keyword">private</span>:
00309         ReferenceCounted(<span class="keyword">const</span> ReferenceCounted &amp;);
00310         ReferenceCounted &amp;operator=(<span class="keyword">const</span> ReferenceCounted &amp;);
00311 };
<a name="l00312"></a><a class="code" href="classReference.html">00312</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keyword">class </span><a class="code" href="classReference.html">Reference</a> {
00313 <span class="keyword">public</span>:
00314         <span class="comment">// Reference Public Methods</span>
<a name="l00315"></a><a class="code" href="classReference.html#a0">00315</a>         <a class="code" href="classReference.html">Reference</a>(T *p = NULL) {
00316                 ptr = p;
00317                 <span class="keywordflow">if</span> (ptr) ++ptr-&gt;nReferences;
00318         }
<a name="l00319"></a><a class="code" href="classReference.html#a1">00319</a>         <a class="code" href="classReference.html">Reference</a>(<span class="keyword">const</span> <a class="code" href="classReference.html">Reference&lt;T&gt;</a> &amp;r) {
00320                 ptr = r.<a class="code" href="classReference.html#r0">ptr</a>;
00321                 <span class="keywordflow">if</span> (ptr) ++ptr-&gt;nReferences;
00322         }
<a name="l00323"></a><a class="code" href="classReference.html#a2">00323</a>         <a class="code" href="classReference.html">Reference</a> &amp;operator=(<span class="keyword">const</span> <a class="code" href="classReference.html">Reference&lt;T&gt;</a> &amp;r) {
00324                 <span class="keywordflow">if</span> (r.<a class="code" href="classReference.html#r0">ptr</a>) r.<a class="code" href="classReference.html#r0">ptr</a>-&gt;nReferences++;
00325                 <span class="keywordflow">if</span> (ptr &amp;&amp; --ptr-&gt;nReferences == 0) <span class="keyword">delete</span> ptr;
00326                 ptr = r.<a class="code" href="classReference.html#r0">ptr</a>;
00327                 <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00328         }
<a name="l00329"></a><a class="code" href="classReference.html#a3">00329</a>         <a class="code" href="classReference.html">Reference</a> &amp;operator=(T *p) {
00330                 <span class="keywordflow">if</span> (p) p-&gt;nReferences++;
00331                 <span class="keywordflow">if</span> (ptr &amp;&amp; --ptr-&gt;nReferences == 0) <span class="keyword">delete</span> ptr;
00332                 ptr = p;
00333                 <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00334         }
<a name="l00335"></a><a class="code" href="classReference.html#a4">00335</a>         <a class="code" href="classReference.html#a4">~Reference</a>() {
00336                 <span class="keywordflow">if</span> (ptr &amp;&amp; --ptr-&gt;nReferences == 0)
00337                         <span class="keyword">delete</span> ptr;
00338         }
<a name="l00339"></a><a class="code" href="classReference.html#a5">00339</a>         T *<a class="code" href="classReference.html#a5">operator-&gt;</a>() { <span class="keywordflow">return</span> ptr; }
<a name="l00340"></a><a class="code" href="classReference.html#a6">00340</a>         <span class="keyword">const</span> T *<a class="code" href="classReference.html#a5">operator-&gt;</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> ptr; }
<a name="l00341"></a><a class="code" href="classReference.html#a7">00341</a>         <a class="code" href="classReference.html#a7">operator bool</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> ptr != NULL; }
<a name="l00342"></a><a class="code" href="classReference.html#a8">00342</a>         <span class="keywordtype">bool</span> operator&lt;(const Reference&lt;T&gt; &amp;t2) <span class="keyword">const</span> {
00343                 <span class="keywordflow">return</span> ptr &lt; t2.ptr;
00344         }
00345 <span class="keyword">private</span>:
<a name="l00346"></a><a class="code" href="classReference.html#r0">00346</a>         T *ptr;
00347 };
<a name="l00348"></a><a class="code" href="classObjectArena.html">00348</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keyword">class </span><a class="code" href="classObjectArena.html">ObjectArena</a> {
00349 <span class="keyword">public</span>:
00350         <span class="comment">// ObjectArena Public Methods</span>
<a name="l00351"></a><a class="code" href="classObjectArena.html#a0">00351</a>         <a class="code" href="classObjectArena.html#a0">ObjectArena</a>() {
00352                 nAvailable = 0;
00353         }
<a name="l00354"></a><a class="code" href="classObjectArena.html#a1">00354</a>         T *<a class="code" href="classObjectArena.html#a1">Alloc</a>() {
00355                 <span class="keywordflow">if</span> (nAvailable == 0) {
00356                         <span class="keywordtype">int</span> nAlloc = max((<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)16,
00357                                 (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)(65536/<span class="keyword">sizeof</span>(T)));
00358                         mem = (T *)<a class="code" href="util_8cpp.html#a28">AllocAligned</a>(nAlloc * <span class="keyword">sizeof</span>(T));
00359                         nAvailable = nAlloc;
00360                         toDelete.push_back(mem);
00361                 }
00362                 --nAvailable;
00363                 <span class="keywordflow">return</span> mem++;
00364         }
<a name="l00365"></a><a class="code" href="classObjectArena.html#a2">00365</a>         <a class="code" href="classObjectArena.html#a2">operator T *</a>() {
00366                 <span class="keywordflow">return</span> <a class="code" href="classObjectArena.html#a1">Alloc</a>();
00367         }
<a name="l00368"></a><a class="code" href="classObjectArena.html#a3">00368</a>         <a class="code" href="classObjectArena.html#a3">~ObjectArena</a>() { <a class="code" href="classObjectArena.html#a4">FreeAll</a>(); }
<a name="l00369"></a><a class="code" href="classObjectArena.html#a4">00369</a>         <span class="keywordtype">void</span> <a class="code" href="classObjectArena.html#a4">FreeAll</a>() {
00370                 <span class="keywordflow">for</span> (<a class="code" href="pbrt_8h.html#a51">u_int</a> i = 0; i &lt; toDelete.size(); ++i)
00371                         <a class="code" href="util_8cpp.html#a29">FreeAligned</a>(toDelete[i]);
00372                 toDelete.erase(toDelete.begin(), toDelete.end());
00373                 nAvailable = 0;
00374         }
00375 <span class="keyword">private</span>:
00376         <span class="comment">// ObjectArena Private Data</span>
<a name="l00377"></a><a class="code" href="classObjectArena.html#r0">00377</a>         T *mem;
<a name="l00378"></a><a class="code" href="classObjectArena.html#r1">00378</a>         <span class="keywordtype">int</span> nAvailable;
<a name="l00379"></a><a class="code" href="classObjectArena.html#r2">00379</a>         vector&lt;T *&gt; toDelete;
00380 };
<a name="l00381"></a><a class="code" href="classMemoryArena.html">00381</a> <span class="keyword">class </span><a class="code" href="pbrt_8h.html#a1">COREDLL</a> MemoryArena {
00382 <span class="keyword">public</span>:
00383         <span class="comment">// MemoryArena Public Methods</span>
<a name="l00384"></a><a class="code" href="classMemoryArena.html#a0">00384</a>         MemoryArena(u_int bs = 32768) {
00385                 blockSize = bs;
00386                 curBlockPos = 0;
00387                 currentBlock = (<span class="keywordtype">char</span> *)<a class="code" href="util_8cpp.html#a28">AllocAligned</a>(blockSize);
00388         }
<a name="l00389"></a><a class="code" href="classMemoryArena.html#a1">00389</a>         ~MemoryArena() {
00390                 <a class="code" href="util_8cpp.html#a29">FreeAligned</a>(currentBlock);
00391                 <span class="keywordflow">for</span> (<a class="code" href="pbrt_8h.html#a51">u_int</a> i = 0; i &lt; usedBlocks.size(); ++i)
00392                         <a class="code" href="util_8cpp.html#a29">FreeAligned</a>(usedBlocks[i]);
00393                 <span class="keywordflow">for</span> (<a class="code" href="pbrt_8h.html#a51">u_int</a> i = 0; i &lt; availableBlocks.size(); ++i)
00394                         <a class="code" href="util_8cpp.html#a29">FreeAligned</a>(availableBlocks[i]);
00395         }
<a name="l00396"></a><a class="code" href="classMemoryArena.html#a2">00396</a>         <span class="keywordtype">void</span> *Alloc(u_int sz) {
00397                 <span class="comment">// Round up _sz_ to minimum machine alignment</span>
00398                 sz = ((sz + 7) &amp; (~7));
00399                 <span class="keywordflow">if</span> (curBlockPos + sz &gt; blockSize) {
00400                         <span class="comment">// Get new block of memory for _MemoryArena_</span>
00401                         usedBlocks.push_back(currentBlock);
00402                         <span class="keywordflow">if</span> (availableBlocks.size() &amp;&amp; sz &lt;= blockSize) {
00403                                 currentBlock = availableBlocks.back();
00404                                 availableBlocks.pop_back();
00405                         }
00406                         <span class="keywordflow">else</span>
00407                                 currentBlock = (<span class="keywordtype">char</span> *)<a class="code" href="util_8cpp.html#a28">AllocAligned</a>(max(sz, blockSize));
00408                         curBlockPos = 0;
00409                 }
00410                 <span class="keywordtype">void</span> *ret = currentBlock + curBlockPos;
00411                 curBlockPos += sz;
00412                 <span class="keywordflow">return</span> ret;
00413         }
<a name="l00414"></a><a class="code" href="classMemoryArena.html#a3">00414</a>         <span class="keywordtype">void</span> FreeAll() {
00415                 curBlockPos = 0;
00416                 <span class="keywordflow">while</span> (usedBlocks.size()) {
00417                         availableBlocks.push_back(usedBlocks.back());
00418                         usedBlocks.pop_back();
00419                 }
00420         }
00421 <span class="keyword">private</span>:
00422         <span class="comment">// MemoryArena Private Data</span>
<a name="l00423"></a><a class="code" href="classMemoryArena.html#r0">00423</a>         <a class="code" href="pbrt_8h.html#a51">u_int</a> curBlockPos, blockSize;
<a name="l00424"></a><a class="code" href="classMemoryArena.html#r2">00424</a>         <span class="keywordtype">char</span> *currentBlock;
<a name="l00425"></a><a class="code" href="classMemoryArena.html#r3">00425</a>         vector&lt;char *&gt; usedBlocks, availableBlocks;
00426 };
<a name="l00427"></a><a class="code" href="classBlockedArray.html">00427</a> <span class="keyword">template</span>&lt;<span class="keyword">class</span> T, <span class="keywordtype">int</span> logBlockSize&gt; <span class="keyword">class </span><a class="code" href="classBlockedArray.html">BlockedArray</a> {
00428 <span class="keyword">public</span>:
00429         <span class="comment">// BlockedArray Public Methods</span>
<a name="l00430"></a><a class="code" href="classBlockedArray.html#a0">00430</a>         <a class="code" href="classBlockedArray.html">BlockedArray</a>(<span class="keywordtype">int</span> nu, <span class="keywordtype">int</span> nv, <span class="keyword">const</span> T *d = NULL) {
00431                 uRes = nu;
00432                 vRes = nv;
00433                 uBlocks = RoundUp(uRes) &gt;&gt; logBlockSize;
00434                 <span class="keywordtype">int</span> nAlloc = RoundUp(uRes) * RoundUp(vRes);
00435                 data = (T *)<a class="code" href="util_8cpp.html#a28">AllocAligned</a>(nAlloc * <span class="keyword">sizeof</span>(T));
00436                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nAlloc; ++i)
00437                         <span class="keyword">new</span> (&amp;data[i]) T();
00438                 <span class="keywordflow">if</span> (d)
00439                         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> v = 0; v &lt; nv; ++v)
00440                                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> u = 0; u &lt; nu; ++u)
00441                                         (*this)(u, v) = d[v * uRes + u];
00442         }
<a name="l00443"></a><a class="code" href="classBlockedArray.html#a1">00443</a>         <span class="keywordtype">int</span> <a class="code" href="classBlockedArray.html#a1">BlockSize</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> 1 &lt;&lt; logBlockSize; }
<a name="l00444"></a><a class="code" href="classBlockedArray.html#a2">00444</a>         <span class="keywordtype">int</span> RoundUp(<span class="keywordtype">int</span> x)<span class="keyword"> const </span>{
00445                 <span class="keywordflow">return</span> (x + <a class="code" href="classBlockedArray.html#a1">BlockSize</a>() - 1) &amp; ~(<a class="code" href="classBlockedArray.html#a1">BlockSize</a>() - 1);
00446         }
<a name="l00447"></a><a class="code" href="classBlockedArray.html#a3">00447</a>         <span class="keywordtype">int</span> <a class="code" href="classBlockedArray.html#a3">uSize</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> uRes; }
<a name="l00448"></a><a class="code" href="classBlockedArray.html#a4">00448</a>         <span class="keywordtype">int</span> <a class="code" href="classBlockedArray.html#a4">vSize</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> vRes; }
<a name="l00449"></a><a class="code" href="classBlockedArray.html#a5">00449</a>         <a class="code" href="classBlockedArray.html#a5">~BlockedArray</a>() {
00450                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; uRes * vRes; ++i)
00451                         data[i].~T();
00452                 <a class="code" href="util_8cpp.html#a29">FreeAligned</a>(data);
00453         }
<a name="l00454"></a><a class="code" href="classBlockedArray.html#a6">00454</a>         <span class="keywordtype">int</span> Block(<span class="keywordtype">int</span> a)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> a &gt;&gt; logBlockSize; }
<a name="l00455"></a><a class="code" href="classBlockedArray.html#a7">00455</a>         <span class="keywordtype">int</span> Offset(<span class="keywordtype">int</span> a)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> (a &amp; (<a class="code" href="classBlockedArray.html#a1">BlockSize</a>() - 1)); }
<a name="l00456"></a><a class="code" href="classBlockedArray.html#a8">00456</a>         T &amp;operator()(<span class="keywordtype">int</span> u, <span class="keywordtype">int</span> v) {
00457                 <span class="keywordtype">int</span> bu = Block(u), bv = Block(v);
00458                 <span class="keywordtype">int</span> ou = Offset(u), ov = Offset(v);
00459                 <span class="keywordtype">int</span> offset = <a class="code" href="classBlockedArray.html#a1">BlockSize</a>() * <a class="code" href="classBlockedArray.html#a1">BlockSize</a>() *
00460                              (uBlocks * bv + bu);
00461                 offset += <a class="code" href="classBlockedArray.html#a1">BlockSize</a>() * ov + ou;
00462                 <span class="keywordflow">return</span> data[offset];
00463         }
<a name="l00464"></a><a class="code" href="classBlockedArray.html#a9">00464</a>         <span class="keyword">const</span> T &amp;operator()(<span class="keywordtype">int</span> u, <span class="keywordtype">int</span> v)<span class="keyword"> const </span>{
00465                 <span class="keywordtype">int</span> bu = Block(u), bv = Block(v);
00466                 <span class="keywordtype">int</span> ou = Offset(u), ov = Offset(v);
00467                 <span class="keywordtype">int</span> offset = <a class="code" href="classBlockedArray.html#a1">BlockSize</a>() * <a class="code" href="classBlockedArray.html#a1">BlockSize</a>() * (uBlocks * bv + bu);
00468                 offset += <a class="code" href="classBlockedArray.html#a1">BlockSize</a>() * ov + ou;
00469                 <span class="keywordflow">return</span> data[offset];
00470         }
<a name="l00471"></a><a class="code" href="classBlockedArray.html#a10">00471</a>         <span class="keywordtype">void</span> GetLinearArray(T *a)<span class="keyword"> const </span>{
00472                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> v = 0; v &lt; vRes; ++v)
00473                         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> u = 0; u &lt; uRes; ++u)
00474                                 *a++ = (*this)(u, v);
00475         }
00476 <span class="keyword">private</span>:
00477         <span class="comment">// BlockedArray Private Data</span>
<a name="l00478"></a><a class="code" href="classBlockedArray.html#r0">00478</a>         T *data;
<a name="l00479"></a><a class="code" href="classBlockedArray.html#r2">00479</a>         <span class="keywordtype">int</span> uRes, vRes, uBlocks;
00480 };
<a name="l00481"></a><a class="code" href="structMatrix4x4.html">00481</a> <span class="keyword">struct </span><a class="code" href="pbrt_8h.html#a1">COREDLL</a> Matrix4x4 : <span class="keyword">public</span> ReferenceCounted {
00482         <span class="comment">// Matrix4x4 Public Methods</span>
<a name="l00483"></a><a class="code" href="structMatrix4x4.html#a0">00483</a>         Matrix4x4() {
00484                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 4; ++i)
00485                         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 4; ++j)
00486                                 <span class="keywordflow">if</span> (i == j) m[i][j] = 1.;
00487                                 <span class="keywordflow">else</span> m[i][j] = 0.;
00488         }
00489         Matrix4x4(<span class="keywordtype">float</span> mat[4][4]);
00490         Matrix4x4(<span class="keywordtype">float</span> t00, <span class="keywordtype">float</span> t01, <span class="keywordtype">float</span> t02, <span class="keywordtype">float</span> t03,
00491                   <span class="keywordtype">float</span> t10, <span class="keywordtype">float</span> t11, <span class="keywordtype">float</span> t12, <span class="keywordtype">float</span> t13,
00492                   <span class="keywordtype">float</span> t20, <span class="keywordtype">float</span> t21, <span class="keywordtype">float</span> t22, <span class="keywordtype">float</span> t23,
00493                   <span class="keywordtype">float</span> t30, <span class="keywordtype">float</span> t31, <span class="keywordtype">float</span> t32, <span class="keywordtype">float</span> t33);
00494         <a class="code" href="classReference.html">Reference&lt;Matrix4x4&gt;</a> Transpose() const;
<a name="l00495"></a><a class="code" href="structMatrix4x4.html#a4">00495</a>         <span class="keywordtype">void</span> Print(ostream &amp;os)<span class="keyword"> const </span>{
00496                 os &lt;&lt; <span class="stringliteral">"[ "</span>;
00497                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 4; ++i) {
00498                         os &lt;&lt; <span class="stringliteral">"[ "</span>;
00499                         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 4; ++j)  {
00500                                 os &lt;&lt; m[i][j];
00501                                 <span class="keywordflow">if</span> (j != 3) os &lt;&lt; <span class="stringliteral">", "</span>;
00502                         }
00503                         os &lt;&lt; <span class="stringliteral">" ] "</span>;
00504                 }
00505                 os &lt;&lt; <span class="stringliteral">" ] "</span>;
00506         }
00507         <span class="keyword">static</span> <a class="code" href="classReference.html">Reference&lt;Matrix4x4&gt;</a>
<a name="l00508"></a><a class="code" href="structMatrix4x4.html#e0">00508</a>                 Mul(<span class="keyword">const</span> <a class="code" href="classReference.html">Reference&lt;Matrix4x4&gt;</a> &amp;m1,
00509                 <span class="keyword">const</span> <a class="code" href="classReference.html">Reference&lt;Matrix4x4&gt;</a> &amp;m2) {
00510                 <span class="keywordtype">float</span> r[4][4];
00511                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 4; ++i)
00512                         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 4; ++j)
00513                                 r[i][j] = m1-&gt;m[i][0] * m2-&gt;m[0][j] +
00514                                           m1-&gt;m[i][1] * m2-&gt;m[1][j] +
00515                                           m1-&gt;m[i][2] * m2-&gt;m[2][j] +
00516                                           m1-&gt;m[i][3] * m2-&gt;m[3][j];
00517                 <span class="keywordflow">return</span> <span class="keyword">new</span> Matrix4x4(r);
00518         }
00519         <a class="code" href="classReference.html">Reference&lt;Matrix4x4&gt;</a> Inverse() const;
<a name="l00520"></a><a class="code" href="structMatrix4x4.html#o0">00520</a>         <span class="keywordtype">float</span> m[4][4];
00521 };
00522 <span class="comment">// Global Inline Functions</span>
00523 #ifdef NDEBUG
00524 #define Assert(expr) ((<span class="keywordtype">void</span>)0)
00525 #else
<a name="l00526"></a><a class="code" href="pbrt_8h.html#a46">00526</a> #define Assert(expr) \
00527     ((expr) ? (<span class="keywordtype">void</span>)0 : \
00528                 Severe("Assertion \"%s\" failed in %s, line %d", \
00529                #expr, __FILE__, __LINE__))
00530 #endif <span class="comment">// NDEBUG</span>
<a name="l00531"></a><a class="code" href="pbrt_8h.html#a94">00531</a> inline <span class="keywordtype">float</span> Lerp(<span class="keywordtype">float</span> t, <span class="keywordtype">float</span> v1, <span class="keywordtype">float</span> v2) {
00532         <span class="keywordflow">return</span> (1.f - t) * v1 + t * v2;
00533 }
<a name="l00534"></a><a class="code" href="pbrt_8h.html#a95">00534</a> <span class="keyword">inline</span> <span class="keywordtype">float</span> <a class="code" href="pbrt_8h.html#a96">Clamp</a>(<span class="keywordtype">float</span> val, <span class="keywordtype">float</span> low, <span class="keywordtype">float</span> high) {
00535         <span class="keywordflow">if</span> (val &lt; low) <span class="keywordflow">return</span> low;
00536         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (val &gt; high) <span class="keywordflow">return</span> high;
00537         <span class="keywordflow">else</span> <span class="keywordflow">return</span> val;
00538 }
<a name="l00539"></a><a class="code" href="pbrt_8h.html#a96">00539</a> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="pbrt_8h.html#a96">Clamp</a>(<span class="keywordtype">int</span> val, <span class="keywordtype">int</span> low, <span class="keywordtype">int</span> high) {
00540         <span class="keywordflow">if</span> (val &lt; low) <span class="keywordflow">return</span> low;
00541         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (val &gt; high) <span class="keywordflow">return</span> high;
00542         <span class="keywordflow">else</span> <span class="keywordflow">return</span> val;
00543 }
<a name="l00544"></a><a class="code" href="pbrt_8h.html#a97">00544</a> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="pbrt_8h.html#a97">Mod</a>(<span class="keywordtype">int</span> a, <span class="keywordtype">int</span> b) {
00545     <span class="keywordtype">int</span> n = int(a/b);
00546     a -= n*b;
00547     <span class="keywordflow">if</span> (a &lt; 0)
00548         a += b;
00549     <span class="keywordflow">return</span> a;
00550 }
<a name="l00551"></a><a class="code" href="pbrt_8h.html#a98">00551</a> <span class="keyword">inline</span> <span class="keywordtype">float</span> <a class="code" href="pbrt_8h.html#a98">Radians</a>(<span class="keywordtype">float</span> deg) {
00552         <span class="keywordflow">return</span> ((<span class="keywordtype">float</span>)<a class="code" href="pbrt_8h.html#a6">M_PI</a>/180.f) * deg;
00553 }
<a name="l00554"></a><a class="code" href="pbrt_8h.html#a99">00554</a> <span class="keyword">inline</span> <span class="keywordtype">float</span> <a class="code" href="pbrt_8h.html#a99">Degrees</a>(<span class="keywordtype">float</span> rad) {
00555         <span class="keywordflow">return</span> (180.f/(<span class="keywordtype">float</span>)<a class="code" href="pbrt_8h.html#a6">M_PI</a>) * rad;
00556 }
<a name="l00557"></a><a class="code" href="pbrt_8h.html#a100">00557</a> <span class="keyword">inline</span> <span class="keywordtype">float</span> <a class="code" href="pbrt_8h.html#a100">Log2</a>(<span class="keywordtype">float</span> x) {
00558         <span class="keyword">static</span> <span class="keywordtype">float</span> invLog2 = 1.f / logf(2.f);
00559         <span class="keywordflow">return</span> logf(x) * invLog2;
00560 }
<a name="l00561"></a><a class="code" href="pbrt_8h.html#a101">00561</a> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="pbrt_8h.html#a101">Log2Int</a>(<span class="keywordtype">float</span> v) {
00562         <span class="keywordflow">return</span> ((*(<span class="keywordtype">int</span> *) &amp;v) &gt;&gt; 23) - 127;
00563 }
<a name="l00564"></a><a class="code" href="pbrt_8h.html#a102">00564</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="pbrt_8h.html#a102">IsPowerOf2</a>(<span class="keywordtype">int</span> v) {
00565         <span class="keywordflow">return</span> (v &amp; (v - 1)) == 0;
00566 }
<a name="l00567"></a><a class="code" href="pbrt_8h.html#a103">00567</a> <span class="keyword">inline</span> <a class="code" href="pbrt_8h.html#a51">u_int</a> <a class="code" href="pbrt_8h.html#a103">RoundUpPow2</a>(u_int v) {
00568         v--;
00569         v |= v &gt;&gt; 1;
00570         v |= v &gt;&gt; 2;
00571         v |= v &gt;&gt; 4;
00572         v |= v &gt;&gt; 8;
00573         v |= v &gt;&gt; 16;
00574         <span class="keywordflow">return</span> v+1;
00575 }
00576 <span class="preprocessor">#if (defined(__linux__) &amp;&amp; defined(__i386__)) || defined(WIN32)</span>
00577 <span class="preprocessor"></span><span class="preprocessor">#define FAST_INT 1</span>
00578 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00579"></a><a class="code" href="pbrt_8h.html#a47">00579</a> <span class="preprocessor"></span><span class="preprocessor">#define _doublemagicroundeps          (.5-1.4e-11)</span>
00580 <span class="preprocessor"></span>        <span class="comment">//almost .5f = .5f - 1e^(number of exp bit)</span>
<a name="l00581"></a><a class="code" href="pbrt_8h.html#a104">00581</a> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="pbrt_8h.html#a104">Round2Int</a>(<span class="keywordtype">double</span> val) {
00582 <span class="preprocessor">#ifdef FAST_INT</span>
00583 <span class="preprocessor"></span><span class="preprocessor">#define _doublemagic                    double (6755399441055744.0)</span>
00584 <span class="preprocessor"></span>        <span class="comment">//2^52 * 1.5,  uses limited precision to floor</span>
00585         val             = val + _doublemagic;
00586         <span class="keywordflow">return</span> ((<span class="keywordtype">long</span>*)&amp;val)[0];
00587 <span class="preprocessor">#else</span>
00588 <span class="preprocessor"></span>        <span class="keywordflow">return</span> int (val+<a class="code" href="pbrt_8h.html#a15">_doublemagicroundeps</a>);
00589 <span class="preprocessor">#endif</span>
00590 <span class="preprocessor"></span>}
<a name="l00591"></a><a class="code" href="pbrt_8h.html#a105">00591</a> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="pbrt_8h.html#a105">Float2Int</a>(<span class="keywordtype">double</span> val) {
00592 <span class="preprocessor">#ifdef FAST_INT</span>
00593 <span class="preprocessor"></span>        <span class="keywordflow">return</span> (val&lt;0) ?  <a class="code" href="pbrt_8h.html#a104">Round2Int</a>(val+<a class="code" href="pbrt_8h.html#a15">_doublemagicroundeps</a>) :
00594                    <a class="code" href="pbrt_8h.html#a104">Round2Int</a>(val-<a class="code" href="pbrt_8h.html#a15">_doublemagicroundeps</a>);
00595 <span class="preprocessor">#else</span>
00596 <span class="preprocessor"></span>        <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)val;
00597 <span class="preprocessor">#endif</span>
00598 <span class="preprocessor"></span>}
<a name="l00599"></a><a class="code" href="pbrt_8h.html#a106">00599</a> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="pbrt_8h.html#a106">Floor2Int</a>(<span class="keywordtype">double</span> val) {
00600 <span class="preprocessor">#ifdef FAST_INT</span>
00601 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <a class="code" href="pbrt_8h.html#a104">Round2Int</a>(val - <a class="code" href="pbrt_8h.html#a15">_doublemagicroundeps</a>);
00602 <span class="preprocessor">#else</span>
00603 <span class="preprocessor"></span>        <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)floorf(val);
00604 <span class="preprocessor">#endif</span>
00605 <span class="preprocessor"></span>}
<a name="l00606"></a><a class="code" href="pbrt_8h.html#a107">00606</a> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="pbrt_8h.html#a107">Ceil2Int</a>(<span class="keywordtype">double</span> val) {
00607 <span class="preprocessor">#ifdef FAST_INT</span>
00608 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <a class="code" href="pbrt_8h.html#a104">Round2Int</a>(val + <a class="code" href="pbrt_8h.html#a15">_doublemagicroundeps</a>);
00609 <span class="preprocessor">#else</span>
00610 <span class="preprocessor"></span>        <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)ceilf(val);
00611 <span class="preprocessor">#endif</span>
00612 <span class="preprocessor"></span>}
00613 <span class="keyword">inline</span> <span class="keywordtype">float</span> <a class="code" href="pbrt_8h.html#a108">RandomFloat</a>();
00614 <span class="keyword">inline</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="pbrt_8h.html#a109">RandomUInt</a>();
<a name="l00615"></a><a class="code" href="pbrt_8h.html#a108">00615</a> <span class="keyword">inline</span> <span class="keywordtype">float</span> <a class="code" href="pbrt_8h.html#a108">RandomFloat</a>() {
00616         <span class="keywordflow">return</span> <a class="code" href="pbrt_8h.html#a69">genrand_real2</a>();
00617 }
00618 
<a name="l00619"></a><a class="code" href="pbrt_8h.html#a109">00619</a> <span class="keyword">inline</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="pbrt_8h.html#a109">RandomUInt</a>() {
00620         <span class="keywordflow">return</span> <a class="code" href="pbrt_8h.html#a67">genrand_int32</a>();
00621 }
<a name="l00622"></a><a class="code" href="pbrt_8h.html#a110">00622</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="pbrt_8h.html#a110">Quadratic</a>(<span class="keywordtype">float</span> A, <span class="keywordtype">float</span> B, <span class="keywordtype">float</span> C, <span class="keywordtype">float</span> *t0,
00623                 <span class="keywordtype">float</span> *t1) {
00624         <span class="comment">// Find quadratic discriminant</span>
00625         <span class="keywordtype">float</span> discrim = B * B - 4.f * A * C;
00626         <span class="keywordflow">if</span> (discrim &lt; 0.) <span class="keywordflow">return</span> <span class="keyword">false</span>;
00627         <span class="keywordtype">float</span> rootDiscrim = sqrtf(discrim);
00628         <span class="comment">// Compute quadratic _t_ values</span>
00629         <span class="keywordtype">float</span> q;
00630         <span class="keywordflow">if</span> (B &lt; 0) q = -.5f * (B - rootDiscrim);
00631         <span class="keywordflow">else</span>       q = -.5f * (B + rootDiscrim);
00632         *t0 = q / A;
00633         *t1 = C / q;
00634         <span class="keywordflow">if</span> (*t0 &gt; *t1) swap(*t0, *t1);
00635         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00636 }
<a name="l00637"></a><a class="code" href="pbrt_8h.html#a111">00637</a> <span class="keyword">inline</span> <span class="keywordtype">float</span> <a class="code" href="pbrt_8h.html#a111">SmoothStep</a>(<span class="keywordtype">float</span> min, <span class="keywordtype">float</span> max, <span class="keywordtype">float</span> value) {
00638         <span class="keywordtype">float</span> v = <a class="code" href="pbrt_8h.html#a96">Clamp</a>((value - min) / (max - min), 0.f, 1.f);
00639         <span class="keywordflow">return</span> v * v * (-2.f * v  + 3.f);
00640 }
<a name="l00641"></a><a class="code" href="pbrt_8h.html#a112">00641</a> <span class="keyword">inline</span> <span class="keywordtype">float</span> <a class="code" href="pbrt_8h.html#a112">ExponentialAverage</a>(<span class="keywordtype">float</span> avg,
00642                               <span class="keywordtype">float</span> val, <span class="keywordtype">float</span> alpha) {
00643         <span class="keywordflow">return</span> (1.f - alpha) * val + alpha * avg;
00644 }
00645 <span class="preprocessor">#endif // PBRT_PBRT_H</span>
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Mon Apr 25 19:00:23 2005 for pbrt by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
