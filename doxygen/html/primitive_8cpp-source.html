<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>pbrt: primitive.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>primitive.cpp</h1><a href="primitive_8cpp.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 
00002 <span class="comment">/*</span>
00003 <span class="comment"> * pbrt source code Copyright(c) 1998-2005 Matt Pharr and Greg Humphreys</span>
00004 <span class="comment"> *</span>
00005 <span class="comment"> * All Rights Reserved.</span>
00006 <span class="comment"> * For educational use only; commercial use expressly forbidden.</span>
00007 <span class="comment"> * NO WARRANTY, express or implied, for this software.</span>
00008 <span class="comment"> * (See file License.txt for complete license)</span>
00009 <span class="comment"> */</span>
00010 
00011 <span class="comment">// primitive.cpp*</span>
00012 <span class="preprocessor">#include "<a class="code" href="primitive_8h.html">primitive.h</a>"</span>
00013 <span class="preprocessor">#include "<a class="code" href="light_8h.html">light.h</a>"</span>
00014 <span class="comment">// Primitive Method Definitions</span>
<a name="l00015"></a><a class="code" href="classPrimitive.html#a0">00015</a> <a class="code" href="classPrimitive.html#a0">Primitive::~Primitive</a>() { }
00016 
<a name="l00017"></a><a class="code" href="classPrimitive.html#a2">00017</a> <span class="keywordtype">bool</span> <a class="code" href="classPrimitive.html#a2">Primitive::CanIntersect</a>()<span class="keyword"> const </span>{
00018         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00019 }
00020 
00021 <span class="keywordtype">void</span>
<a name="l00022"></a><a class="code" href="classPrimitive.html#a5">00022</a> <a class="code" href="classPrimitive.html#a5">Primitive::Refine</a>(vector&lt;<a class="code" href="classReference.html">Reference&lt;Primitive&gt;</a> &gt; &amp;refined)<span class="keyword"></span>
00023 <span class="keyword">const </span>{
00024         <a class="code" href="util_8cpp.html#a17">Severe</a>(<span class="stringliteral">"Unimplemented Primitive::Refine"</span>
00025                  <span class="stringliteral">"method called!"</span>);
00026 }
<a name="l00027"></a><a class="code" href="classPrimitive.html#a6">00027</a> <span class="keywordtype">void</span> <a class="code" href="classPrimitive.html#a6">Primitive::FullyRefine</a>(
00028                 vector&lt;<a class="code" href="classReference.html">Reference&lt;Primitive&gt;</a> &gt; &amp;refined)<span class="keyword"> const </span>{
00029         vector&lt;Reference&lt;Primitive&gt; &gt; todo;
00030         todo.push_back(const_cast&lt;Primitive *&gt;(<span class="keyword">this</span>));
00031         <span class="keywordflow">while</span> (todo.size()) {
00032                 <span class="comment">// Refine last primitive in todo list</span>
00033                 <a class="code" href="classReference.html">Reference&lt;Primitive&gt;</a> prim = todo.back();
00034                 todo.pop_back();
00035                 <span class="keywordflow">if</span> (prim-&gt;CanIntersect())
00036                         refined.push_back(prim);
00037                 <span class="keywordflow">else</span>
00038                         prim-&gt;Refine(todo);
00039         }
00040 }
<a name="l00041"></a><a class="code" href="classAggregate.html#a0">00041</a> <span class="keyword">const</span> <a class="code" href="classAreaLight.html">AreaLight</a> *<a class="code" href="classAggregate.html#a0">Aggregate::GetAreaLight</a>()<span class="keyword"> const </span>{
00042         <a class="code" href="util_8cpp.html#a17">Severe</a>(<span class="stringliteral">"Aggregate::GetAreaLight() method"</span>
00043              <span class="stringliteral">"called; should have gone to GeometricPrimitive"</span>);
00044         <span class="keywordflow">return</span> NULL;
00045 }
<a name="l00046"></a><a class="code" href="classAggregate.html#a1">00046</a> <a class="code" href="classBSDF.html">BSDF</a> *<a class="code" href="classAggregate.html#a1">Aggregate::GetBSDF</a>(<span class="keyword">const</span> <a class="code" href="structDifferentialGeometry.html">DifferentialGeometry</a> &amp;,
00047                 <span class="keyword">const</span> <a class="code" href="classTransform.html">Transform</a> &amp;)<span class="keyword"> const </span>{
00048         <a class="code" href="util_8cpp.html#a17">Severe</a>(<span class="stringliteral">"Aggregate::GetBSDF() method"</span>
00049             <span class="stringliteral">"called; should have gone to GeometricPrimitive"</span>);
00050         <span class="keywordflow">return</span> NULL;
00051 }
00052 <span class="comment">// InstancePrimitive Method Definitions</span>
<a name="l00053"></a><a class="code" href="classInstancePrimitive.html#a1">00053</a> <span class="keywordtype">bool</span> <a class="code" href="classInstancePrimitive.html#a1">InstancePrimitive::Intersect</a>(<span class="keyword">const</span> <a class="code" href="classRay.html">Ray</a> &amp;r,
00054                                <a class="code" href="structIntersection.html">Intersection</a> *isect)<span class="keyword"> const </span>{
00055         <a class="code" href="classRay.html">Ray</a> ray = <a class="code" href="classInstancePrimitive.html#r2">WorldToInstance</a>(r);
00056         <span class="keywordflow">if</span> (!<a class="code" href="classInstancePrimitive.html#r0">instance</a>-&gt;Intersect(ray, isect))
00057                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00058         r.<a class="code" href="classRay.html#o3">maxt</a> = ray.<a class="code" href="classRay.html#o3">maxt</a>;
00059         isect-&gt;<a class="code" href="structIntersection.html#o2">WorldToObject</a> = isect-&gt;<a class="code" href="structIntersection.html#o2">WorldToObject</a> *
00060                 WorldToInstance;
00061         <span class="comment">// Transform instance's differential geometry to world space</span>
00062         isect-&gt;<a class="code" href="structIntersection.html#o0">dg</a>.<a class="code" href="structDifferentialGeometry.html#o0">p</a> = <a class="code" href="classInstancePrimitive.html#r1">InstanceToWorld</a>(isect-&gt;<a class="code" href="structIntersection.html#o0">dg</a>.<a class="code" href="structDifferentialGeometry.html#o0">p</a>);
00063         isect-&gt;<a class="code" href="structIntersection.html#o0">dg</a>.<a class="code" href="structDifferentialGeometry.html#o1">nn</a> = <a class="code" href="geometry_8h.html#a14">Normalize</a>(<a class="code" href="classInstancePrimitive.html#r1">InstanceToWorld</a>(isect-&gt;<a class="code" href="structIntersection.html#o0">dg</a>.<a class="code" href="structDifferentialGeometry.html#o1">nn</a>));
00064         isect-&gt;<a class="code" href="structIntersection.html#o0">dg</a>.<a class="code" href="structDifferentialGeometry.html#o5">dpdu</a> = <a class="code" href="classInstancePrimitive.html#r1">InstanceToWorld</a>(isect-&gt;<a class="code" href="structIntersection.html#o0">dg</a>.<a class="code" href="structDifferentialGeometry.html#o5">dpdu</a>);
00065         isect-&gt;<a class="code" href="structIntersection.html#o0">dg</a>.<a class="code" href="structDifferentialGeometry.html#o6">dpdv</a> = <a class="code" href="classInstancePrimitive.html#r1">InstanceToWorld</a>(isect-&gt;<a class="code" href="structIntersection.html#o0">dg</a>.<a class="code" href="structDifferentialGeometry.html#o6">dpdv</a>);
00066         isect-&gt;<a class="code" href="structIntersection.html#o0">dg</a>.<a class="code" href="structDifferentialGeometry.html#o7">dndu</a> = <a class="code" href="classInstancePrimitive.html#r1">InstanceToWorld</a>(isect-&gt;<a class="code" href="structIntersection.html#o0">dg</a>.<a class="code" href="structDifferentialGeometry.html#o7">dndu</a>);
00067         isect-&gt;<a class="code" href="structIntersection.html#o0">dg</a>.<a class="code" href="structDifferentialGeometry.html#o8">dndv</a> = <a class="code" href="classInstancePrimitive.html#r1">InstanceToWorld</a>(isect-&gt;<a class="code" href="structIntersection.html#o0">dg</a>.<a class="code" href="structDifferentialGeometry.html#o8">dndv</a>);
00068         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00069 }
<a name="l00070"></a><a class="code" href="classInstancePrimitive.html#a2">00070</a> <span class="keywordtype">bool</span> <a class="code" href="classInstancePrimitive.html#a2">InstancePrimitive::IntersectP</a>(<span class="keyword">const</span> <a class="code" href="classRay.html">Ray</a> &amp;r)<span class="keyword"> const </span>{
00071         <span class="keywordflow">return</span> <a class="code" href="classInstancePrimitive.html#r0">instance</a>-&gt;IntersectP(<a class="code" href="classInstancePrimitive.html#r2">WorldToInstance</a>(r));
00072 }
00073 <span class="comment">// GeometricPrimitive Method Definitions</span>
<a name="l00074"></a><a class="code" href="classGeometricPrimitive.html#a2">00074</a> <a class="code" href="classBBox.html">BBox</a> <a class="code" href="classGeometricPrimitive.html#a2">GeometricPrimitive::WorldBound</a>()<span class="keyword"> const </span>{
00075         <span class="keywordflow">return</span> <a class="code" href="classGeometricPrimitive.html#r0">shape</a>-&gt;WorldBound();
00076 }
<a name="l00077"></a><a class="code" href="classGeometricPrimitive.html#a4">00077</a> <span class="keywordtype">bool</span> <a class="code" href="classGeometricPrimitive.html#a4">GeometricPrimitive::IntersectP</a>(<span class="keyword">const</span> <a class="code" href="classRay.html">Ray</a> &amp;r)<span class="keyword"> const </span>{
00078         <span class="keywordflow">return</span> <a class="code" href="classGeometricPrimitive.html#r0">shape</a>-&gt;IntersectP(r);
00079 }
<a name="l00080"></a><a class="code" href="classGeometricPrimitive.html#a0">00080</a> <span class="keywordtype">bool</span> <a class="code" href="classGeometricPrimitive.html#a0">GeometricPrimitive::CanIntersect</a>()<span class="keyword"> const </span>{
00081         <span class="keywordflow">return</span> <a class="code" href="classGeometricPrimitive.html#r0">shape</a>-&gt;CanIntersect();
00082 }
00083 <span class="keywordtype">void</span> GeometricPrimitive::
<a name="l00084"></a><a class="code" href="classGeometricPrimitive.html#a1">00084</a>         Refine(vector&lt;<a class="code" href="classReference.html">Reference&lt;Primitive&gt;</a> &gt; &amp;refined)
00085         <span class="keyword">const</span> {
00086         vector&lt;Reference&lt;Shape&gt; &gt; r;
00087         shape-&gt;Refine(r);
00088         <span class="keywordflow">for</span> (<a class="code" href="pbrt_8h.html#a51">u_int</a> i = 0; i &lt; r.size(); ++i) {
00089                 <a class="code" href="classGeometricPrimitive.html">GeometricPrimitive</a> *gp =
00090                     <span class="keyword">new</span> <a class="code" href="classGeometricPrimitive.html">GeometricPrimitive</a>(r[i],
00091                            material, areaLight);
00092                 refined.push_back(gp);
00093         }
00094 }
00095 GeometricPrimitive::
<a name="l00096"></a><a class="code" href="classGeometricPrimitive.html#a5">00096</a>     GeometricPrimitive(<span class="keyword">const</span> <a class="code" href="classReference.html">Reference&lt;Shape&gt;</a> &amp;s,
00097                 <span class="keyword">const</span> <a class="code" href="classReference.html">Reference&lt;Material&gt;</a> &amp;m, <a class="code" href="classAreaLight.html">AreaLight</a> *a)
00098         : shape(s), material(m), areaLight(a) {
00099 }
<a name="l00100"></a><a class="code" href="classGeometricPrimitive.html#a3">00100</a> <span class="keywordtype">bool</span> <a class="code" href="classGeometricPrimitive.html#a3">GeometricPrimitive::Intersect</a>(<span class="keyword">const</span> <a class="code" href="classRay.html">Ray</a> &amp;r,
00101                 <a class="code" href="structIntersection.html">Intersection</a> *isect)<span class="keyword"> const </span>{
00102         <span class="keywordtype">float</span> thit;
00103         <span class="keywordflow">if</span> (!<a class="code" href="classGeometricPrimitive.html#r0">shape</a>-&gt;Intersect(r, &amp;thit, &amp;isect-&gt;<a class="code" href="structIntersection.html#o0">dg</a>))
00104                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00105         isect-&gt;<a class="code" href="structIntersection.html#o1">primitive</a> = <span class="keyword">this</span>;
00106         isect-&gt;<a class="code" href="structIntersection.html#o2">WorldToObject</a> = <a class="code" href="classGeometricPrimitive.html#r0">shape</a>-&gt;WorldToObject;
00107         r.<a class="code" href="classRay.html#o3">maxt</a> = thit;
00108         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00109 }
<a name="l00110"></a><a class="code" href="classGeometricPrimitive.html#a6">00110</a> <span class="keyword">const</span> <a class="code" href="classAreaLight.html">AreaLight</a> *<a class="code" href="classGeometricPrimitive.html#a6">GeometricPrimitive::GetAreaLight</a>()<span class="keyword"> const </span>{
00111         <span class="keywordflow">return</span> <a class="code" href="classGeometricPrimitive.html#r2">areaLight</a>;
00112 }
00113 <a class="code" href="classBSDF.html">BSDF</a> *
<a name="l00114"></a><a class="code" href="classGeometricPrimitive.html#a7">00114</a> <a class="code" href="classGeometricPrimitive.html#a7">GeometricPrimitive::GetBSDF</a>(<span class="keyword">const</span> <a class="code" href="structDifferentialGeometry.html">DifferentialGeometry</a> &amp;dg,
00115                 <span class="keyword">const</span> <a class="code" href="classTransform.html">Transform</a> &amp;WorldToObject)<span class="keyword"> const </span>{
00116         <a class="code" href="structDifferentialGeometry.html">DifferentialGeometry</a> dgs;
00117         <a class="code" href="classGeometricPrimitive.html#r0">shape</a>-&gt;GetShadingGeometry(WorldToObject.<a class="code" href="classTransform.html#a4">GetInverse</a>(),
00118                 dg, &amp;dgs);
00119         <span class="keywordflow">return</span> <a class="code" href="classGeometricPrimitive.html#r1">material</a>-&gt;GetBSDF(dg, dgs);
00120 }
00121 <span class="comment">// Intersection Method Definitions</span>
<a name="l00122"></a><a class="code" href="structIntersection.html#a1">00122</a> <a class="code" href="classBSDF.html">BSDF</a> *<a class="code" href="structIntersection.html#a1">Intersection::GetBSDF</a>(<span class="keyword">const</span> <a class="code" href="classRayDifferential.html">RayDifferential</a> &amp;ray)
00123                 <span class="keyword">const</span> {
00124         <span class="keyword">static</span> <a class="code" href="classStatsCounter.html">StatsCounter</a> pointsShaded(<span class="stringliteral">"Shading"</span>, <span class="stringliteral">"Number of points shaded"</span>); <span class="comment">// NOBOOK</span>
00125         ++pointsShaded; <span class="comment">// NOBOOK</span>
00126         dg.ComputeDifferentials(ray);
00127         <span class="keywordflow">return</span> primitive-&gt;GetBSDF(dg, WorldToObject);
00128 }
<a name="l00129"></a><a class="code" href="structIntersection.html#a2">00129</a> <a class="code" href="classSpectrum.html">Spectrum</a> <a class="code" href="structIntersection.html#a2">Intersection::Le</a>(<span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a> &amp;w)<span class="keyword"> const </span>{
00130         <span class="keyword">const</span> <a class="code" href="classAreaLight.html">AreaLight</a> *area = <a class="code" href="structIntersection.html#o1">primitive</a>-&gt;<a class="code" href="classPrimitive.html#a7">GetAreaLight</a>();
00131         <span class="keywordflow">return</span> area ? area-&gt;<a class="code" href="classAreaLight.html#a1">L</a>(<a class="code" href="structIntersection.html#o0">dg</a>.<a class="code" href="structDifferentialGeometry.html#o0">p</a>, <a class="code" href="structIntersection.html#o0">dg</a>.<a class="code" href="structDifferentialGeometry.html#o1">nn</a>, w) : <a class="code" href="classSpectrum.html">Spectrum</a>(0.);
00132 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Mon Apr 25 19:00:23 2005 for pbrt by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
