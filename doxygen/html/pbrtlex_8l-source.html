<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>pbrt: pbrtlex.l Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>pbrtlex.l</h1><a href="pbrtlex_8l.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 
00002 <span class="comment">/*</span>
00003 <span class="comment"> * pbrt source code Copyright(c) 1998-2005 Matt Pharr and Greg Humphreys</span>
00004 <span class="comment"> *</span>
00005 <span class="comment"> * All Rights Reserved.</span>
00006 <span class="comment"> * For educational use only; commercial use expressly forbidden.</span>
00007 <span class="comment"> * NO WARRANTY, express or implied, for this software.</span>
00008 <span class="comment"> * (See file License.txt for complete license)</span>
00009 <span class="comment"> */</span>
00010 
00011 <span class="comment">/* state used for include file stuff */</span>
00012 %{
00013 
00014 <span class="preprocessor">#define YY_MAIN 0</span>
00015 <span class="preprocessor"></span><span class="preprocessor">#define YY_NEVER_INTERACTIVE 1</span>
00016 <span class="preprocessor"></span>
00017 <span class="preprocessor">#include "<a class="code" href="pbrt_8h.html">pbrt.h</a>"</span>
00018 <span class="preprocessor">#include "<a class="code" href="api_8h.html">api.h</a>"</span>
00019 
00020 <span class="keyword">struct </span>ParamArray;
00021 
00022 <span class="preprocessor">#ifdef __APPLE__</span>
00023 <span class="preprocessor"></span><span class="preprocessor">#include "pbrtparse.cpp.h"</span>
00024 <span class="preprocessor">#else</span>
00025 <span class="preprocessor"></span><span class="preprocessor">#include "pbrtparse.hpp"</span>
00026 <span class="preprocessor">#endif</span>
00027 <span class="preprocessor"></span>
00028 <span class="preprocessor">#ifdef WIN32</span>
00029 <span class="preprocessor"></span><span class="preprocessor">#pragma warning ( disable: 4244 )</span>
00030 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00031 <span class="preprocessor"></span>
00032 <span class="keyword">struct </span>IncludeInfo {
00033         string filename;
00034         YY_BUFFER_STATE bufState;
00035         <span class="keywordtype">int</span> lineNum;
00036 };
00037 vector&lt;IncludeInfo&gt; includeStack;
00038 
00039 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="core_2samplepat_8cpp.html#a2">line_num</a>;
00040 <span class="keywordtype">int</span> str_pos;
00041 
00042 <span class="keywordtype">void</span> add_string_char( <span class="keywordtype">char</span> c )
00043 {
00044         yylval.string[str_pos++] = c;
00045         yylval.string[str_pos] = <span class="charliteral">'\0'</span>;
00046 }
00047 
00048 <span class="keyword">extern</span> <span class="keywordtype">void</span> yyerror( <span class="keyword">const</span> <span class="keywordtype">char</span> *str );
00049 <span class="keyword">extern</span> <span class="keywordtype">void</span> ParseError( <span class="keyword">const</span> <span class="keywordtype">char</span> *format, ... ) PRINTF_FUNC;
00050 
00051 <span class="keywordtype">void</span> include_push(<span class="keywordtype">char</span> *filename) {
00052         <span class="keywordflow">if</span> (includeStack.size() &gt; 32)
00053                 <a class="code" href="util_8cpp.html#a17">Severe</a>(<span class="stringliteral">"Only 32 levels of nested Include allowed in scene files."</span>);
00054         IncludeInfo ii;
00055         <span class="keyword">extern</span> string <a class="code" href="core_2samplepat_8cpp.html#a3">current_file</a>;
00056         ii.filename = <a class="code" href="core_2samplepat_8cpp.html#a3">current_file</a>;
00057         ii.bufState = YY_CURRENT_BUFFER;
00058         ii.lineNum = <a class="code" href="core_2samplepat_8cpp.html#a2">line_num</a>;
00059         includeStack.push_back(ii);
00060 
00061         <a class="code" href="core_2samplepat_8cpp.html#a3">current_file</a> = filename;
00062         <a class="code" href="core_2samplepat_8cpp.html#a2">line_num</a> = 1;
00063 
00064         yyin = fopen(filename, <span class="stringliteral">"r"</span>);
00065         <span class="keywordflow">if</span> (!yyin)
00066                 <a class="code" href="util_8cpp.html#a17">Severe</a>(<span class="stringliteral">"Unable to open included scene file \"%s\""</span>, filename);
00067         yy_switch_to_buffer(yy_create_buffer(yyin, YY_BUF_SIZE));
00068 }
00069 
00070 <span class="keywordtype">void</span> include_pop(<span class="keywordtype">void</span>)
00071 {
00072         <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="core_2samplepat_8cpp.html#a2">line_num</a>;
00073         <span class="keyword">extern</span> string <a class="code" href="core_2samplepat_8cpp.html#a3">current_file</a>;
00074         yy_delete_buffer(YY_CURRENT_BUFFER);
00075         yy_switch_to_buffer(includeStack.back().bufState);
00076         <a class="code" href="core_2samplepat_8cpp.html#a3">current_file</a> = includeStack.back().filename;
00077         <a class="code" href="core_2samplepat_8cpp.html#a2">line_num</a> = includeStack.back().lineNum;
00078         includeStack.pop_back();
00079 }
00080 %}
00081 %option nounput
00082 WHITESPACE [ \t
00083 ]+
00084 NUMBER [-+]?([0-9]+|(([0-9]+\.[0-9]*)|(\.[0-9]+)))([eE][-+]?[0-9]+)?
00085 IDENT [a-zA-Z_][a-zA-Z_0-9]*
00086 %x STR COMMENT INCL INCL_FILE
00087 %%
00088 Include { BEGIN(INCL); }
00089 &lt;INCL&gt;{WHITESPACE} ;
00090 &lt;INCL&gt;\<span class="stringliteral">" { BEGIN(INCL_FILE); }</span>
00091 <span class="stringliteral">&lt;INCL&gt;. { ParseError( "</span>Illegal character following Include directive<span class="stringliteral">" ); }</span>
00092 <span class="stringliteral">&lt;INCL_FILE&gt;\" { BEGIN INITIAL; }</span>
00093 <span class="stringliteral">&lt;INCL_FILE&gt;. { ParseError( "</span>Illegal character in Include file name<span class="stringliteral">" ); }</span>
00094 <span class="stringliteral">&lt;INCL_FILE&gt;[\-a-zA-Z_\.0-9/ \t]+ {</span>
00095 <span class="stringliteral">        BEGIN(INITIAL);</span>
00096 <span class="stringliteral">        include_push(yytext);</span>
00097 <span class="stringliteral">}</span>
00098 <span class="stringliteral">"</span>#<span class="stringliteral">" { BEGIN COMMENT; }</span>
00099 <span class="stringliteral">&lt;COMMENT&gt;. /* eat it up */</span>
00100 <span class="stringliteral">&lt;COMMENT&gt;\n { line_num++; BEGIN INITIAL; }</span>
00101 <span class="stringliteral">Accelerator             { return ACCELERATOR; }</span>
00102 <span class="stringliteral">AreaLightSource         { return AREALIGHTSOURCE;       }</span>
00103 <span class="stringliteral">AttributeBegin          { return ATTRIBUTEBEGIN;        }</span>
00104 <span class="stringliteral">AttributeEnd            { return ATTRIBUTEEND;          }</span>
00105 <span class="stringliteral">Camera                  { return CAMERA;                }</span>
00106 <span class="stringliteral">ConcatTransform         { return CONCATTRANSFORM;       }</span>
00107 <span class="stringliteral">CoordinateSystem        { return COORDINATESYSTEM;      }</span>
00108 <span class="stringliteral">CoordSysTransform       { return COORDSYSTRANSFORM;     }</span>
00109 <span class="stringliteral">Film                    { return FILM;                  }</span>
00110 <span class="stringliteral">Identity                { return IDENTITY;              }</span>
00111 <span class="stringliteral">LightSource             { return LIGHTSOURCE;           }</span>
00112 <span class="stringliteral">LookAt                  { return LOOKAT;                }</span>
00113 <span class="stringliteral">Material                { return MATERIAL;              }</span>
00114 <span class="stringliteral">ObjectBegin             { return OBJECTBEGIN;           }</span>
00115 <span class="stringliteral">ObjectEnd               { return OBJECTEND;             }</span>
00116 <span class="stringliteral">ObjectInstance          { return OBJECTINSTANCE;        }</span>
00117 <span class="stringliteral">PixelFilter             { return PIXELFILTER;           }</span>
00118 <span class="stringliteral">ReverseOrientation      { return REVERSEORIENTATION;    }</span>
00119 <span class="stringliteral">Rotate                  { return ROTATE;                }</span>
00120 <span class="stringliteral">Sampler                 { return SAMPLER;               }</span>
00121 <span class="stringliteral">SearchPath              { return SEARCHPATH;            }</span>
00122 <span class="stringliteral">Scale                   { return SCALE;                 }</span>
00123 <span class="stringliteral">Shape                   { return SHAPE;                 }</span>
00124 <span class="stringliteral">SurfaceIntegrator       { return SURFACEINTEGRATOR;     }</span>
00125 <span class="stringliteral">Texture                 { return TEXTURE;               }</span>
00126 <span class="stringliteral">TransformBegin  { return TRANSFORMBEGIN;        }</span>
00127 <span class="stringliteral">TransformEnd    { return TRANSFORMEND;  }</span>
00128 <span class="stringliteral">Transform               { return TRANSFORM;             }</span>
00129 <span class="stringliteral">Translate               { return TRANSLATE;             }</span>
00130 <span class="stringliteral">Volume                  { return VOLUME;                }</span>
00131 <span class="stringliteral">VolumeIntegrator        { return VOLUMEINTEGRATOR;      }</span>
00132 <span class="stringliteral">WorldBegin              { return WORLDBEGIN;            }</span>
00133 <span class="stringliteral">WorldEnd                { return WORLDEND;              }</span>
00134 <span class="stringliteral">{WHITESPACE} /* do nothing */</span>
00135 <span class="stringliteral">\n { line_num++; }</span>
00136 <span class="stringliteral">{NUMBER} {</span>
00137 <span class="stringliteral">  yylval.num = (float) atof(yytext);</span>
00138 <span class="stringliteral">  return NUM;</span>
00139 <span class="stringliteral">}</span>
00140 <span class="stringliteral">{IDENT} {</span>
00141 <span class="stringliteral">        strcpy( yylval.string, yytext );</span>
00142 <span class="stringliteral">        return ID;</span>
00143 <span class="stringliteral">}</span>
00144 <span class="stringliteral">"</span>[<span class="stringliteral">" { return LBRACK; }</span>
00145 <span class="stringliteral">"</span>]<span class="stringliteral">" { return RBRACK; }</span>
00146 <span class="stringliteral">\" { BEGIN STR; str_pos = 0; }</span>
00147 <span class="stringliteral">&lt;STR&gt;\\n {add_string_char('\n');}</span>
00148 <span class="stringliteral">&lt;STR&gt;\\t {add_string_char('\t');}</span>
00149 <span class="stringliteral">&lt;STR&gt;\\r {add_string_char('\r');}</span>
00150 <span class="stringliteral">&lt;STR&gt;\\b {add_string_char('\b');}</span>
00151 <span class="stringliteral">&lt;STR&gt;\\f {add_string_char('\f');}</span>
00152 <span class="stringliteral">&lt;STR&gt;\\\" {add_string_char('\"');}</span>
00153 <span class="stringliteral">&lt;STR&gt;\\\\ {add_string_char('\\');}</span>
00154 <span class="stringliteral">&lt;STR&gt;\\[0-9]{3} {</span>
00155 <span class="stringliteral">  int val = atoi(yytext+1);</span>
00156 <span class="stringliteral">  while(val &gt; 256)</span>
00157 <span class="stringliteral">    val -= 256;</span>
00158 <span class="stringliteral">  add_string_char(val);</span>
00159 <span class="stringliteral">}</span>
00160 <span class="stringliteral">&lt;STR&gt;\\\n {line_num++;}</span>
00161 <span class="stringliteral">&lt;STR&gt;\\. { add_string_char(yytext[1]);}</span>
00162 <span class="stringliteral">&lt;STR&gt;\" {BEGIN INITIAL; return STRING;}</span>
00163 <span class="stringliteral">&lt;STR&gt;. {add_string_char(yytext[0]);}</span>
00164 <span class="stringliteral">&lt;STR&gt;\n {ParseError("</span>Unterminated string!<span class="stringliteral">");}</span>
00165 <span class="stringliteral"></span>
00166 <span class="stringliteral">. { ParseError( "</span>Illegal character: %c<span class="stringliteral">",yytext[0] ); }</span>
00167 <span class="stringliteral">%%</span>
00168 <span class="stringliteral">int yywrap(void)</span>
00169 <span class="stringliteral">{</span>
00170 <span class="stringliteral">        if (includeStack.size() ==0) return 1;</span>
00171 <span class="stringliteral">        include_pop();</span>
00172 <span class="stringliteral">        BEGIN(INCL_FILE);</span>
00173 <span class="stringliteral">        return 0;</span>
00174 <span class="stringliteral">}</span>
00175 <span class="stringliteral"></span>
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Mon Apr 25 19:00:23 2005 for pbrt by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
