<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>pbrt: dynload.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>dynload.cpp</h1><a href="dynload_8cpp.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 
00002 <span class="comment">/*</span>
00003 <span class="comment"> * pbrt source code Copyright(c) 1998-2005 Matt Pharr and Greg Humphreys</span>
00004 <span class="comment"> *</span>
00005 <span class="comment"> * All Rights Reserved.</span>
00006 <span class="comment"> * For educational use only; commercial use expressly forbidden.</span>
00007 <span class="comment"> * NO WARRANTY, express or implied, for this software.</span>
00008 <span class="comment"> * (See file License.txt for complete license)</span>
00009 <span class="comment"> */</span>
00010 
00011 <span class="comment">// dynload.cpp*</span>
00012 <span class="preprocessor">#include "<a class="code" href="dynload_8h.html">dynload.h</a>"</span>
00013 <span class="preprocessor">#include "<a class="code" href="paramset_8h.html">paramset.h</a>"</span>
00014 <span class="preprocessor">#include "<a class="code" href="shape_8h.html">shape.h</a>"</span>
00015 <span class="preprocessor">#include "<a class="code" href="material_8h.html">material.h</a>"</span>
00016 <span class="preprocessor">#ifndef WIN32</span>
00017 <span class="preprocessor"></span><span class="preprocessor">#ifndef __APPLE__</span>
00018 <span class="preprocessor"></span><span class="preprocessor">#include &lt;dlfcn.h&gt;</span>
00019 <span class="preprocessor">#else</span>
00020 <span class="preprocessor"></span><span class="preprocessor">#include &lt;mach-o/dyld.h&gt;</span>
00021 <span class="preprocessor">#endif</span>
00022 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00023 <span class="preprocessor"></span><span class="preprocessor">#include &lt;map&gt;</span>
00024 <span class="keyword">using</span> std::map;
00025 <span class="comment">// Runtime Loading Forward Declarations</span>
00026 <span class="keyword">static</span> string <a class="code" href="dynload_8cpp.html#a15">SearchPath</a>(<span class="keyword">const</span> string &amp;searchpath,  <span class="comment">// NOBOOK</span>
00027                          <span class="keyword">const</span> string &amp;filename); <span class="comment">// NOBOOK</span>
<a name="l00028"></a><a class="code" href="dynload_8cpp.html#a16">00028</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> D&gt; D *<a class="code" href="dynload_8cpp.html#a16">GetPlugin</a>(<span class="keyword">const</span> string &amp;name,
00029                 map&lt;string, D *&gt; &amp;loadedPlugins,
00030                 <span class="keyword">const</span> string &amp;searchPath) {
00031         <span class="keywordflow">if</span> (loadedPlugins.find(name) != loadedPlugins.end())
00032                 <span class="keywordflow">return</span> loadedPlugins[name];
00033         string filename = name;
00034         <span class="comment">// Add platform-specific shared library filename suffix</span>
00035 <span class="preprocessor">        #ifdef WIN32</span>
00036 <span class="preprocessor"></span>        filename += <span class="stringliteral">".dll"</span>;
00037 <span class="preprocessor">        #else</span>
00038 <span class="preprocessor"></span>        filename += <span class="stringliteral">".so"</span>;
00039 <span class="preprocessor">        #endif</span>
00040 <span class="preprocessor"></span>        string path = <a class="code" href="dynload_8cpp.html#a15">SearchPath</a>(searchPath, filename);
00041         D *plugin = NULL;
00042         <span class="keywordflow">if</span> (path != <span class="stringliteral">""</span>)
00043                 loadedPlugins[name] = plugin = <span class="keyword">new</span> D(path.c_str());
00044         <span class="keywordflow">else</span>
00045                 <a class="code" href="util_8cpp.html#a16">Error</a>(<span class="stringliteral">"Unable to find Plugin/DLL for \"%s\""</span>,
00046                         name.c_str());
00047         <span class="keywordflow">return</span> plugin;
00048 }
00049 <span class="keyword">class </span><a class="code" href="classShapePlugin.html">ShapePlugin</a>;
00050 <span class="keyword">class </span><a class="code" href="classFilterPlugin.html">FilterPlugin</a>;
00051 <span class="keyword">class </span><a class="code" href="classMaterialPlugin.html">MaterialPlugin</a>;
00052 <span class="keyword">class </span><a class="code" href="classTexturePlugin.html">TexturePlugin</a>;
00053 <span class="keyword">class </span><a class="code" href="classFilmPlugin.html">FilmPlugin</a>;
00054 <span class="keyword">class </span><a class="code" href="classLightPlugin.html">LightPlugin</a>;
00055 <span class="keyword">class </span><a class="code" href="classAreaLightPlugin.html">AreaLightPlugin</a>;
00056 <span class="keyword">class </span><a class="code" href="classVolumeRegionPlugin.html">VolumeRegionPlugin</a>;
00057 <span class="keyword">class </span><a class="code" href="classSurfaceIntegratorPlugin.html">SurfaceIntegratorPlugin</a>;
00058 <span class="keyword">class </span><a class="code" href="classVolumeIntegratorPlugin.html">VolumeIntegratorPlugin</a>;
00059 <span class="keyword">class </span><a class="code" href="classToneMapPlugin.html">ToneMapPlugin</a>;
00060 <span class="keyword">class </span><a class="code" href="classAcceleratorPlugin.html">AcceleratorPlugin</a>;
00061 <span class="keyword">class </span><a class="code" href="classCameraPlugin.html">CameraPlugin</a>;
00062 <span class="keyword">class </span><a class="code" href="classSamplerPlugin.html">SamplerPlugin</a>;
00063 <span class="keyword">static</span> string <a class="code" href="dynload_8cpp.html#a15">SearchPath</a>(<span class="keyword">const</span> string &amp;searchpath,
00064                          <span class="keyword">const</span> string &amp;filename);
00065 <span class="comment">// Runtime Loading Static Data</span>
<a name="l00066"></a><a class="code" href="dynload_8cpp.html#a0">00066</a> <span class="keyword">static</span> string <a class="code" href="dynload_8cpp.html#a0">PluginSearchPath</a>;
<a name="l00067"></a><a class="code" href="dynload_8cpp.html#a1">00067</a> <span class="keyword">static</span> map&lt;string, ShapePlugin *&gt; <a class="code" href="dynload_8cpp.html#a1">shapePlugins</a>;
<a name="l00068"></a><a class="code" href="dynload_8cpp.html#a2">00068</a> <span class="keyword">static</span> map&lt;string, FilterPlugin *&gt; <a class="code" href="dynload_8cpp.html#a2">filterPlugins</a>;
<a name="l00069"></a><a class="code" href="dynload_8cpp.html#a3">00069</a> <span class="keyword">static</span> map&lt;string, MaterialPlugin *&gt; <a class="code" href="dynload_8cpp.html#a3">materialPlugins</a>;
<a name="l00070"></a><a class="code" href="dynload_8cpp.html#a4">00070</a> <span class="keyword">static</span> map&lt;string, TexturePlugin *&gt; <a class="code" href="dynload_8cpp.html#a4">texturePlugins</a>;
<a name="l00071"></a><a class="code" href="dynload_8cpp.html#a5">00071</a> <span class="keyword">static</span> map&lt;string, FilmPlugin *&gt; <a class="code" href="dynload_8cpp.html#a5">filmPlugins</a>;
<a name="l00072"></a><a class="code" href="dynload_8cpp.html#a6">00072</a> <span class="keyword">static</span> map&lt;string, LightPlugin *&gt; <a class="code" href="dynload_8cpp.html#a6">lightPlugins</a>;
<a name="l00073"></a><a class="code" href="dynload_8cpp.html#a7">00073</a> <span class="keyword">static</span> map&lt;string, AreaLightPlugin *&gt; <a class="code" href="dynload_8cpp.html#a7">arealightPlugins</a>;
<a name="l00074"></a><a class="code" href="dynload_8cpp.html#a8">00074</a> <span class="keyword">static</span> map&lt;string, VolumeRegionPlugin *&gt; <a class="code" href="dynload_8cpp.html#a8">volumePlugins</a>;
<a name="l00075"></a><a class="code" href="dynload_8cpp.html#a9">00075</a> <span class="keyword">static</span> map&lt;string, SurfaceIntegratorPlugin *&gt; <a class="code" href="dynload_8cpp.html#a9">surf_integratorPlugins</a>;
<a name="l00076"></a><a class="code" href="dynload_8cpp.html#a10">00076</a> <span class="keyword">static</span> map&lt;string, VolumeIntegratorPlugin *&gt; <a class="code" href="dynload_8cpp.html#a10">vol_integratorPlugins</a>;
<a name="l00077"></a><a class="code" href="dynload_8cpp.html#a11">00077</a> <span class="keyword">static</span> map&lt;string, ToneMapPlugin *&gt; <a class="code" href="dynload_8cpp.html#a11">tonemapPlugins</a>;
<a name="l00078"></a><a class="code" href="dynload_8cpp.html#a12">00078</a> <span class="keyword">static</span> map&lt;string, AcceleratorPlugin *&gt; <a class="code" href="dynload_8cpp.html#a12">acceleratorPlugins</a>;
<a name="l00079"></a><a class="code" href="dynload_8cpp.html#a13">00079</a> <span class="keyword">static</span> map&lt;string, CameraPlugin *&gt; <a class="code" href="dynload_8cpp.html#a13">cameraPlugins</a>;
<a name="l00080"></a><a class="code" href="dynload_8cpp.html#a14">00080</a> <span class="keyword">static</span> map&lt;string, SamplerPlugin *&gt; <a class="code" href="dynload_8cpp.html#a14">samplerPlugins</a>;
00081 <span class="comment">// Runtime Loading Local Classes</span>
<a name="l00082"></a><a class="code" href="classPlugin.html">00082</a> <span class="keyword">class </span><a class="code" href="classPlugin.html">Plugin</a> {
00083 <span class="keyword">public</span>:
00084         <span class="comment">// Plugin Public Methods</span>
00085         <a class="code" href="classPlugin.html">Plugin</a>(<span class="keyword">const</span> string &amp;fname);
00086         <a class="code" href="classPlugin.html#a1">~Plugin</a>();
00087         <span class="keywordtype">void</span> *<a class="code" href="classPlugin.html#a2">GetSymbol</a>(<span class="keyword">const</span> string &amp;symname);
00088 <span class="keyword">private</span>:
00089         <span class="comment">// Plugin Private Data</span>
00090 <span class="preprocessor">        #if defined(WIN32)</span>
00091 <span class="preprocessor"></span>        HMODULE <a class="code" href="classPlugin.html#r0">hinstLib</a>;
00092 <span class="preprocessor">        #elif defined(__APPLE__)</span>
00093 <span class="preprocessor"></span>        NSModule <a class="code" href="classPlugin.html#r0">hinstLib</a>;
00094 <span class="preprocessor">        #else</span>
<a name="l00095"></a><a class="code" href="classPlugin.html#r0">00095</a> <span class="preprocessor"></span>        <span class="keywordtype">void</span> *<a class="code" href="classPlugin.html#r0">hinstLib</a>;
00096 <span class="preprocessor">        #endif</span>
<a name="l00097"></a><a class="code" href="classPlugin.html#r1">00097</a> <span class="preprocessor"></span>        string <a class="code" href="classPlugin.html#r1">pluginName</a>;
00098 };
<a name="l00099"></a><a class="code" href="classShapePlugin.html">00099</a> <span class="keyword">class </span><a class="code" href="classShapePlugin.html">ShapePlugin</a> : <span class="keyword">public</span> <a class="code" href="classPlugin.html">Plugin</a> {
00100 <span class="keyword">public</span>:
00101         <span class="comment">// ShapePlugin Constructor</span>
<a name="l00102"></a><a class="code" href="classShapePlugin.html#a0">00102</a>         <a class="code" href="classShapePlugin.html">ShapePlugin</a>(<span class="keyword">const</span> string &amp;name)
00103                 : <a class="code" href="classPlugin.html">Plugin</a>(name) {
00104                 <a class="code" href="classShapePlugin.html#o0">CreateShape</a> =
00105                         (<a class="code" href="classShapePlugin.html#w0">CreateShapeFunc</a>)(GetSymbol(<span class="stringliteral">"CreateShape"</span>));
00106         }
<a name="l00107"></a><a class="code" href="classShapePlugin.html#w0">00107</a>         <span class="keyword">typedef</span> <a class="code" href="classShape.html">Shape</a> * (*CreateShapeFunc)(<span class="keyword">const</span> <a class="code" href="classTransform.html">Transform</a> &amp;o2w,
00108                 <span class="keywordtype">bool</span> reverseOrientation, <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;params);
<a name="l00109"></a><a class="code" href="classShapePlugin.html#o0">00109</a>         <a class="code" href="classShapePlugin.html#w0">CreateShapeFunc</a> <a class="code" href="classShapePlugin.html#o0">CreateShape</a>;
<a name="l00110"></a><a class="code" href="classMaterialPlugin.html">00110</a> };
<a name="l00111"></a><a class="code" href="classMaterialPlugin.html#y0">00111</a> <span class="keyword">class </span><a class="code" href="classMaterialPlugin.html">MaterialPlugin</a> : <span class="keyword">public</span> <a class="code" href="classPlugin.html">Plugin</a> {
00112         <span class="keyword">typedef</span> <a class="code" href="classMaterial.html">Material</a> * (*CreateMaterialFunc)(<span class="keyword">const</span> <a class="code" href="classTransform.html">Transform</a> &amp;shader2world, <span class="keyword">const</span> <a class="code" href="classTextureParams.html">TextureParams</a> &amp;);
<a name="l00113"></a><a class="code" href="classMaterialPlugin.html#a0">00113</a> <span class="keyword">public</span>:
00114         <a class="code" href="classMaterialPlugin.html">MaterialPlugin</a>( <span class="keyword">const</span> string &amp;name ): <a class="code" href="classPlugin.html">Plugin</a>( name )
00115         {
00116                 <a class="code" href="classMaterialPlugin.html#o0">CreateMaterial</a> =
00117                         (<a class="code" href="classMaterialPlugin.html#y0">CreateMaterialFunc</a>)(GetSymbol(<span class="stringliteral">"CreateMaterial"</span>));
<a name="l00118"></a><a class="code" href="classMaterialPlugin.html#o0">00118</a>         }
00119         CreateMaterialFunc CreateMaterial;
<a name="l00120"></a><a class="code" href="classTexturePlugin.html">00120</a> };
00121 <span class="keyword">class </span><a class="code" href="classTexturePlugin.html">TexturePlugin</a> : <span class="keyword">public</span> <a class="code" href="classPlugin.html">Plugin</a> {
<a name="l00122"></a><a class="code" href="classTexturePlugin.html#y0">00122</a>         <span class="keyword">typedef</span> <a class="code" href="classTexture.html">Texture&lt;float&gt;</a> *
00123                 (*CreateFloatFunc)(<span class="keyword">const</span> <a class="code" href="classTransform.html">Transform</a> &amp;shader2world, <span class="keyword">const</span> <a class="code" href="classTextureParams.html">TextureParams</a> &amp;);
<a name="l00124"></a><a class="code" href="classTexturePlugin.html#y1">00124</a>         <span class="keyword">typedef</span> <a class="code" href="classTexture.html">Texture&lt;Spectrum&gt;</a> *
00125                 (*CreateSpectrumFunc)(<span class="keyword">const</span> <a class="code" href="classTransform.html">Transform</a> &amp;shader2world, <span class="keyword">const</span> <a class="code" href="classTextureParams.html">TextureParams</a> &amp;);
<a name="l00126"></a><a class="code" href="classTexturePlugin.html#a0">00126</a> <span class="keyword">public</span>:
00127         <a class="code" href="classTexturePlugin.html">TexturePlugin</a>( <span class="keyword">const</span> string &amp;name ): <a class="code" href="classPlugin.html">Plugin</a>( name )
00128         {
00129                 <a class="code" href="classTexturePlugin.html#o0">CreateFloatTex</a> =
00130                         (<a class="code" href="classTexture.html">CreateFloatFunc</a>)(GetSymbol(<span class="stringliteral">"CreateFloatTexture"</span>));
00131                 <a class="code" href="classTexturePlugin.html#o1">CreateSpectrumTex</a> =
00132                         (<a class="code" href="classTexture.html">CreateSpectrumFunc</a>)(GetSymbol(<span class="stringliteral">"CreateSpectrumTexture"</span>));
<a name="l00133"></a><a class="code" href="classTexturePlugin.html#o0">00133</a>         }
<a name="l00134"></a><a class="code" href="classTexturePlugin.html#o1">00134</a>         <a class="code" href="classTexture.html">CreateFloatFunc</a> <a class="code" href="classTexturePlugin.html#o0">CreateFloatTex</a>;
00135         <a class="code" href="classTexture.html">CreateSpectrumFunc</a> <a class="code" href="classTexturePlugin.html#o1">CreateSpectrumTex</a>;
<a name="l00136"></a><a class="code" href="classLightPlugin.html">00136</a> };
<a name="l00137"></a><a class="code" href="classLightPlugin.html#y0">00137</a> <span class="keyword">class </span><a class="code" href="classLightPlugin.html">LightPlugin</a> : <span class="keyword">public</span> <a class="code" href="classPlugin.html">Plugin</a> {
00138         <span class="keyword">typedef</span> <a class="code" href="classLight.html">Light</a> *(*CreateLightFunc)(
00139                 <span class="keyword">const</span> <a class="code" href="classTransform.html">Transform</a> &amp;light2world, <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;params);
<a name="l00140"></a><a class="code" href="classLightPlugin.html#a0">00140</a> <span class="keyword">public</span>:
00141         <a class="code" href="classLightPlugin.html">LightPlugin</a>( <span class="keyword">const</span> string &amp;name ): <a class="code" href="classPlugin.html">Plugin</a>( name )
00142         {
00143                 <a class="code" href="classLightPlugin.html#o0">CreateLight</a> =
00144                         (<a class="code" href="classLightPlugin.html#y0">CreateLightFunc</a>)(GetSymbol(<span class="stringliteral">"CreateLight"</span>));
<a name="l00145"></a><a class="code" href="classLightPlugin.html#o0">00145</a>         }
00146         CreateLightFunc CreateLight;
<a name="l00147"></a><a class="code" href="classVolumeRegionPlugin.html">00147</a> };
<a name="l00148"></a><a class="code" href="classVolumeRegionPlugin.html#y0">00148</a> <span class="keyword">class </span><a class="code" href="classVolumeRegionPlugin.html">VolumeRegionPlugin</a> : <span class="keyword">public</span> <a class="code" href="classPlugin.html">Plugin</a> {
00149         <span class="keyword">typedef</span> <a class="code" href="classVolumeRegion.html">VolumeRegion</a> *(*CreateVolumeFunc)(<span class="keyword">const</span> <a class="code" href="classTransform.html">Transform</a> &amp;volume2world,
00150                 <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;params);
<a name="l00151"></a><a class="code" href="classVolumeRegionPlugin.html#a0">00151</a> <span class="keyword">public</span>:
00152         <a class="code" href="classVolumeRegionPlugin.html">VolumeRegionPlugin</a>( <span class="keyword">const</span> string &amp;name ): <a class="code" href="classPlugin.html">Plugin</a>( name )
00153         {
00154                 <a class="code" href="classVolumeRegionPlugin.html#o0">CreateVolumeRegion</a> =
00155                         (<a class="code" href="classVolumeRegionPlugin.html#y0">CreateVolumeFunc</a>)(GetSymbol(<span class="stringliteral">"CreateVolumeRegion"</span>));
<a name="l00156"></a><a class="code" href="classVolumeRegionPlugin.html#o0">00156</a>         }
00157         CreateVolumeFunc CreateVolumeRegion;
<a name="l00158"></a><a class="code" href="classAreaLightPlugin.html">00158</a> };
<a name="l00159"></a><a class="code" href="classAreaLightPlugin.html#y0">00159</a> <span class="keyword">class </span><a class="code" href="classAreaLightPlugin.html">AreaLightPlugin</a> : <span class="keyword">public</span> <a class="code" href="classPlugin.html">Plugin</a> {
00160         <span class="keyword">typedef</span> <a class="code" href="classAreaLight.html">AreaLight</a> *(*CreateAreaLightFunc)(
00161                 <span class="keyword">const</span> <a class="code" href="classTransform.html">Transform</a> &amp;light2world, <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;params,
00162                 <span class="keyword">const</span> <a class="code" href="classReference.html">Reference&lt;Shape&gt;</a> &amp;shape);
<a name="l00163"></a><a class="code" href="classAreaLightPlugin.html#a0">00163</a> <span class="keyword">public</span>:
00164         <a class="code" href="classAreaLightPlugin.html">AreaLightPlugin</a>( <span class="keyword">const</span> string &amp;name ): <a class="code" href="classPlugin.html">Plugin</a>( name )
00165         {
00166                 <a class="code" href="classAreaLightPlugin.html#o0">CreateAreaLight</a> =
00167                         (<a class="code" href="classAreaLightPlugin.html#y0">CreateAreaLightFunc</a>)(GetSymbol(<span class="stringliteral">"CreateAreaLight"</span>));
<a name="l00168"></a><a class="code" href="classAreaLightPlugin.html#o0">00168</a>         }
00169         CreateAreaLightFunc CreateAreaLight;
<a name="l00170"></a><a class="code" href="classSurfaceIntegratorPlugin.html">00170</a> };
<a name="l00171"></a><a class="code" href="classSurfaceIntegratorPlugin.html#y0">00171</a> <span class="keyword">class </span><a class="code" href="classSurfaceIntegratorPlugin.html">SurfaceIntegratorPlugin</a> : <span class="keyword">public</span> <a class="code" href="classPlugin.html">Plugin</a> {
00172         <span class="keyword">typedef</span> <a class="code" href="classSurfaceIntegrator.html">SurfaceIntegrator</a> *(*CreateSurfaceIntegratorFunc)(<span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;params);
<a name="l00173"></a><a class="code" href="classSurfaceIntegratorPlugin.html#a0">00173</a> <span class="keyword">public</span>:
00174         <a class="code" href="classSurfaceIntegratorPlugin.html">SurfaceIntegratorPlugin</a>( <span class="keyword">const</span> string &amp;name ): <a class="code" href="classPlugin.html">Plugin</a>( name )
00175         {
00176                 <a class="code" href="classSurfaceIntegratorPlugin.html#o0">CreateSurfaceIntegrator</a> =
00177                         (<a class="code" href="classSurfaceIntegratorPlugin.html#y0">CreateSurfaceIntegratorFunc</a>)(GetSymbol(<span class="stringliteral">"CreateSurfaceIntegrator"</span>));
<a name="l00178"></a><a class="code" href="classSurfaceIntegratorPlugin.html#o0">00178</a>         }
00179         CreateSurfaceIntegratorFunc CreateSurfaceIntegrator;
<a name="l00180"></a><a class="code" href="classVolumeIntegratorPlugin.html">00180</a> };
<a name="l00181"></a><a class="code" href="classVolumeIntegratorPlugin.html#y0">00181</a> <span class="keyword">class </span><a class="code" href="classVolumeIntegratorPlugin.html">VolumeIntegratorPlugin</a> : <span class="keyword">public</span> <a class="code" href="classPlugin.html">Plugin</a> {
00182         <span class="keyword">typedef</span> <a class="code" href="classVolumeIntegrator.html">VolumeIntegrator</a> *(*CreateVolumeIntegratorFunc)(<span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;params);
<a name="l00183"></a><a class="code" href="classVolumeIntegratorPlugin.html#a0">00183</a> <span class="keyword">public</span>:
00184         <a class="code" href="classVolumeIntegratorPlugin.html">VolumeIntegratorPlugin</a>( <span class="keyword">const</span> string &amp;name ): <a class="code" href="classPlugin.html">Plugin</a>( name )
00185         {
00186                 <a class="code" href="classVolumeIntegratorPlugin.html#o0">CreateVolumeIntegrator</a> =
00187                         (<a class="code" href="classVolumeIntegratorPlugin.html#y0">CreateVolumeIntegratorFunc</a>)(GetSymbol(<span class="stringliteral">"CreateVolumeIntegrator"</span>));
<a name="l00188"></a><a class="code" href="classVolumeIntegratorPlugin.html#o0">00188</a>         }
00189         CreateVolumeIntegratorFunc CreateVolumeIntegrator;
<a name="l00190"></a><a class="code" href="classAcceleratorPlugin.html">00190</a> };
<a name="l00191"></a><a class="code" href="classAcceleratorPlugin.html#y0">00191</a> <span class="keyword">class </span><a class="code" href="classAcceleratorPlugin.html">AcceleratorPlugin</a> : <span class="keyword">public</span> <a class="code" href="classPlugin.html">Plugin</a> {
00192         <span class="keyword">typedef</span> <a class="code" href="classPrimitive.html">Primitive</a> *(*CreateAcceleratorFunc)(<span class="keyword">const</span> vector&lt;Reference&lt;Primitive&gt; &gt; &amp;prims, <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;params);
<a name="l00193"></a><a class="code" href="classAcceleratorPlugin.html#a0">00193</a> <span class="keyword">public</span>:
00194         <a class="code" href="classAcceleratorPlugin.html">AcceleratorPlugin</a>( <span class="keyword">const</span> string &amp;name ): <a class="code" href="classPlugin.html">Plugin</a>( name )
00195         {
00196                 <a class="code" href="classAcceleratorPlugin.html#o0">CreateAccelerator</a> =
00197                         (<a class="code" href="classAcceleratorPlugin.html#y0">CreateAcceleratorFunc</a>)(GetSymbol(<span class="stringliteral">"CreateAccelerator"</span>));
<a name="l00198"></a><a class="code" href="classAcceleratorPlugin.html#o0">00198</a>         }
00199         CreateAcceleratorFunc CreateAccelerator;
<a name="l00200"></a><a class="code" href="classSamplerPlugin.html">00200</a> };
<a name="l00201"></a><a class="code" href="classSamplerPlugin.html#y0">00201</a> <span class="keyword">class </span><a class="code" href="classSamplerPlugin.html">SamplerPlugin</a> : <span class="keyword">public</span> <a class="code" href="classPlugin.html">Plugin</a> {
00202         <span class="keyword">typedef</span> <a class="code" href="classSampler.html">Sampler</a> *(*CreateSamplerFunc)(<span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;params, <span class="keyword">const</span> <a class="code" href="classFilm.html">Film</a> *film);
<a name="l00203"></a><a class="code" href="classSamplerPlugin.html#a0">00203</a> <span class="keyword">public</span>:
00204         <a class="code" href="classSamplerPlugin.html">SamplerPlugin</a>( <span class="keyword">const</span> string &amp;name ): <a class="code" href="classPlugin.html">Plugin</a>( name )
00205         {
00206                 <a class="code" href="classSamplerPlugin.html#o0">CreateSampler</a> =
00207                         (<a class="code" href="classSamplerPlugin.html#y0">CreateSamplerFunc</a>)(GetSymbol(<span class="stringliteral">"CreateSampler"</span>));
<a name="l00208"></a><a class="code" href="classSamplerPlugin.html#o0">00208</a>         }
00209         CreateSamplerFunc CreateSampler;
<a name="l00210"></a><a class="code" href="classCameraPlugin.html">00210</a> };
<a name="l00211"></a><a class="code" href="classCameraPlugin.html#y0">00211</a> <span class="keyword">class </span><a class="code" href="classCameraPlugin.html">CameraPlugin</a> : <span class="keyword">public</span> <a class="code" href="classPlugin.html">Plugin</a> {
00212         <span class="keyword">typedef</span> <a class="code" href="classCamera.html">Camera</a> *(*CreateCameraFunc)(<span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;params, <span class="keyword">const</span> <a class="code" href="classTransform.html">Transform</a> &amp;world2cam, <a class="code" href="classFilm.html">Film</a> *film);
<a name="l00213"></a><a class="code" href="classCameraPlugin.html#a0">00213</a> <span class="keyword">public</span>:
00214         <a class="code" href="classCameraPlugin.html">CameraPlugin</a>( <span class="keyword">const</span> string &amp;name ): <a class="code" href="classPlugin.html">Plugin</a>( name )
00215         {
00216                 <a class="code" href="classCameraPlugin.html#o0">CreateCamera</a> =
00217                         (<a class="code" href="classCameraPlugin.html#y0">CreateCameraFunc</a>)(GetSymbol(<span class="stringliteral">"CreateCamera"</span>));
<a name="l00218"></a><a class="code" href="classCameraPlugin.html#o0">00218</a>         }
00219         CreateCameraFunc CreateCamera;
<a name="l00220"></a><a class="code" href="classFilterPlugin.html">00220</a> };
<a name="l00221"></a><a class="code" href="classFilterPlugin.html#y0">00221</a> <span class="keyword">class </span><a class="code" href="classFilterPlugin.html">FilterPlugin</a> : <span class="keyword">public</span> <a class="code" href="classPlugin.html">Plugin</a> {
00222         <span class="keyword">typedef</span> <a class="code" href="classFilter.html">Filter</a> *(*CreateFilterFunc)(<span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;params);
<a name="l00223"></a><a class="code" href="classFilterPlugin.html#a0">00223</a> <span class="keyword">public</span>:
00224         <a class="code" href="classFilterPlugin.html">FilterPlugin</a>( <span class="keyword">const</span> string &amp;name ): <a class="code" href="classPlugin.html">Plugin</a>( name ) {
00225                 <a class="code" href="classFilterPlugin.html#o0">CreateFilter</a> =
00226                         (<a class="code" href="classFilterPlugin.html#y0">CreateFilterFunc</a>)(GetSymbol(<span class="stringliteral">"CreateFilter"</span>));
<a name="l00227"></a><a class="code" href="classFilterPlugin.html#o0">00227</a>         }
00228         CreateFilterFunc CreateFilter;
<a name="l00229"></a><a class="code" href="classToneMapPlugin.html">00229</a> };
<a name="l00230"></a><a class="code" href="classToneMapPlugin.html#y0">00230</a> <span class="keyword">class </span><a class="code" href="classToneMapPlugin.html">ToneMapPlugin</a> : <span class="keyword">public</span> <a class="code" href="classPlugin.html">Plugin</a> {
00231         <span class="keyword">typedef</span> <a class="code" href="classToneMap.html">ToneMap</a> *(*CreateToneMapFunc)(<span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;params);
<a name="l00232"></a><a class="code" href="classToneMapPlugin.html#a0">00232</a> <span class="keyword">public</span>:
00233         <a class="code" href="classToneMapPlugin.html">ToneMapPlugin</a>( <span class="keyword">const</span> string &amp;name ): <a class="code" href="classPlugin.html">Plugin</a>( name ) {
00234                 <a class="code" href="classToneMapPlugin.html#o0">CreateToneMap</a> =
00235                         (<a class="code" href="classToneMapPlugin.html#y0">CreateToneMapFunc</a>)(GetSymbol(<span class="stringliteral">"CreateToneMap"</span>));
<a name="l00236"></a><a class="code" href="classToneMapPlugin.html#o0">00236</a>         }
00237         CreateToneMapFunc CreateToneMap;
<a name="l00238"></a><a class="code" href="classFilmPlugin.html">00238</a> };
<a name="l00239"></a><a class="code" href="classFilmPlugin.html#y0">00239</a> <span class="keyword">class </span><a class="code" href="classFilmPlugin.html">FilmPlugin</a> : <span class="keyword">public</span> <a class="code" href="classPlugin.html">Plugin</a> {
00240         <span class="keyword">typedef</span> <a class="code" href="classFilm.html">Film</a> *(*CreateFilmFunc)(<span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;params, <a class="code" href="classFilter.html">Filter</a> *filter);
<a name="l00241"></a><a class="code" href="classFilmPlugin.html#a0">00241</a> <span class="keyword">public</span>:
00242         <a class="code" href="classFilmPlugin.html">FilmPlugin</a>( <span class="keyword">const</span> string &amp;name ): <a class="code" href="classPlugin.html">Plugin</a>( name ) {
00243                 <a class="code" href="classFilmPlugin.html#o0">CreateFilm</a> =
00244                         (<a class="code" href="classFilmPlugin.html#y0">CreateFilmFunc</a>)(GetSymbol(<span class="stringliteral">"CreateFilm"</span>));
<a name="l00245"></a><a class="code" href="classFilmPlugin.html#o0">00245</a>         }
00246         CreateFilmFunc CreateFilm;
00247 };
<a name="l00248"></a><a class="code" href="dynload_8h.html#a0">00248</a> <span class="comment">// Runtime Loading Method Definitions</span>
00249 <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="dynload_8h.html#a0">UpdatePluginPath</a>(<span class="keyword">const</span> string &amp;newpath) {
00250         string ret;
00251         <span class="keywordflow">for</span> (<a class="code" href="pbrt_8h.html#a51">u_int</a> i = 0; i &lt; newpath.size(); ++i) {
00252                 <span class="keywordflow">if</span> (newpath[i] != <span class="charliteral">'&amp;'</span>)
00253                         ret += newpath[i];
00254                 <span class="keywordflow">else</span>
00255                         ret += <a class="code" href="dynload_8cpp.html#a0">PluginSearchPath</a>;
00256         }
00257         <a class="code" href="dynload_8cpp.html#a0">PluginSearchPath</a> = ret;
<a name="l00258"></a><a class="code" href="dynload_8h.html#a1">00258</a> }
00259 <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <a class="code" href="classReference.html">Reference&lt;Shape&gt;</a> <a class="code" href="dynload_8h.html#a1">MakeShape</a>(<span class="keyword">const</span> string &amp;name,
00260                 <span class="keyword">const</span> <a class="code" href="classTransform.html">Transform</a> &amp;object2world,
00261                 <span class="keywordtype">bool</span> reverseOrientation,
00262                 <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;paramSet) {
00263         <a class="code" href="classShapePlugin.html">ShapePlugin</a> *plugin =
00264                 GetPlugin&lt;ShapePlugin&gt;(name,
00265                                                            <a class="code" href="dynload_8cpp.html#a1">shapePlugins</a>,
00266                                                            <a class="code" href="dynload_8cpp.html#a0">PluginSearchPath</a>);
00267         <span class="keywordflow">if</span> (plugin)
00268                 <span class="keywordflow">return</span> plugin-&gt;<a class="code" href="classShapePlugin.html#o0">CreateShape</a>(object2world,
00269                                           reverseOrientation,
00270                                                                   paramSet);
00271         <span class="keywordflow">return</span> NULL;
<a name="l00272"></a><a class="code" href="dynload_8cpp.html#a15">00272</a> }
00273 <span class="keyword">static</span> string <a class="code" href="dynload_8cpp.html#a15">SearchPath</a>(<span class="keyword">const</span> string &amp;searchpath,
00274                 <span class="keyword">const</span> string &amp;filename) {
00275         <span class="keyword">const</span> <span class="keywordtype">char</span> *start = searchpath.c_str();
00276         <span class="keyword">const</span> <span class="keywordtype">char</span> *end = start;
00277         <span class="keywordflow">while</span> (*start) {
00278                 <span class="keywordflow">while</span> (*end &amp;&amp; *end != <a class="code" href="pbrt_8h.html#a3">PBRT_PATH_SEP</a>[0])
00279                         ++end;
00280                 string component(start, end);
00281 
00282                 string fn = component + <span class="stringliteral">"/"</span> + filename;
00283                 FILE *f = fopen(fn.c_str(), <span class="stringliteral">"r"</span>);
00284                 <span class="keywordflow">if</span> (f) {
00285                         fclose(f);
00286                         <span class="keywordflow">return</span> fn;
00287                 }
00288                 <span class="keywordflow">if</span> (*end == <a class="code" href="pbrt_8h.html#a3">PBRT_PATH_SEP</a>[0]) ++end;
00289                 start = end;
00290         }
00291         <span class="keywordflow">return</span> <span class="stringliteral">""</span>;
<a name="l00292"></a><a class="code" href="dynload_8h.html#a2">00292</a> }
00293 <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <a class="code" href="classReference.html">Reference&lt;Material&gt;</a> <a class="code" href="dynload_8h.html#a2">MakeMaterial</a>(<span class="keyword">const</span> string &amp;name,
00294                 <span class="keyword">const</span> <a class="code" href="classTransform.html">Transform</a> &amp;mtl2world,
00295                 <span class="keyword">const</span> <a class="code" href="classTextureParams.html">TextureParams</a> &amp;mp) {
00296         <a class="code" href="classMaterialPlugin.html">MaterialPlugin</a> *plugin = GetPlugin&lt;MaterialPlugin&gt;(name, <a class="code" href="dynload_8cpp.html#a3">materialPlugins</a>,
00297                 <a class="code" href="dynload_8cpp.html#a0">PluginSearchPath</a>);
00298         <span class="keywordflow">if</span> (plugin) {
00299                 <a class="code" href="classReference.html">Reference&lt;Material&gt;</a> ret =
00300                         plugin-&gt;<a class="code" href="classMaterialPlugin.html#o0">CreateMaterial</a>(mtl2world, mp);
00301                 mp.<a class="code" href="classTextureParams.html#a11">ReportUnused</a>();
00302                 <span class="keywordflow">return</span> ret;
00303         }
00304         <span class="keywordflow">return</span> NULL;
<a name="l00305"></a><a class="code" href="dynload_8h.html#a3">00305</a> }
00306 <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <a class="code" href="classReference.html">Reference&lt;Texture&lt;float&gt;</a> &gt; <a class="code" href="dynload_8h.html#a3">MakeFloatTexture</a>(<span class="keyword">const</span> string &amp;name,
00307                 <span class="keyword">const</span> <a class="code" href="classTransform.html">Transform</a> &amp;tex2world, <span class="keyword">const</span> <a class="code" href="classTextureParams.html">TextureParams</a> &amp;tp) {
00308         <a class="code" href="classTexturePlugin.html">TexturePlugin</a> *plugin = GetPlugin&lt;TexturePlugin&gt;(name, <a class="code" href="dynload_8cpp.html#a4">texturePlugins</a>,
00309                 <a class="code" href="dynload_8cpp.html#a0">PluginSearchPath</a>);
00310         <span class="keywordflow">if</span> (plugin) {
00311                 <a class="code" href="classReference.html">Reference&lt;Texture&lt;float&gt;</a> &gt; ret =
00312                         plugin-&gt;<a class="code" href="classTexturePlugin.html#o0">CreateFloatTex</a>(tex2world, tp);
00313                 tp.<a class="code" href="classTextureParams.html#a11">ReportUnused</a>();
00314                 <span class="keywordflow">return</span> ret;
00315         }
00316         <span class="keywordflow">return</span> NULL;
<a name="l00317"></a><a class="code" href="dynload_8h.html#a4">00317</a> }
00318 <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <a class="code" href="classReference.html">Reference&lt;Texture&lt;Spectrum&gt;</a> &gt; <a class="code" href="dynload_8h.html#a4">MakeSpectrumTexture</a>(<span class="keyword">const</span> string &amp;name,
00319                 <span class="keyword">const</span> <a class="code" href="classTransform.html">Transform</a> &amp;tex2world, <span class="keyword">const</span> <a class="code" href="classTextureParams.html">TextureParams</a> &amp;tp) {
00320         <a class="code" href="classTexturePlugin.html">TexturePlugin</a> *plugin = GetPlugin&lt;TexturePlugin&gt;(name, <a class="code" href="dynload_8cpp.html#a4">texturePlugins</a>,
00321                 <a class="code" href="dynload_8cpp.html#a0">PluginSearchPath</a>);
00322         <span class="keywordflow">if</span> (plugin) {
00323                 <a class="code" href="classReference.html">Reference&lt;Texture&lt;Spectrum&gt;</a> &gt; ret =
00324                         plugin-&gt;<a class="code" href="classTexturePlugin.html#o1">CreateSpectrumTex</a>(tex2world, tp);
00325                 tp.<a class="code" href="classTextureParams.html#a11">ReportUnused</a>();
00326                 <span class="keywordflow">return</span> ret;
00327         }
00328         <span class="keywordflow">return</span> NULL;
<a name="l00329"></a><a class="code" href="dynload_8h.html#a5">00329</a> }
00330 <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <a class="code" href="classLight.html">Light</a> *<a class="code" href="dynload_8h.html#a5">MakeLight</a>(<span class="keyword">const</span> string &amp;name,
00331                 <span class="keyword">const</span> <a class="code" href="classTransform.html">Transform</a> &amp;light2world, <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;paramSet) {
00332         <a class="code" href="classLightPlugin.html">LightPlugin</a> *plugin = GetPlugin&lt;LightPlugin&gt;(name, <a class="code" href="dynload_8cpp.html#a6">lightPlugins</a>, <a class="code" href="dynload_8cpp.html#a0">PluginSearchPath</a>);
00333         <span class="keywordflow">if</span> (plugin) {
00334                 <a class="code" href="classLight.html">Light</a> *ret = plugin-&gt;<a class="code" href="classLightPlugin.html#o0">CreateLight</a>(light2world, paramSet);
00335                 paramSet.<a class="code" href="classParamSet.html#a38">ReportUnused</a>();
00336                 <span class="keywordflow">return</span> ret;
00337         }
00338         <span class="keywordflow">return</span> NULL;
<a name="l00339"></a><a class="code" href="dynload_8h.html#a6">00339</a> }
00340 <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <a class="code" href="classAreaLight.html">AreaLight</a> *<a class="code" href="dynload_8h.html#a6">MakeAreaLight</a>(<span class="keyword">const</span> string &amp;name,
00341                 <span class="keyword">const</span> <a class="code" href="classTransform.html">Transform</a> &amp;light2world, <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;paramSet,
00342                 <span class="keyword">const</span> <a class="code" href="classReference.html">Reference&lt;Shape&gt;</a> &amp;shape) {
00343         <a class="code" href="classAreaLightPlugin.html">AreaLightPlugin</a> *plugin = GetPlugin&lt;AreaLightPlugin&gt;(name, <a class="code" href="dynload_8cpp.html#a7">arealightPlugins</a>,
00344                 <a class="code" href="dynload_8cpp.html#a0">PluginSearchPath</a>);
00345         <span class="keywordflow">if</span> (plugin) {
00346                 <a class="code" href="classAreaLight.html">AreaLight</a> *ret = plugin-&gt;<a class="code" href="classAreaLightPlugin.html#o0">CreateAreaLight</a>(light2world, paramSet, shape);
00347                 paramSet.<a class="code" href="classParamSet.html#a38">ReportUnused</a>();
00348                 <span class="keywordflow">return</span> ret;
00349         }
00350         <span class="keywordflow">return</span> NULL;
<a name="l00351"></a><a class="code" href="dynload_8h.html#a7">00351</a> }
00352 <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <a class="code" href="classVolumeRegion.html">VolumeRegion</a> *<a class="code" href="dynload_8h.html#a7">MakeVolumeRegion</a>(<span class="keyword">const</span> string &amp;name,
00353                 <span class="keyword">const</span> <a class="code" href="classTransform.html">Transform</a> &amp;volume2world, <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;paramSet) {
00354         <a class="code" href="classVolumeRegionPlugin.html">VolumeRegionPlugin</a> *plugin = GetPlugin&lt;VolumeRegionPlugin&gt;(name, <a class="code" href="dynload_8cpp.html#a8">volumePlugins</a>,
00355                 <a class="code" href="dynload_8cpp.html#a0">PluginSearchPath</a>);
00356         <span class="keywordflow">if</span> (plugin) {
00357                 <a class="code" href="classVolumeRegion.html">VolumeRegion</a> *ret = plugin-&gt;<a class="code" href="classVolumeRegionPlugin.html#o0">CreateVolumeRegion</a>(volume2world, paramSet);
00358                 paramSet.<a class="code" href="classParamSet.html#a38">ReportUnused</a>();
00359                 <span class="keywordflow">return</span> ret;
00360         }
00361         <span class="keywordflow">return</span> NULL;
<a name="l00362"></a><a class="code" href="dynload_8h.html#a8">00362</a> }
00363 <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <a class="code" href="classSurfaceIntegrator.html">SurfaceIntegrator</a> *<a class="code" href="dynload_8h.html#a8">MakeSurfaceIntegrator</a>(<span class="keyword">const</span> string &amp;name,
00364                 <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;paramSet) {
00365         <a class="code" href="classSurfaceIntegratorPlugin.html">SurfaceIntegratorPlugin</a> *plugin = GetPlugin&lt;SurfaceIntegratorPlugin&gt;(name,
00366                 <a class="code" href="dynload_8cpp.html#a9">surf_integratorPlugins</a>, <a class="code" href="dynload_8cpp.html#a0">PluginSearchPath</a>);
00367         <span class="keywordflow">if</span> (plugin) {
00368                 <a class="code" href="classSurfaceIntegrator.html">SurfaceIntegrator</a> *ret = plugin-&gt;<a class="code" href="classSurfaceIntegratorPlugin.html#o0">CreateSurfaceIntegrator</a>(paramSet);
00369                 paramSet.<a class="code" href="classParamSet.html#a38">ReportUnused</a>();
00370                 <span class="keywordflow">return</span> ret;
00371         }
00372         <span class="keywordflow">return</span> NULL;
<a name="l00373"></a><a class="code" href="dynload_8h.html#a9">00373</a> }
00374 <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <a class="code" href="classVolumeIntegrator.html">VolumeIntegrator</a> *<a class="code" href="dynload_8h.html#a9">MakeVolumeIntegrator</a>(<span class="keyword">const</span> string &amp;name,
00375                 <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;paramSet) {
00376         <a class="code" href="classVolumeIntegratorPlugin.html">VolumeIntegratorPlugin</a> *plugin = GetPlugin&lt;VolumeIntegratorPlugin&gt;(name, <a class="code" href="dynload_8cpp.html#a10">vol_integratorPlugins</a>,
00377                 <a class="code" href="dynload_8cpp.html#a0">PluginSearchPath</a>);
00378         <span class="keywordflow">if</span> (plugin) {
00379                 <a class="code" href="classVolumeIntegrator.html">VolumeIntegrator</a> *ret = plugin-&gt;<a class="code" href="classVolumeIntegratorPlugin.html#o0">CreateVolumeIntegrator</a>(paramSet);
00380                 paramSet.<a class="code" href="classParamSet.html#a38">ReportUnused</a>();
00381                 <span class="keywordflow">return</span> ret;
00382         }
00383         <span class="keywordflow">return</span> NULL;
<a name="l00384"></a><a class="code" href="dynload_8h.html#a10">00384</a> }
00385 <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <a class="code" href="classPrimitive.html">Primitive</a> *<a class="code" href="dynload_8h.html#a10">MakeAccelerator</a>(<span class="keyword">const</span> string &amp;name,
00386                 <span class="keyword">const</span> vector&lt;<a class="code" href="classReference.html">Reference&lt;Primitive&gt;</a> &gt; &amp;prims,
00387                 <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;paramSet) {
00388         <a class="code" href="classAcceleratorPlugin.html">AcceleratorPlugin</a> *plugin = GetPlugin&lt;AcceleratorPlugin&gt;(name, <a class="code" href="dynload_8cpp.html#a12">acceleratorPlugins</a>,
00389                 <a class="code" href="dynload_8cpp.html#a0">PluginSearchPath</a>);
00390         <span class="keywordflow">if</span> (plugin) {
00391                 <a class="code" href="classPrimitive.html">Primitive</a> *ret = plugin-&gt;<a class="code" href="classAcceleratorPlugin.html#o0">CreateAccelerator</a>(prims, paramSet);
00392                 paramSet.<a class="code" href="classParamSet.html#a38">ReportUnused</a>();
00393                 <span class="keywordflow">return</span> ret;
00394         }
00395         <span class="keywordflow">return</span> NULL;
<a name="l00396"></a><a class="code" href="dynload_8h.html#a11">00396</a> }
00397 <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <a class="code" href="classCamera.html">Camera</a> *<a class="code" href="dynload_8h.html#a11">MakeCamera</a>(<span class="keyword">const</span> string &amp;name,
00398                 <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;paramSet,
00399                 <span class="keyword">const</span> <a class="code" href="classTransform.html">Transform</a> &amp;world2cam, <a class="code" href="classFilm.html">Film</a> *film) {
00400         <a class="code" href="classCameraPlugin.html">CameraPlugin</a> *plugin = GetPlugin&lt;CameraPlugin&gt;(name, <a class="code" href="dynload_8cpp.html#a13">cameraPlugins</a>, <a class="code" href="dynload_8cpp.html#a0">PluginSearchPath</a>);
00401         <span class="keywordflow">if</span> (plugin) {
00402                 <a class="code" href="classCamera.html">Camera</a> *ret = plugin-&gt;<a class="code" href="classCameraPlugin.html#o0">CreateCamera</a>(paramSet, world2cam, film);
00403                 paramSet.<a class="code" href="classParamSet.html#a38">ReportUnused</a>();
00404                 <span class="keywordflow">return</span> ret;
00405         }
00406         <span class="keywordflow">return</span> NULL;
<a name="l00407"></a><a class="code" href="dynload_8h.html#a12">00407</a> }
00408 <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <a class="code" href="classSampler.html">Sampler</a> *<a class="code" href="dynload_8h.html#a12">MakeSampler</a>(<span class="keyword">const</span> string &amp;name,
00409                 <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;paramSet, <span class="keyword">const</span> <a class="code" href="classFilm.html">Film</a> *film) {
00410         <a class="code" href="classSamplerPlugin.html">SamplerPlugin</a> *plugin = GetPlugin&lt;SamplerPlugin&gt;(name, <a class="code" href="dynload_8cpp.html#a14">samplerPlugins</a>, <a class="code" href="dynload_8cpp.html#a0">PluginSearchPath</a>);
00411         <span class="keywordflow">if</span> (plugin) {
00412                 <a class="code" href="classSampler.html">Sampler</a> *ret = plugin-&gt;<a class="code" href="classSamplerPlugin.html#o0">CreateSampler</a>(paramSet, film);
00413                 paramSet.<a class="code" href="classParamSet.html#a38">ReportUnused</a>();
00414                 <span class="keywordflow">return</span> ret;
00415         }
00416         <span class="keywordflow">return</span> NULL;
<a name="l00417"></a><a class="code" href="dynload_8h.html#a13">00417</a> }
00418 <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <a class="code" href="classFilter.html">Filter</a> *<a class="code" href="dynload_8h.html#a13">MakeFilter</a>(<span class="keyword">const</span> string &amp;name,
00419         <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;paramSet) {
00420         <a class="code" href="classFilterPlugin.html">FilterPlugin</a> *plugin = GetPlugin&lt;FilterPlugin&gt;(name, <a class="code" href="dynload_8cpp.html#a2">filterPlugins</a>, <a class="code" href="dynload_8cpp.html#a0">PluginSearchPath</a>);
00421         <span class="keywordflow">if</span> (plugin) {
00422                 <a class="code" href="classFilter.html">Filter</a> *ret = plugin-&gt;<a class="code" href="classFilterPlugin.html#o0">CreateFilter</a>(paramSet);
00423                 paramSet.<a class="code" href="classParamSet.html#a38">ReportUnused</a>();
00424                 <span class="keywordflow">return</span> ret;
00425         }
00426         <span class="keywordflow">return</span> NULL;
<a name="l00427"></a><a class="code" href="dynload_8h.html#a14">00427</a> }
00428 <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <a class="code" href="classToneMap.html">ToneMap</a> *<a class="code" href="dynload_8h.html#a14">MakeToneMap</a>(<span class="keyword">const</span> string &amp;name,
00429         <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;paramSet) {
00430         <a class="code" href="classToneMapPlugin.html">ToneMapPlugin</a> *plugin = GetPlugin&lt;ToneMapPlugin&gt;(name, <a class="code" href="dynload_8cpp.html#a11">tonemapPlugins</a>, <a class="code" href="dynload_8cpp.html#a0">PluginSearchPath</a>);
00431         <span class="keywordflow">if</span> (plugin) {
00432                 <a class="code" href="classToneMap.html">ToneMap</a> *ret = plugin-&gt;<a class="code" href="classToneMapPlugin.html#o0">CreateToneMap</a>(paramSet);
00433                 paramSet.<a class="code" href="classParamSet.html#a38">ReportUnused</a>();
00434                 <span class="keywordflow">return</span> ret;
00435         }
00436         <span class="keywordflow">return</span> NULL;
<a name="l00437"></a><a class="code" href="dynload_8h.html#a15">00437</a> }
00438 <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <a class="code" href="classFilm.html">Film</a> *<a class="code" href="dynload_8h.html#a15">MakeFilm</a>(<span class="keyword">const</span> string &amp;name,
00439         <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;paramSet, <a class="code" href="classFilter.html">Filter</a> *filter) {
00440         <a class="code" href="classFilmPlugin.html">FilmPlugin</a> *plugin = GetPlugin&lt;FilmPlugin&gt;(name, <a class="code" href="dynload_8cpp.html#a5">filmPlugins</a>, <a class="code" href="dynload_8cpp.html#a0">PluginSearchPath</a>);
00441         <span class="keywordflow">if</span> (plugin) {
00442                 <a class="code" href="classFilm.html">Film</a> *ret = plugin-&gt;<a class="code" href="classFilmPlugin.html#o0">CreateFilm</a>(paramSet, filter);
00443                 paramSet.<a class="code" href="classParamSet.html#a38">ReportUnused</a>();
00444                 <span class="keywordflow">return</span> ret;
00445         }
00446         <span class="keywordflow">return</span> NULL;
00447 }
<a name="l00448"></a><a class="code" href="classPlugin.html#a0">00448</a> <span class="comment">// Plugin Method Definitions</span>
00449 <a class="code" href="classPlugin.html#a0">Plugin::Plugin</a>(<span class="keyword">const</span> string &amp;fname) {
00450         <a class="code" href="classPlugin.html#r1">pluginName</a> = fname;
00451 <span class="preprocessor">#if defined(WIN32)</span>
00452 <span class="preprocessor"></span>        <a class="code" href="classPlugin.html#r0">hinstLib</a> = LoadLibrary(fname.c_str());
00453         <span class="keywordflow">if</span> (!<a class="code" href="classPlugin.html#r0">hinstLib</a>)
00454                 <a class="code" href="util_8cpp.html#a16">Error</a>(<span class="stringliteral">"Can't open plug-in \"%s\""</span>, fname.c_str());
00455 <span class="preprocessor">#elif defined(__APPLE__)</span>
00456 <span class="preprocessor"></span>        NSObjectFileImage fileImage;
00457         NSObjectFileImageReturnCode returnCode =
00458                 NSCreateObjectFileImageFromFile(fname.c_str(), &amp;fileImage);
00459         <span class="keywordflow">if</span>(returnCode == NSObjectFileImageSuccess) {
00460                 <a class="code" href="classPlugin.html#r0">hinstLib</a> = NSLinkModule(fileImage,fname.c_str(),
00461                         NSLINKMODULE_OPTION_RETURN_ON_ERROR
00462                      |  NSLINKMODULE_OPTION_PRIVATE);
00463                 NSDestroyObjectFileImage(fileImage);
00464                 <span class="keywordflow">if</span> (!<a class="code" href="classPlugin.html#r0">hinstLib</a>) {
00465                         <a class="code" href="util_8cpp.html#a16">Error</a>(<span class="stringliteral">"Can't open plug-in \"%s\""</span>, fname.c_str());
00466                 }
00467         }
00468         <span class="keywordflow">else</span> {
00469                 <a class="code" href="util_8cpp.html#a16">Error</a>(<span class="stringliteral">"Can't open plug-in \"%s\""</span>, fname.c_str());
00470         }
00471 <span class="preprocessor">#else</span>
00472 <span class="preprocessor"></span>        <a class="code" href="classPlugin.html#r0">hinstLib</a> = dlopen(fname.c_str(), RTLD_LAZY);
00473         <span class="keywordflow">if</span> (!<a class="code" href="classPlugin.html#r0">hinstLib</a>)
00474                 <a class="code" href="util_8cpp.html#a16">Error</a>(<span class="stringliteral">"Can't open plug-in \"%s\" (%s)"</span>, fname.c_str(),
00475                         dlerror());
00476 <span class="preprocessor">#endif</span>
<a name="l00477"></a><a class="code" href="classPlugin.html#a1">00477</a> <span class="preprocessor"></span>}
00478 <a class="code" href="classPlugin.html#a1">Plugin::~Plugin</a>() {
00479 <span class="preprocessor">#if defined(WIN32)</span>
00480 <span class="preprocessor"></span>        FreeLibrary(hinstLib);
00481 <span class="preprocessor">#elif defined(__APPLE__)</span>
00482 <span class="preprocessor"></span>        NSUnLinkModule(hinstLib,0);
00483 <span class="preprocessor">#else</span>
00484 <span class="preprocessor"></span>        dlclose(hinstLib);
00485 <span class="preprocessor">#endif</span>
<a name="l00486"></a><a class="code" href="classPlugin.html#a2">00486</a> <span class="preprocessor"></span>}
00487 <span class="keywordtype">void</span> *Plugin::GetSymbol(<span class="keyword">const</span> string &amp;symname) {
00488         <span class="keywordtype">void</span> *data;
00489 <span class="preprocessor">#if defined(WIN32)</span>
00490 <span class="preprocessor"></span>        data = GetProcAddress(hinstLib, symname.c_str());
00491 <span class="preprocessor">#elif defined(__APPLE__)</span>
00492 <span class="preprocessor"></span>        string apple_lossage = string(<span class="stringliteral">"_"</span>) + symname;
00493         NSSymbol nssym = NSLookupSymbolInModule(hinstLib,apple_lossage.c_str());
00494         data = NSAddressOfSymbol(nssym);
00495 <span class="preprocessor">#else</span>
00496 <span class="preprocessor"></span>        data = dlsym(hinstLib, symname.c_str());
00497 <span class="preprocessor">#endif</span>
00498 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (!data)
00499                 <a class="code" href="util_8cpp.html#a17">Severe</a>(<span class="stringliteral">"Couldn't get symbol \"%s\" in Plugin %s."</span>, symname.c_str(), pluginName.c_str());
00500         <span class="keywordflow">return</span> data;
00501 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Mon Apr 25 19:00:20 2005 for pbrt by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
