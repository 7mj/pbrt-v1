<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>pbrt: sampling.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>sampling.cpp</h1><a href="sampling_8cpp.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 
00002 <span class="comment">/*</span>
00003 <span class="comment"> * pbrt source code Copyright(c) 1998-2005 Matt Pharr and Greg Humphreys</span>
00004 <span class="comment"> *</span>
00005 <span class="comment"> * All Rights Reserved.</span>
00006 <span class="comment"> * For educational use only; commercial use expressly forbidden.</span>
00007 <span class="comment"> * NO WARRANTY, express or implied, for this software.</span>
00008 <span class="comment"> * (See file License.txt for complete license)</span>
00009 <span class="comment"> */</span>
00010 
00011 <span class="comment">// sampling.cpp*</span>
00012 <span class="preprocessor">#include "<a class="code" href="pbrt_8h.html">pbrt.h</a>"</span>
00013 <span class="preprocessor">#include "<a class="code" href="sampling_8h.html">sampling.h</a>"</span>
00014 <span class="preprocessor">#include "<a class="code" href="transport_8h.html">transport.h</a>"</span>
00015 <span class="preprocessor">#include "<a class="code" href="volume_8h.html">volume.h</a>"</span>
00016 <span class="comment">// Sampler Method Definitions</span>
<a name="l00017"></a><a class="code" href="classSampler.html#a0">00017</a> <a class="code" href="classSampler.html#a0">Sampler::~Sampler</a>() {
00018 }
<a name="l00019"></a><a class="code" href="classSampler.html#a1">00019</a> <a class="code" href="classSampler.html#a1">Sampler::Sampler</a>(<span class="keywordtype">int</span> xstart, <span class="keywordtype">int</span> xend, <span class="keywordtype">int</span> ystart, <span class="keywordtype">int</span> yend,
00020                 <span class="keywordtype">int</span> spp) {
00021         <a class="code" href="classSampler.html#o0">xPixelStart</a> = xstart;
00022         <a class="code" href="classSampler.html#o1">xPixelEnd</a> = xend;
00023         <a class="code" href="classSampler.html#o2">yPixelStart</a> = ystart;
00024         <a class="code" href="classSampler.html#o3">yPixelEnd</a> = yend;
00025         <a class="code" href="classSampler.html#o4">samplesPerPixel</a> = spp;
00026 }
00027 <span class="comment">// Sample Method Definitions</span>
<a name="l00028"></a><a class="code" href="structSample.html#a0">00028</a> <a class="code" href="structSample.html#a0">Sample::Sample</a>(<a class="code" href="classSurfaceIntegrator.html">SurfaceIntegrator</a> *surf,
00029                 <a class="code" href="classVolumeIntegrator.html">VolumeIntegrator</a> *vol, <span class="keyword">const</span> <a class="code" href="classScene.html">Scene</a> *scene) {
00030         surf-&gt;<a class="code" href="classIntegrator.html#a3">RequestSamples</a>(<span class="keyword">this</span>, scene);
00031         vol-&gt;<a class="code" href="classIntegrator.html#a3">RequestSamples</a>(<span class="keyword">this</span>, scene);
00032         <span class="comment">// Allocate storage for sample pointers</span>
00033         <span class="keywordtype">int</span> nPtrs = <a class="code" href="structSample.html#o5">n1D</a>.size() + <a class="code" href="structSample.html#o6">n2D</a>.size();
00034         <span class="keywordflow">if</span> (!nPtrs) {
00035                 <a class="code" href="structSample.html#o7">oneD</a> = <a class="code" href="structSample.html#o8">twoD</a> = NULL;
00036                 <span class="keywordflow">return</span>;
00037         }
00038         <a class="code" href="structSample.html#o7">oneD</a> = (<span class="keywordtype">float</span> **)<a class="code" href="util_8cpp.html#a28">AllocAligned</a>(nPtrs * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span> *));
00039         <a class="code" href="structSample.html#o8">twoD</a> = <a class="code" href="structSample.html#o7">oneD</a> + <a class="code" href="structSample.html#o5">n1D</a>.size();
00040         <span class="comment">// Compute total number of sample values needed</span>
00041         <span class="keywordtype">int</span> totSamples = 0;
00042         <span class="keywordflow">for</span> (<a class="code" href="pbrt_8h.html#a51">u_int</a> i = 0; i &lt; <a class="code" href="structSample.html#o5">n1D</a>.size(); ++i)
00043                 totSamples += <a class="code" href="structSample.html#o5">n1D</a>[i];
00044         <span class="keywordflow">for</span> (<a class="code" href="pbrt_8h.html#a51">u_int</a> i = 0; i &lt; <a class="code" href="structSample.html#o6">n2D</a>.size(); ++i)
00045                 totSamples += 2 * <a class="code" href="structSample.html#o6">n2D</a>[i];
00046         <span class="comment">// Allocate storage for sample values</span>
00047         <span class="keywordtype">float</span> *mem = (<span class="keywordtype">float</span> *)<a class="code" href="util_8cpp.html#a28">AllocAligned</a>(totSamples *
00048                 <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));
00049         <span class="keywordflow">for</span> (<a class="code" href="pbrt_8h.html#a51">u_int</a> i = 0; i &lt; n1D.size(); ++i) {
00050                 <a class="code" href="structSample.html#o7">oneD</a>[i] = mem;
00051                 mem += n1D[i];
00052         }
00053         <span class="keywordflow">for</span> (<a class="code" href="pbrt_8h.html#a51">u_int</a> i = 0; i &lt; n2D.size(); ++i) {
00054                 <a class="code" href="structSample.html#o8">twoD</a>[i] = mem;
00055                 mem += 2 * n2D[i];
00056         }
00057 }
00058 <span class="comment">// Sampling Function Definitions</span>
<a name="l00059"></a><a class="code" href="sampling_8h.html#a0">00059</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="sampling_8h.html#a0">StratifiedSample1D</a>(<span class="keywordtype">float</span> *samp, <span class="keywordtype">int</span> nSamples,
00060                 <span class="keywordtype">bool</span> jitter) {
00061         <span class="keywordtype">float</span> invTot = 1.f / nSamples;
00062         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0;  i &lt; nSamples; ++i) {
00063                 <span class="keywordtype">float</span> delta = jitter ? <a class="code" href="pbrt_8h.html#a108">RandomFloat</a>() : 0.5f;
00064                 *samp++ = (i + delta) * invTot;
00065         }
00066 }
<a name="l00067"></a><a class="code" href="sampling_8h.html#a1">00067</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="sampling_8h.html#a1">StratifiedSample2D</a>(<span class="keywordtype">float</span> *samp, <span class="keywordtype">int</span> nx, <span class="keywordtype">int</span> ny,
00068                 <span class="keywordtype">bool</span> jitter) {
00069         <span class="keywordtype">float</span> dx = 1.f / nx, dy = 1.f / ny;
00070         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y = 0; y &lt; ny; ++y)
00071                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x = 0; x &lt; nx; ++x) {
00072                         <span class="keywordtype">float</span> jx = jitter ? <a class="code" href="pbrt_8h.html#a108">RandomFloat</a>() : 0.5f;
00073                         <span class="keywordtype">float</span> jy = jitter ? <a class="code" href="pbrt_8h.html#a108">RandomFloat</a>() : 0.5f;
00074                         *samp++ = (x + jx) * dx;
00075                         *samp++ = (y + jy) * dy;
00076                 }
00077 }
<a name="l00078"></a><a class="code" href="sampling_8h.html#a2">00078</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="sampling_8h.html#a2">Shuffle</a>(<span class="keywordtype">float</span> *samp, <span class="keywordtype">int</span> count, <span class="keywordtype">int</span> dims) {
00079         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; count; ++i) {
00080                 <a class="code" href="pbrt_8h.html#a51">u_int</a> other = <a class="code" href="pbrt_8h.html#a109">RandomUInt</a>() % count;
00081                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; dims; ++j)
00082                         swap(samp[dims*i + j], samp[dims*other + j]);
00083         }
00084 }
<a name="l00085"></a><a class="code" href="sampling_8h.html#a3">00085</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="sampling_8h.html#a3">LatinHypercube</a>(<span class="keywordtype">float</span> *samples,
00086                              <span class="keywordtype">int</span> nSamples, <span class="keywordtype">int</span> nDim) {
00087         <span class="comment">// Generate LHS samples along diagonal</span>
00088         <span class="keywordtype">float</span> delta = 1.f / nSamples;
00089         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nSamples; ++i)
00090                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; nDim; ++j)
00091                         samples[nDim * i + j] = (i + <a class="code" href="pbrt_8h.html#a108">RandomFloat</a>()) * delta;
00092         <span class="comment">// Permute LHS samples in each dimension</span>
00093         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nDim; ++i) {
00094                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; nSamples; ++j) {
00095                         <a class="code" href="pbrt_8h.html#a51">u_int</a> other = <a class="code" href="pbrt_8h.html#a109">RandomUInt</a>() % nSamples;
00096                         swap(samples[nDim * j + i],
00097                              samples[nDim * other + i]);
00098                 }
00099         }
00100 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Mon Apr 25 19:00:24 2005 for pbrt by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
