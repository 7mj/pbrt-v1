<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>pbrt: debug.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>debug.cpp</h1><a href="debug_8cpp.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 
00002 <span class="comment">/*</span>
00003 <span class="comment"> * pbrt source code Copyright(c) 1998-2005 Matt Pharr and Greg Humphreys</span>
00004 <span class="comment"> *</span>
00005 <span class="comment"> * All Rights Reserved.</span>
00006 <span class="comment"> * For educational use only; commercial use expressly forbidden.</span>
00007 <span class="comment"> * NO WARRANTY, express or implied, for this software.</span>
00008 <span class="comment"> * (See file License.txt for complete license)</span>
00009 <span class="comment"> */</span>
00010 
00011 <span class="comment">// debug.cpp*</span>
00012 <span class="comment">// Debug integrator by Greg Humphreys</span>
00013 
00014 <span class="comment">// debug.cpp*</span>
00015 
00016 <span class="preprocessor">#include "<a class="code" href="pbrt_8h.html">pbrt.h</a>"</span>
00017 <span class="preprocessor">#include "<a class="code" href="transport_8h.html">transport.h</a>"</span>
00018 <span class="preprocessor">#include "<a class="code" href="scene_8h.html">scene.h</a>"</span>
00019 
<a name="l00020"></a><a class="code" href="debug_8cpp.html#a12">00020</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> {
00021         <a class="code" href="debug_8cpp.html#a12a0">DEBUG_U</a>, <a class="code" href="debug_8cpp.html#a12a1">DEBUG_V</a>,
00022         <a class="code" href="debug_8cpp.html#a12a2">DEBUG_GEOM_NORMAL_X</a>,
00023         <a class="code" href="debug_8cpp.html#a12a3">DEBUG_GEOM_NORMAL_Y</a>,
00024         <a class="code" href="debug_8cpp.html#a12a4">DEBUG_GEOM_NORMAL_Z</a>,
00025         <a class="code" href="debug_8cpp.html#a12a5">DEBUG_SHAD_NORMAL_X</a>,
00026         <a class="code" href="debug_8cpp.html#a12a6">DEBUG_SHAD_NORMAL_Y</a>,
00027         <a class="code" href="debug_8cpp.html#a12a7">DEBUG_SHAD_NORMAL_Z</a>,
00028         <a class="code" href="debug_8cpp.html#a12a8">DEBUG_ONE</a>,
00029         <a class="code" href="debug_8cpp.html#a12a9">DEBUG_ZERO</a>,
00030         <a class="code" href="debug_8cpp.html#a12a10">DEBUG_HIT_SOMETHING</a>
00031 } <a class="code" href="debug_8cpp.html#a12">DebugVariable</a>;
00032 
<a name="l00033"></a><a class="code" href="classDebugIntegrator.html">00033</a> <span class="keyword">class </span><a class="code" href="classDebugIntegrator.html">DebugIntegrator</a> : <span class="keyword">public</span> <a class="code" href="classSurfaceIntegrator.html">SurfaceIntegrator</a> {
00034 <span class="keyword">public</span>:
00035         <span class="comment">// DebugIntegrator Public Methods</span>
00036         <a class="code" href="classSpectrum.html">Spectrum</a> <a class="code" href="classDebugIntegrator.html#a0">Li</a>(<span class="keyword">const</span> <a class="code" href="classScene.html">Scene</a> *scene, <span class="keyword">const</span> <a class="code" href="classRayDifferential.html">RayDifferential</a> &amp;ray,
00037                         <span class="keyword">const</span> <a class="code" href="structSample.html">Sample</a> *sample, <span class="keywordtype">float</span> *alpha) <span class="keyword">const</span>;
<a name="l00038"></a><a class="code" href="classDebugIntegrator.html#a1">00038</a>         <a class="code" href="classDebugIntegrator.html">DebugIntegrator</a>( DebugVariable v[3] )
00039         {
00040                 <a class="code" href="classDebugIntegrator.html#r0">debug_variable</a>[0] = v[0];
00041                 <a class="code" href="classDebugIntegrator.html#r0">debug_variable</a>[1] = v[1];
00042                 <a class="code" href="classDebugIntegrator.html#r0">debug_variable</a>[2] = v[2];
00043         }
00044 <span class="keyword">private</span>:
<a name="l00045"></a><a class="code" href="classDebugIntegrator.html#r0">00045</a>         <a class="code" href="debug_8cpp.html#a12">DebugVariable</a> <a class="code" href="classDebugIntegrator.html#r0">debug_variable</a>[3];
00046 };
00047 
<a name="l00048"></a><a class="code" href="classDebugIntegrator.html#a0">00048</a> <a class="code" href="classSpectrum.html">Spectrum</a> <a class="code" href="classDebugIntegrator.html#a0">DebugIntegrator::Li</a>(<span class="keyword">const</span> <a class="code" href="classScene.html">Scene</a> *scene,
00049                 <span class="keyword">const</span> <a class="code" href="classRayDifferential.html">RayDifferential</a> &amp;ray, <span class="keyword">const</span> <a class="code" href="structSample.html">Sample</a> *sample,
00050                 <span class="keywordtype">float</span> *alpha)<span class="keyword"> const </span>{
00051         <a class="code" href="structIntersection.html">Intersection</a> isect;
00052         <a class="code" href="classSpectrum.html">Spectrum</a> L(0.);
00053         <span class="keywordtype">bool</span> hitSomething;
00054         <a class="code" href="classBSDF.html">BSDF</a> *bsdf = NULL;
00055 
00056         <span class="keywordflow">if</span> (alpha) *alpha = 1;
00057 
00058         hitSomething = scene-&gt;<a class="code" href="classScene.html#a3">Intersect</a>(ray, &amp;isect);
00059         <span class="keywordflow">if</span> (hitSomething) {
00060                 bsdf = isect.<a class="code" href="structIntersection.html#a1">GetBSDF</a>(ray);
00061         }
00062 
00063         <span class="keywordtype">float</span> color[3] = {0,0,0};
00064 
00065         <span class="keywordtype">int</span> i;
00066         <span class="keywordflow">for</span> (i = 0 ; i &lt; 3 ; i++)
00067         {
00068                 <span class="keywordflow">if</span> (<a class="code" href="classDebugIntegrator.html#r0">debug_variable</a>[i] == <a class="code" href="debug_8cpp.html#a12a10">DEBUG_HIT_SOMETHING</a>)
00069                 {
00070                         color[i] = hitSomething ? 1 : 0;
00071                 }
00072                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classDebugIntegrator.html#r0">debug_variable</a>[i] == <a class="code" href="debug_8cpp.html#a12a8">DEBUG_ONE</a>)
00073                 {
00074                         color[i] = 1;
00075                 }
00076                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classDebugIntegrator.html#r0">debug_variable</a>[i] == <a class="code" href="debug_8cpp.html#a12a9">DEBUG_ZERO</a>)
00077                 {
00078                         color[i] = 0;
00079                 }
00080                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hitSomething)
00081                 {
00082                         <span class="keywordflow">switch</span>( <a class="code" href="classDebugIntegrator.html#r0">debug_variable</a>[i] )
00083                         {
00084                                 <span class="keywordflow">case</span> <a class="code" href="debug_8cpp.html#a12a0">DEBUG_U</a>:
00085                                         color[i] = isect.<a class="code" href="structIntersection.html#o0">dg</a>.<a class="code" href="structDifferentialGeometry.html#o2">u</a>;
00086                                         <span class="keywordflow">break</span>;
00087                                 <span class="keywordflow">case</span> <a class="code" href="debug_8cpp.html#a12a1">DEBUG_V</a>:
00088                                         color[i] = isect.<a class="code" href="structIntersection.html#o0">dg</a>.<a class="code" href="structDifferentialGeometry.html#o3">v</a>;
00089                                         <span class="keywordflow">break</span>;
00090                                 <span class="keywordflow">case</span> <a class="code" href="debug_8cpp.html#a12a2">DEBUG_GEOM_NORMAL_X</a>:
00091                                         color[i] = fabsf(isect.<a class="code" href="structIntersection.html#o0">dg</a>.<a class="code" href="structDifferentialGeometry.html#o1">nn</a>.<a class="code" href="classNormal.html#o0">x</a>);
00092                                         <span class="keywordflow">break</span>;
00093                                 <span class="keywordflow">case</span> <a class="code" href="debug_8cpp.html#a12a3">DEBUG_GEOM_NORMAL_Y</a>:
00094                                         color[i] = fabsf(isect.<a class="code" href="structIntersection.html#o0">dg</a>.<a class="code" href="structDifferentialGeometry.html#o1">nn</a>.<a class="code" href="classNormal.html#o1">y</a>);
00095                                         <span class="keywordflow">break</span>;
00096                                 <span class="keywordflow">case</span> <a class="code" href="debug_8cpp.html#a12a4">DEBUG_GEOM_NORMAL_Z</a>:
00097                                         color[i] = fabsf(isect.<a class="code" href="structIntersection.html#o0">dg</a>.<a class="code" href="structDifferentialGeometry.html#o1">nn</a>.<a class="code" href="classNormal.html#o2">z</a>);
00098                                         <span class="keywordflow">break</span>;
00099                                 <span class="keywordflow">case</span> <a class="code" href="debug_8cpp.html#a12a5">DEBUG_SHAD_NORMAL_X</a>:
00100                                         color[i] = fabsf(bsdf-&gt;<a class="code" href="classBSDF.html#o0">dgShading</a>.<a class="code" href="structDifferentialGeometry.html#o1">nn</a>.<a class="code" href="classNormal.html#o0">x</a>);
00101                                         <span class="keywordflow">break</span>;
00102                                 <span class="keywordflow">case</span> <a class="code" href="debug_8cpp.html#a12a6">DEBUG_SHAD_NORMAL_Y</a>:
00103                                         color[i] = fabsf(bsdf-&gt;<a class="code" href="classBSDF.html#o0">dgShading</a>.<a class="code" href="structDifferentialGeometry.html#o1">nn</a>.<a class="code" href="classNormal.html#o1">y</a>);
00104                                         <span class="keywordflow">break</span>;
00105                                 <span class="keywordflow">case</span> <a class="code" href="debug_8cpp.html#a12a7">DEBUG_SHAD_NORMAL_Z</a>:
00106                                         color[i] = fabsf(bsdf-&gt;<a class="code" href="classBSDF.html#o0">dgShading</a>.<a class="code" href="structDifferentialGeometry.html#o1">nn</a>.<a class="code" href="classNormal.html#o2">z</a>);
00107                                         <span class="keywordflow">break</span>;
00108                                 <span class="keywordflow">default</span>:
00109                                         <span class="keywordflow">break</span>;
00110                         }
00111                 }
00112                 <span class="keywordflow">if</span> (color[i] &lt; 0)
00113                 {
00114                         <a class="code" href="util_8cpp.html#a17">Severe</a>( <span class="stringliteral">"i = %d\ndebug_variable[i] = %d\nhit_something = %d\ncolor[i] = %f"</span>, i, <a class="code" href="classDebugIntegrator.html#r0">debug_variable</a>[i], hitSomething, color[i] );
00115                 }
00116         }
00117 
00118         L = <a class="code" href="classSpectrum.html">Spectrum</a>(color);
00119         <span class="keywordflow">return</span> L;
00120 }
00121 
<a name="l00122"></a><a class="code" href="debug_8cpp.html#a11">00122</a> <span class="keyword">extern</span> <span class="stringliteral">"C"</span> <a class="code" href="pbrt_8h.html#a2">DLLEXPORT</a> <a class="code" href="classSurfaceIntegrator.html">SurfaceIntegrator</a> *<a class="code" href="whitted_8cpp.html#a0">CreateSurfaceIntegrator</a>(<span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;params)
00123 {
00124         string strs[3];
00125         strs[0] = params.<a class="code" href="classParamSet.html#a28">FindOneString</a>( <span class="stringliteral">"red"</span>, <span class="stringliteral">"u"</span> );
00126         strs[1] = params.<a class="code" href="classParamSet.html#a28">FindOneString</a>( <span class="stringliteral">"green"</span>, <span class="stringliteral">"v"</span> );
00127         strs[2] = params.<a class="code" href="classParamSet.html#a28">FindOneString</a>( <span class="stringliteral">"blue"</span>, <span class="stringliteral">"zero"</span> );
00128 
00129         <a class="code" href="debug_8cpp.html#a12">DebugVariable</a> vars[3];
00130 
00131         <span class="keywordtype">int</span> i;
00132         <span class="keywordflow">for</span> (i = 0 ; i &lt; 3 ; i++)
00133         {
00134                 <span class="keywordflow">if</span> (strs[i] == <span class="stringliteral">"u"</span>) { vars[i] = <a class="code" href="debug_8cpp.html#a12a0">DEBUG_U</a>; }
00135                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strs[i] == <span class="stringliteral">"v"</span>) { vars[i] = <a class="code" href="debug_8cpp.html#a12a1">DEBUG_V</a>; }
00136                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strs[i] == <span class="stringliteral">"nx"</span>) { vars[i] = <a class="code" href="debug_8cpp.html#a12a2">DEBUG_GEOM_NORMAL_X</a>; }
00137                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strs[i] == <span class="stringliteral">"ny"</span>) { vars[i] = <a class="code" href="debug_8cpp.html#a12a3">DEBUG_GEOM_NORMAL_Y</a>; }
00138                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strs[i] == <span class="stringliteral">"nz"</span>) { vars[i] = <a class="code" href="debug_8cpp.html#a12a4">DEBUG_GEOM_NORMAL_Z</a>; }
00139                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strs[i] == <span class="stringliteral">"snx"</span>) { vars[i] = <a class="code" href="debug_8cpp.html#a12a5">DEBUG_SHAD_NORMAL_X</a>; }
00140                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strs[i] == <span class="stringliteral">"sny"</span>) { vars[i] = <a class="code" href="debug_8cpp.html#a12a6">DEBUG_SHAD_NORMAL_Y</a>; }
00141                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strs[i] == <span class="stringliteral">"snz"</span>) { vars[i] = <a class="code" href="debug_8cpp.html#a12a7">DEBUG_SHAD_NORMAL_Z</a>; }
00142                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strs[i] == <span class="stringliteral">"hit"</span>) { vars[i] = <a class="code" href="debug_8cpp.html#a12a10">DEBUG_HIT_SOMETHING</a>; }
00143                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strs[i] == <span class="stringliteral">"zero"</span>) { vars[i] = <a class="code" href="debug_8cpp.html#a12a9">DEBUG_ZERO</a>; }
00144                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strs[i] == <span class="stringliteral">"one"</span>) { vars[i] = <a class="code" href="debug_8cpp.html#a12a8">DEBUG_ONE</a>; }
00145                 <span class="keywordflow">else</span>
00146                 {
00147                         <a class="code" href="util_8cpp.html#a16">Error</a>( <span class="stringliteral">"Unknown debug type \"%s\", defaulting to zero."</span>, strs[i].c_str() );
00148                         vars[i] = <a class="code" href="debug_8cpp.html#a12a9">DEBUG_ZERO</a>;
00149                 }
00150         }
00151 
00152         <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classDebugIntegrator.html">DebugIntegrator</a>(vars);
00153 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Mon Apr 25 19:00:19 2005 for pbrt by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
