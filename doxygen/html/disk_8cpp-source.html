<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>pbrt: disk.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>disk.cpp</h1><a href="disk_8cpp.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 
00002 <span class="comment">/*</span>
00003 <span class="comment"> * pbrt source code Copyright(c) 1998-2005 Matt Pharr and Greg Humphreys</span>
00004 <span class="comment"> *</span>
00005 <span class="comment"> * All Rights Reserved.</span>
00006 <span class="comment"> * For educational use only; commercial use expressly forbidden.</span>
00007 <span class="comment"> * NO WARRANTY, express or implied, for this software.</span>
00008 <span class="comment"> * (See file License.txt for complete license)</span>
00009 <span class="comment"> */</span>
00010 
00011 <span class="comment">// disk.cpp*</span>
00012 <span class="preprocessor">#include "<a class="code" href="shape_8h.html">shape.h</a>"</span>
00013 <span class="comment">// Disk Declarations</span>
<a name="l00014"></a><a class="code" href="classDisk.html">00014</a> <span class="keyword">class </span><a class="code" href="classDisk.html">Disk</a> : <span class="keyword">public</span> <a class="code" href="classShape.html">Shape</a> {
00015 <span class="keyword">public</span>:
00016         <span class="comment">// Disk Public Methods</span>
00017         <a class="code" href="classDisk.html">Disk</a>(<span class="keyword">const</span> <a class="code" href="classTransform.html">Transform</a> &amp;o2w, <span class="keywordtype">bool</span> ro, <span class="keywordtype">float</span> <a class="code" href="classDisk.html#r0">height</a>,
00018              <span class="keywordtype">float</span> <a class="code" href="classDisk.html#r1">radius</a>, <span class="keywordtype">float</span> <a class="code" href="classDisk.html#r2">innerRadius</a>, <span class="keywordtype">float</span> <a class="code" href="classDisk.html#r3">phiMax</a>);
00019         <a class="code" href="classBBox.html">BBox</a> <a class="code" href="classDisk.html#a1">ObjectBound</a>() <span class="keyword">const</span>;
00020         <span class="keywordtype">bool</span> <a class="code" href="classDisk.html#a2">Intersect</a>(<span class="keyword">const</span> <a class="code" href="classRay.html">Ray</a> &amp;ray, <span class="keywordtype">float</span> *tHit,
00021                        <a class="code" href="structDifferentialGeometry.html">DifferentialGeometry</a> *dg) <span class="keyword">const</span>;
00022         <span class="keywordtype">bool</span> <a class="code" href="classDisk.html#a3">IntersectP</a>(<span class="keyword">const</span> <a class="code" href="classRay.html">Ray</a> &amp;ray) <span class="keyword">const</span>;
00023         <span class="keywordtype">float</span> <a class="code" href="classDisk.html#a4">Area</a>() <span class="keyword">const</span>;
<a name="l00024"></a><a class="code" href="classDisk.html#a5">00024</a>         <a class="code" href="classPoint.html">Point</a> <a class="code" href="classDisk.html#a5">Disk::Sample</a>(<span class="keywordtype">float</span> u1, <span class="keywordtype">float</span> u2, <a class="code" href="classNormal.html">Normal</a> *Ns)<span class="keyword"> const </span>{
00025                 <a class="code" href="classPoint.html">Point</a> p;
00026                 <a class="code" href="pbrt_8h.html#a91">ConcentricSampleDisk</a>(u1, u2, &amp;p.<a class="code" href="classPoint.html#o0">x</a>, &amp;p.<a class="code" href="classPoint.html#o1">y</a>);
00027                 p.<a class="code" href="classPoint.html#o0">x</a> *= radius;
00028                 p.<a class="code" href="classPoint.html#o1">y</a> *= radius;
00029                 p.<a class="code" href="classPoint.html#o2">z</a> = height;
00030                 *Ns = <a class="code" href="geometry_8h.html#a14">Normalize</a>(ObjectToWorld(<a class="code" href="classNormal.html">Normal</a>(0,0,1)));
00031                 <span class="keywordflow">if</span> (reverseOrientation) *Ns *= -1.f;
00032                 <span class="keywordflow">return</span> ObjectToWorld(p);
00033         }
00034 <span class="keyword">private</span>:
00035         <span class="comment">// Disk Private Data</span>
<a name="l00036"></a><a class="code" href="classDisk.html#r1">00036</a>         <span class="keywordtype">float</span> height, radius, innerRadius, phiMax;
00037 };
00038 <span class="comment">// Disk Method Definitions</span>
<a name="l00039"></a><a class="code" href="classDisk.html#a0">00039</a> <a class="code" href="classDisk.html#a0">Disk::Disk</a>(<span class="keyword">const</span> <a class="code" href="classTransform.html">Transform</a> &amp;o2w, <span class="keywordtype">bool</span> ro, <span class="keywordtype">float</span> ht,
00040            <span class="keywordtype">float</span> r, <span class="keywordtype">float</span> ri, <span class="keywordtype">float</span> tmax)
00041         : <a class="code" href="classShape.html">Shape</a>(o2w, ro) {
00042         <a class="code" href="classDisk.html#r0">height</a> = ht;
00043         <a class="code" href="classDisk.html#r1">radius</a> = r;
00044         <a class="code" href="classDisk.html#r2">innerRadius</a> = ri;
00045         <a class="code" href="classDisk.html#r3">phiMax</a> = <a class="code" href="pbrt_8h.html#a98">Radians</a>(<a class="code" href="pbrt_8h.html#a96">Clamp</a>(tmax, 0.0f, 360.0f));
00046 }
<a name="l00047"></a><a class="code" href="classDisk.html#a1">00047</a> <a class="code" href="classBBox.html">BBox</a> <a class="code" href="classDisk.html#a1">Disk::ObjectBound</a>()<span class="keyword"> const </span>{
00048         <span class="keywordflow">return</span> <a class="code" href="classBBox.html">BBox</a>(<a class="code" href="classPoint.html">Point</a>(-<a class="code" href="classDisk.html#r1">radius</a>, -<a class="code" href="classDisk.html#r1">radius</a>, <a class="code" href="classDisk.html#r0">height</a>),
00049                                 <a class="code" href="classPoint.html">Point</a>(<a class="code" href="classDisk.html#r1">radius</a>, <a class="code" href="classDisk.html#r1">radius</a>, <a class="code" href="classDisk.html#r0">height</a>));
00050 }
<a name="l00051"></a><a class="code" href="classDisk.html#a2">00051</a> <span class="keywordtype">bool</span> <a class="code" href="classDisk.html#a2">Disk::Intersect</a>(<span class="keyword">const</span> <a class="code" href="classRay.html">Ray</a> &amp;r, <span class="keywordtype">float</span> *tHit,
00052                 <a class="code" href="structDifferentialGeometry.html">DifferentialGeometry</a> *dg)<span class="keyword"> const </span>{
00053         <span class="comment">// Transform _Ray_ to object space</span>
00054         <a class="code" href="classRay.html">Ray</a> ray;
00055         WorldToObject(r, &amp;ray);
00056         <span class="comment">// Compute plane intersection for disk</span>
00057         <span class="keywordflow">if</span> (fabsf(ray.<a class="code" href="classRay.html#o1">d</a>.<a class="code" href="classVector.html#o2">z</a>) &lt; 1e-7) <span class="keywordflow">return</span> <span class="keyword">false</span>;
00058         <span class="keywordtype">float</span> thit = (<a class="code" href="classDisk.html#r0">height</a> - ray.<a class="code" href="classRay.html#o0">o</a>.<a class="code" href="classPoint.html#o2">z</a>) / ray.<a class="code" href="classRay.html#o1">d</a>.<a class="code" href="classVector.html#o2">z</a>;
00059         <span class="keywordflow">if</span> (thit &lt; ray.<a class="code" href="classRay.html#o2">mint</a> || thit &gt; ray.<a class="code" href="classRay.html#o3">maxt</a>)
00060                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00061         <span class="comment">// See if hit point is inside disk radii and \phimax</span>
00062         <a class="code" href="classPoint.html">Point</a> phit = ray(thit);
00063         <span class="keywordtype">float</span> dist2 = phit.<a class="code" href="classPoint.html#o0">x</a> * phit.<a class="code" href="classPoint.html#o0">x</a> + phit.<a class="code" href="classPoint.html#o1">y</a> * phit.<a class="code" href="classPoint.html#o1">y</a>;
00064         <span class="keywordflow">if</span> (dist2 &gt; <a class="code" href="classDisk.html#r1">radius</a> * <a class="code" href="classDisk.html#r1">radius</a> ||
00065             dist2 &lt; <a class="code" href="classDisk.html#r2">innerRadius</a>*<a class="code" href="classDisk.html#r2">innerRadius</a>)
00066                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00067         <span class="comment">// Test disk $\phi$ value against \phimax</span>
00068         <span class="keywordtype">float</span> phi = atan2f(phit.<a class="code" href="classPoint.html#o1">y</a>, phit.<a class="code" href="classPoint.html#o0">x</a>);
00069         <span class="keywordflow">if</span> (phi &lt; 0) phi += 2. * <a class="code" href="pbrt_8h.html#a6">M_PI</a>;
00070         <span class="keywordflow">if</span> (phi &gt; <a class="code" href="classDisk.html#r3">phiMax</a>)
00071                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00072         <span class="comment">// Find parametric representation of disk hit</span>
00073         <span class="keywordtype">float</span> u = phi / <a class="code" href="classDisk.html#r3">phiMax</a>;
00074         <span class="keywordtype">float</span> v = 1.f - ((sqrtf(dist2)-<a class="code" href="classDisk.html#r2">innerRadius</a>) /
00075                          (<a class="code" href="classDisk.html#r1">radius</a>-<a class="code" href="classDisk.html#r2">innerRadius</a>));
00076         <a class="code" href="classVector.html">Vector</a> dpdu(-<a class="code" href="classDisk.html#r3">phiMax</a> * phit.<a class="code" href="classPoint.html#o1">y</a>, <a class="code" href="classDisk.html#r3">phiMax</a> * phit.<a class="code" href="classPoint.html#o0">x</a>, 0.);
00077         <a class="code" href="classVector.html">Vector</a> dpdv(-phit.<a class="code" href="classPoint.html#o0">x</a> / (1-v), -phit.<a class="code" href="classPoint.html#o1">y</a> / (1-v), 0.);
00078         <a class="code" href="classVector.html">Vector</a> dndu(0,0,0), dndv(0,0,0);
00079         <span class="comment">// Initialize _DifferentialGeometry_ from parametric information</span>
00080         *dg = <a class="code" href="structDifferentialGeometry.html">DifferentialGeometry</a>(ObjectToWorld(phit),
00081                                    ObjectToWorld(dpdu),
00082                                                            ObjectToWorld(dpdv),
00083                                    ObjectToWorld(dndu),
00084                                                            ObjectToWorld(dndv),
00085                                    u, v, <span class="keyword">this</span>);
00086         <span class="comment">// Update _tHit_ for quadric intersection</span>
00087         *tHit = thit;
00088         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00089 }
<a name="l00090"></a><a class="code" href="classDisk.html#a3">00090</a> <span class="keywordtype">bool</span> Disk::IntersectP(<span class="keyword">const</span> <a class="code" href="classRay.html">Ray</a> &amp;r) <span class="keyword">const</span> {
00091         <span class="comment">// Transform _Ray_ to object space</span>
00092         <a class="code" href="classRay.html">Ray</a> ray;
00093         WorldToObject(r, &amp;ray);
00094         <span class="comment">// Compute plane intersection for disk</span>
00095         <span class="keywordflow">if</span> (fabsf(ray.d.<a class="code" href="classPoint.html#o2">z</a>) &lt; 1e-7) <span class="keywordflow">return</span> <span class="keyword">false</span>;
00096         <span class="keywordtype">float</span> thit = (height - ray.o.<a class="code" href="classPoint.html#o2">z</a>) / ray.d.<a class="code" href="classPoint.html#o2">z</a>;
00097         <a class="code" href="pbrtparse_8y.html#a41">if</a> (thit &lt; ray.mint || thit &gt; ray.maxt)
00098                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00099         <span class="comment">// See if hit point is inside disk radii and \phimax</span>
00100         <a class="code" href="classPoint.html">Point</a> phit = ray(thit);
00101         <span class="keywordtype">float</span> dist2 = phit.<a class="code" href="classPoint.html#o0">x</a> * phit.x + phit.y * phit.y;
00102         <a class="code" href="pbrtparse_8y.html#a41">if</a> (dist2 &gt; radius * radius ||
00103             dist2 &lt; innerRadius*innerRadius)
00104                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00105         <span class="comment">// Test disk $\phi$ value against \phimax</span>
00106         <span class="keywordtype">float</span> phi = atan2f(phit.y, phit.x);
00107         <a class="code" href="pbrtparse_8y.html#a41">if</a> (phi &lt; 0) phi += 2. * M_PI;
00108         <span class="keywordflow">if</span> (phi &gt; phiMax)
00109                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00110         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00111 }
<a name="l00112"></a><a class="code" href="classDisk.html#a4">00112</a> <span class="keywordtype">float</span> Disk::Area() <span class="keyword">const</span> {
00113         <span class="keywordflow">return</span> phiMax * 0.5f *
00114             (radius * radius -innerRadius * innerRadius );
00115 }
<a name="l00116"></a><a class="code" href="disk_8cpp.html#a0">00116</a> <span class="keyword">extern</span> <span class="stringliteral">"C"</span> DLLEXPORT <a class="code" href="classShape.html">Shape</a> *<a class="code" href="trianglemesh_8cpp.html#a0">CreateShape</a>(<span class="keyword">const</span> <a class="code" href="classTransform.html">Transform</a> &amp;o2w,
00117                 <span class="keywordtype">bool</span> reverseOrientation, <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;params) {
00118         <span class="keywordtype">float</span> height = params.<a class="code" href="classParamSet.html#a21">FindOneFloat</a>( <span class="stringliteral">"height"</span>, 0. );
00119         <span class="keywordtype">float</span> radius = params.FindOneFloat( <span class="stringliteral">"radius"</span>, 1 );
00120         <span class="keywordtype">float</span> inner_radius = params.FindOneFloat( <span class="stringliteral">"innerradius"</span>, 0 );
00121         <span class="keywordtype">float</span> phimax = params.FindOneFloat( <span class="stringliteral">"phimax"</span>, 360 );
00122         <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classDisk.html">Disk</a>(o2w, reverseOrientation, height, radius, inner_radius, phimax);
00123 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Mon Apr 25 19:00:20 2005 for pbrt by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
