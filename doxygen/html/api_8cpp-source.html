<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>pbrt: api.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>api.cpp</h1><a href="api_8cpp.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 
00002 <span class="comment">/*</span>
00003 <span class="comment"> * pbrt source code Copyright(c) 1998-2005 Matt Pharr and Greg Humphreys</span>
00004 <span class="comment"> *</span>
00005 <span class="comment"> * All Rights Reserved.</span>
00006 <span class="comment"> * For educational use only; commercial use expressly forbidden.</span>
00007 <span class="comment"> * NO WARRANTY, express or implied, for this software.</span>
00008 <span class="comment"> * (See file License.txt for complete license)</span>
00009 <span class="comment"> */</span>
00010 
00011 <span class="comment">// api.cpp*</span>
00012 <span class="preprocessor">#include "<a class="code" href="api_8h.html">api.h</a>"</span>
00013 <span class="preprocessor">#include "<a class="code" href="paramset_8h.html">paramset.h</a>"</span>
00014 <span class="preprocessor">#include "<a class="code" href="color_8h.html">color.h</a>"</span>
00015 <span class="preprocessor">#include "<a class="code" href="scene_8h.html">scene.h</a>"</span>
00016 <span class="preprocessor">#include "<a class="code" href="film_8h.html">film.h</a>"</span>
00017 <span class="preprocessor">#include "<a class="code" href="dynload_8h.html">dynload.h</a>"</span>
00018 <span class="preprocessor">#include "<a class="code" href="volume_8h.html">volume.h</a>"</span>
00019 <span class="preprocessor">#include &lt;map&gt;</span>
00020 <span class="keyword">using</span> std::map;
00021 <span class="comment">// API Local Classes</span>
<a name="l00022"></a><a class="code" href="structRenderOptions.html">00022</a> <span class="keyword">struct </span><a class="code" href="structRenderOptions.html">RenderOptions</a> {
00023         <span class="comment">// RenderOptions Public Methods</span>
00024         <a class="code" href="structRenderOptions.html#a0">RenderOptions</a>();
00025         <a class="code" href="classScene.html">Scene</a> *<a class="code" href="structRenderOptions.html#a1">MakeScene</a>() <span class="keyword">const</span>;
00026         <span class="comment">// RenderOptions Public Data</span>
<a name="l00027"></a><a class="code" href="structRenderOptions.html#o0">00027</a>         string <a class="code" href="structRenderOptions.html#o0">FilterName</a>;
<a name="l00028"></a><a class="code" href="structRenderOptions.html#o1">00028</a>         <a class="code" href="classParamSet.html">ParamSet</a> <a class="code" href="structRenderOptions.html#o1">FilterParams</a>;
<a name="l00029"></a><a class="code" href="structRenderOptions.html#o2">00029</a>         string <a class="code" href="structRenderOptions.html#o2">FilmName</a>;
<a name="l00030"></a><a class="code" href="structRenderOptions.html#o3">00030</a>         <a class="code" href="classParamSet.html">ParamSet</a> <a class="code" href="structRenderOptions.html#o3">FilmParams</a>;
<a name="l00031"></a><a class="code" href="structRenderOptions.html#o4">00031</a>         string <a class="code" href="structRenderOptions.html#o4">SamplerName</a>;
<a name="l00032"></a><a class="code" href="structRenderOptions.html#o5">00032</a>         <a class="code" href="classParamSet.html">ParamSet</a> <a class="code" href="structRenderOptions.html#o5">SamplerParams</a>;
<a name="l00033"></a><a class="code" href="structRenderOptions.html#o6">00033</a>         string <a class="code" href="structRenderOptions.html#o6">AcceleratorName</a>;
<a name="l00034"></a><a class="code" href="structRenderOptions.html#o7">00034</a>         <a class="code" href="classParamSet.html">ParamSet</a> <a class="code" href="structRenderOptions.html#o7">AcceleratorParams</a>;
<a name="l00035"></a><a class="code" href="structRenderOptions.html#o9">00035</a>         string <a class="code" href="structRenderOptions.html#o8">SurfIntegratorName</a>, <a class="code" href="structRenderOptions.html#o9">VolIntegratorName</a>;
<a name="l00036"></a><a class="code" href="structRenderOptions.html#o11">00036</a>         <a class="code" href="classParamSet.html">ParamSet</a> <a class="code" href="structRenderOptions.html#o10">SurfIntegratorParams</a>, <a class="code" href="structRenderOptions.html#o11">VolIntegratorParams</a>;
<a name="l00037"></a><a class="code" href="structRenderOptions.html#o12">00037</a>         string <a class="code" href="structRenderOptions.html#o12">CameraName</a>;
<a name="l00038"></a><a class="code" href="structRenderOptions.html#o13">00038</a>         <a class="code" href="classParamSet.html">ParamSet</a> <a class="code" href="structRenderOptions.html#o13">CameraParams</a>;
<a name="l00039"></a><a class="code" href="structRenderOptions.html#o14">00039</a>         <a class="code" href="classTransform.html">Transform</a> <a class="code" href="structRenderOptions.html#o14">WorldToCamera</a>;
<a name="l00040"></a><a class="code" href="structRenderOptions.html#o15">00040</a>         <span class="keywordtype">bool</span> <a class="code" href="structRenderOptions.html#o15">gotSearchPath</a>;
<a name="l00041"></a><a class="code" href="structRenderOptions.html#o16">00041</a>         <span class="keyword">mutable</span> vector&lt;Light *&gt; <a class="code" href="structRenderOptions.html#o16">lights</a>;
<a name="l00042"></a><a class="code" href="structRenderOptions.html#o17">00042</a>         <span class="keyword">mutable</span> vector&lt;Reference&lt;Primitive&gt; &gt; <a class="code" href="structRenderOptions.html#o17">primitives</a>;
<a name="l00043"></a><a class="code" href="structRenderOptions.html#o18">00043</a>         <span class="keyword">mutable</span> vector&lt;VolumeRegion *&gt; <a class="code" href="structRenderOptions.html#o18">volumeRegions</a>;
<a name="l00044"></a><a class="code" href="structRenderOptions.html#o19">00044</a>         map&lt;string, vector&lt;Reference&lt;Primitive&gt; &gt; &gt; <a class="code" href="structRenderOptions.html#o19">instances</a>;
<a name="l00045"></a><a class="code" href="structRenderOptions.html#o20">00045</a>         vector&lt;Reference&lt;Primitive&gt; &gt; *<a class="code" href="structRenderOptions.html#o20">currentInstance</a>;
00046 };
<a name="l00047"></a><a class="code" href="structRenderOptions.html#a0">00047</a> <a class="code" href="structRenderOptions.html#a0">RenderOptions::RenderOptions</a>() {
00048         <span class="comment">// RenderOptions Constructor Implementation</span>
00049         <a class="code" href="structRenderOptions.html#o0">FilterName</a> = <span class="stringliteral">"mitchell"</span>;
00050         <a class="code" href="structRenderOptions.html#o2">FilmName</a> = <span class="stringliteral">"image"</span>;
00051         <a class="code" href="structRenderOptions.html#o4">SamplerName</a> = <span class="stringliteral">"bestcandidate"</span>;
00052         <a class="code" href="structRenderOptions.html#o6">AcceleratorName</a> = <span class="stringliteral">"kdtree"</span>;
00053         <a class="code" href="structRenderOptions.html#o8">SurfIntegratorName</a> = <span class="stringliteral">"directlighting"</span>;
00054         <a class="code" href="structRenderOptions.html#o9">VolIntegratorName</a> = <span class="stringliteral">"emission"</span>;
00055         <a class="code" href="structRenderOptions.html#o12">CameraName</a> = <span class="stringliteral">"perspective"</span>;
00056         <span class="keywordtype">char</span> *searchEnv = getenv(<span class="stringliteral">"PBRT_SEARCHPATH"</span>);
00057         <span class="keywordflow">if</span> (searchEnv == NULL) {
00058                 <a class="code" href="util_8cpp.html#a15">Warning</a>(<span class="stringliteral">"PBRT_SEARCHPATH not set in your environment.\n"</span>
00059                           <span class="stringliteral">"pbrt won't be able to find plugins if "</span>
00060                           <span class="stringliteral">"no SearchPath in input file.\n"</span>
00061                           <span class="stringliteral">"PBRT_SEARCHPATH should be a "</span>
00062                           <span class="stringliteral">"\"%s\"-separated list of directories.\n"</span>,
00063                           <a class="code" href="pbrt_8h.html#a3">PBRT_PATH_SEP</a>);
00064                 <a class="code" href="structRenderOptions.html#o15">gotSearchPath</a> = <span class="keyword">false</span>;
00065         }
00066         <span class="keywordflow">else</span> {
00067                 <a class="code" href="dynload_8h.html#a0">UpdatePluginPath</a>(searchEnv);
00068                 <a class="code" href="structRenderOptions.html#o15">gotSearchPath</a> = <span class="keyword">true</span>;
00069         }
00070         <a class="code" href="structRenderOptions.html#o20">currentInstance</a> = NULL;
00071 }
<a name="l00072"></a><a class="code" href="structGraphicsState.html">00072</a> <span class="keyword">struct </span><a class="code" href="structGraphicsState.html">GraphicsState</a> {
00073         <span class="comment">// Graphics State Methods</span>
00074         <a class="code" href="structGraphicsState.html#a0">GraphicsState</a>();
00075         <span class="comment">// Graphics State</span>
00076         map&lt;string, Reference&lt;Texture&lt;float&gt; &gt; &gt;
<a name="l00077"></a><a class="code" href="structGraphicsState.html#o0">00077</a>                 <a class="code" href="structGraphicsState.html#o0">floatTextures</a>;
00078         map&lt;string, Reference&lt;Texture&lt;Spectrum&gt; &gt; &gt;
<a name="l00079"></a><a class="code" href="structGraphicsState.html#o1">00079</a>                 <a class="code" href="structGraphicsState.html#o1">spectrumTextures</a>;
<a name="l00080"></a><a class="code" href="structGraphicsState.html#o2">00080</a>         <a class="code" href="classParamSet.html">ParamSet</a> <a class="code" href="structGraphicsState.html#o2">materialParams</a>;
<a name="l00081"></a><a class="code" href="structGraphicsState.html#o3">00081</a>         string <a class="code" href="structGraphicsState.html#o3">material</a>;
<a name="l00082"></a><a class="code" href="structGraphicsState.html#o4">00082</a>         <a class="code" href="classParamSet.html">ParamSet</a> <a class="code" href="structGraphicsState.html#o4">areaLightParams</a>;
<a name="l00083"></a><a class="code" href="structGraphicsState.html#o5">00083</a>         string <a class="code" href="structGraphicsState.html#o5">areaLight</a>;
<a name="l00084"></a><a class="code" href="structGraphicsState.html#o6">00084</a>         <span class="keywordtype">bool</span> <a class="code" href="structGraphicsState.html#o6">reverseOrientation</a>;
00085 };
<a name="l00086"></a><a class="code" href="structGraphicsState.html#a0">00086</a> <a class="code" href="structGraphicsState.html#a0">GraphicsState::GraphicsState</a>() {
00087         <span class="comment">// GraphicsState Constructor Implementation</span>
00088         <a class="code" href="structGraphicsState.html#o3">material</a> = <span class="stringliteral">"matte"</span>;
00089         <a class="code" href="structGraphicsState.html#o6">reverseOrientation</a> = <span class="keyword">false</span>;
00090 }
00091 <span class="comment">// API Static Data</span>
<a name="l00092"></a><a class="code" href="api_8cpp.html#a0">00092</a> <span class="preprocessor">#define STATE_UNINITIALIZED  0</span>
<a name="l00093"></a><a class="code" href="api_8cpp.html#a1">00093</a> <span class="preprocessor"></span><span class="preprocessor">#define STATE_OPTIONS_BLOCK  1</span>
<a name="l00094"></a><a class="code" href="api_8cpp.html#a2">00094</a> <span class="preprocessor"></span><span class="preprocessor">#define STATE_WORLD_BLOCK    2</span>
<a name="l00095"></a><a class="code" href="api_8cpp.html#a6">00095</a> <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="api_8cpp.html#a6">currentApiState</a> = <a class="code" href="api_8cpp.html#a0">STATE_UNINITIALIZED</a>;
<a name="l00096"></a><a class="code" href="api_8cpp.html#a7">00096</a> <span class="keyword">static</span> <a class="code" href="classTransform.html">Transform</a> <a class="code" href="api_8cpp.html#a7">curTransform</a>;
<a name="l00097"></a><a class="code" href="api_8cpp.html#a8">00097</a> <span class="keyword">static</span> map&lt;string, Transform&gt; <a class="code" href="api_8cpp.html#a8">namedCoordinateSystems</a>;
<a name="l00098"></a><a class="code" href="api_8cpp.html#a9">00098</a> <span class="keyword">static</span> <a class="code" href="structRenderOptions.html">RenderOptions</a> *<a class="code" href="api_8cpp.html#a9">renderOptions</a> = NULL;
<a name="l00099"></a><a class="code" href="api_8cpp.html#a10">00099</a> <span class="keyword">static</span> <a class="code" href="structGraphicsState.html">GraphicsState</a> <a class="code" href="api_8cpp.html#a10">graphicsState</a>;
<a name="l00100"></a><a class="code" href="api_8cpp.html#a11">00100</a> <span class="keyword">static</span> vector&lt;GraphicsState&gt; <a class="code" href="api_8cpp.html#a11">pushedGraphicsStates</a>;
<a name="l00101"></a><a class="code" href="api_8cpp.html#a12">00101</a> <span class="keyword">static</span> vector&lt;Transform&gt; <a class="code" href="api_8cpp.html#a12">pushedTransforms</a>;
00102 <span class="comment">// API Macros</span>
<a name="l00103"></a><a class="code" href="api_8cpp.html#a3">00103</a> <span class="preprocessor">#define VERIFY_INITIALIZED(func) \</span>
00104 <span class="preprocessor">if (currentApiState == STATE_UNINITIALIZED) { \</span>
00105 <span class="preprocessor">        Error("pbrtInit() must be before calling \"%s()\". " \</span>
00106 <span class="preprocessor">                "Ignoring.", func); \</span>
00107 <span class="preprocessor">        return; \</span>
00108 <span class="preprocessor">} else </span><span class="comment">/* swallow trailing semicolon */</span>
<a name="l00109"></a><a class="code" href="api_8cpp.html#a4">00109</a> <span class="preprocessor">#define VERIFY_OPTIONS(func) \</span>
00110 <span class="preprocessor">VERIFY_INITIALIZED(func); \</span>
00111 <span class="preprocessor">if (currentApiState == STATE_WORLD_BLOCK) { \</span>
00112 <span class="preprocessor">        Error("Options cannot be set inside world block; " \</span>
00113 <span class="preprocessor">                "\"%s\" not allowed.  Ignoring.", func); \</span>
00114 <span class="preprocessor">        return; \</span>
00115 <span class="preprocessor">} else </span><span class="comment">/* swallow trailing semicolon */</span>
<a name="l00116"></a><a class="code" href="api_8cpp.html#a5">00116</a> <span class="preprocessor">#define VERIFY_WORLD(func) \</span>
00117 <span class="preprocessor">VERIFY_INITIALIZED(func); \</span>
00118 <span class="preprocessor">if (currentApiState == STATE_OPTIONS_BLOCK) { \</span>
00119 <span class="preprocessor">        Error("Scene description must be inside world block; " \</span>
00120 <span class="preprocessor">                "\"%s\" not allowed. Ignoring.", func); \</span>
00121 <span class="preprocessor">        return; \</span>
00122 <span class="preprocessor">} else </span><span class="comment">/* swallow trailing semicolon */</span>
00123 <span class="comment">// API Function Definitions</span>
<a name="l00124"></a><a class="code" href="pbrt_8h.html#a72">00124</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#a13">pbrtInit</a>() {
00125         <span class="comment">// System-wide initialization</span>
00126         <span class="comment">// Make sure floating point unit's rounding stuff is set</span>
00127         <span class="comment">// as is expected by the fast FP-conversion routines.  In particular,</span>
00128         <span class="comment">// we want double precision on Linux, not extended precision!</span>
00129 <span class="preprocessor">        #ifdef FAST_INT</span>
00130 <span class="preprocessor"></span><span class="preprocessor">        #if defined(__linux__) &amp;&amp; defined(__i386__)</span>
00131 <span class="preprocessor"></span>        <span class="keywordtype">int</span> cword = _FPU_MASK_DM | _FPU_MASK_ZM | _FPU_MASK_OM | _FPU_MASK_PM |
00132                 _FPU_MASK_UM | _FPU_MASK_IM | _FPU_DOUBLE | _FPU_RC_NEAREST;
00133         _FPU_SETCW(cword);
00134 <span class="preprocessor">        #endif</span>
00135 <span class="preprocessor"></span><span class="preprocessor">        #if defined(WIN32)</span>
00136 <span class="preprocessor"></span>        _control87(_PC_53, MCW_PC);
00137 <span class="preprocessor">        #endif</span>
00138 <span class="preprocessor"></span><span class="preprocessor">        #endif // FAST_INT</span>
00139 <span class="preprocessor"></span>        <span class="comment">// API Initialization</span>
00140         <span class="keywordflow">if</span> (<a class="code" href="api_8cpp.html#a6">currentApiState</a> != <a class="code" href="api_8cpp.html#a0">STATE_UNINITIALIZED</a>)
00141                 <a class="code" href="util_8cpp.html#a16">Error</a>(<span class="stringliteral">"pbrtInit() has already been called."</span>);
00142         <a class="code" href="api_8cpp.html#a6">currentApiState</a> = <a class="code" href="api_8cpp.html#a1">STATE_OPTIONS_BLOCK</a>;
00143         <a class="code" href="api_8cpp.html#a9">renderOptions</a> = <span class="keyword">new</span> <a class="code" href="structRenderOptions.html">RenderOptions</a>;
00144         <a class="code" href="api_8cpp.html#a10">graphicsState</a> = <a class="code" href="structGraphicsState.html">GraphicsState</a>();
00145 }
<a name="l00146"></a><a class="code" href="pbrt_8h.html#a73">00146</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#a14">pbrtCleanup</a>() {
00147         <a class="code" href="pbrt_8h.html#a63">StatsCleanup</a>();
00148         <span class="comment">// API Cleanup</span>
00149         <span class="keywordflow">if</span> (<a class="code" href="api_8cpp.html#a6">currentApiState</a> == <a class="code" href="api_8cpp.html#a0">STATE_UNINITIALIZED</a>)
00150                 <a class="code" href="util_8cpp.html#a16">Error</a>(<span class="stringliteral">"pbrtCleanup() called without pbrtInit()."</span>);
00151         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="api_8cpp.html#a6">currentApiState</a> == <a class="code" href="api_8cpp.html#a2">STATE_WORLD_BLOCK</a>)
00152                 <a class="code" href="util_8cpp.html#a16">Error</a>(<span class="stringliteral">"pbrtCleanup() called while inside world block."</span>);
00153         <a class="code" href="api_8cpp.html#a6">currentApiState</a> = <a class="code" href="api_8cpp.html#a0">STATE_UNINITIALIZED</a>;
00154         <span class="keyword">delete</span> <a class="code" href="api_8cpp.html#a9">renderOptions</a>;
00155         <a class="code" href="api_8cpp.html#a9">renderOptions</a> = NULL;
00156 }
<a name="l00157"></a><a class="code" href="api_8h.html#a0">00157</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#a15">pbrtIdentity</a>() {
00158         <a class="code" href="api_8cpp.html#a3">VERIFY_INITIALIZED</a>(<span class="stringliteral">"Identity"</span>);
00159         <a class="code" href="api_8cpp.html#a7">curTransform</a> = <a class="code" href="classTransform.html">Transform</a>();
00160 }
<a name="l00161"></a><a class="code" href="api_8h.html#a1">00161</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8h.html#a1">pbrtTranslate</a>(<span class="keywordtype">float</span> dx, <span class="keywordtype">float</span> dy, <span class="keywordtype">float</span> dz) {
00162         <a class="code" href="api_8cpp.html#a3">VERIFY_INITIALIZED</a>(<span class="stringliteral">"Translate"</span>);
00163         <a class="code" href="api_8cpp.html#a7">curTransform</a> =
00164                 <a class="code" href="api_8cpp.html#a7">curTransform</a> * <a class="code" href="transform_8cpp.html#a1">Translate</a>(<a class="code" href="classVector.html">Vector</a>(dx, dy, dz));
00165 }
<a name="l00166"></a><a class="code" href="api_8h.html#a6">00166</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8h.html#a6">pbrtTransform</a>(<span class="keywordtype">float</span> tr[16]) {
00167         <a class="code" href="api_8cpp.html#a3">VERIFY_INITIALIZED</a>(<span class="stringliteral">"Transform"</span>);
00168         <a class="code" href="api_8cpp.html#a7">curTransform</a> = <a class="code" href="classTransform.html">Transform</a>(<span class="keyword">new</span> <a class="code" href="structMatrix4x4.html">Matrix4x4</a>(
00169                 tr[0], tr[4], tr[8], tr[12],
00170                 tr[1], tr[5], tr[9], tr[13],
00171                 tr[2], tr[6], tr[10], tr[14],
00172                 tr[3], tr[7], tr[11], tr[15]));
00173 }
<a name="l00174"></a><a class="code" href="api_8h.html#a5">00174</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8h.html#a5">pbrtConcatTransform</a>(<span class="keywordtype">float</span> tr[16]) {
00175         <a class="code" href="api_8cpp.html#a3">VERIFY_INITIALIZED</a>(<span class="stringliteral">"ConcatTransform"</span>);
00176         <a class="code" href="api_8cpp.html#a7">curTransform</a> = <a class="code" href="api_8cpp.html#a7">curTransform</a> * <a class="code" href="classTransform.html">Transform</a>(
00177                 <span class="keyword">new</span> <a class="code" href="structMatrix4x4.html">Matrix4x4</a>(tr[0], tr[4], tr[8], tr[12],
00178                                  tr[1], tr[5], tr[9], tr[13],
00179                                  tr[2], tr[6], tr[10], tr[14],
00180                                  tr[3], tr[7], tr[11], tr[15]));
00181 }
<a name="l00182"></a><a class="code" href="api_8h.html#a2">00182</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8h.html#a2">pbrtRotate</a>(<span class="keywordtype">float</span> angle, <span class="keywordtype">float</span> dx, <span class="keywordtype">float</span> dy, <span class="keywordtype">float</span> dz) {
00183         <a class="code" href="api_8cpp.html#a3">VERIFY_INITIALIZED</a>(<span class="stringliteral">"Rotate"</span>);
00184         <a class="code" href="api_8cpp.html#a7">curTransform</a> = <a class="code" href="api_8cpp.html#a7">curTransform</a> * <a class="code" href="transform_8cpp.html#a6">Rotate</a>(angle, <a class="code" href="classVector.html">Vector</a>(dx, dy, dz));
00185 }
<a name="l00186"></a><a class="code" href="api_8h.html#a3">00186</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8h.html#a3">pbrtScale</a>(<span class="keywordtype">float</span> sx, <span class="keywordtype">float</span> sy, <span class="keywordtype">float</span> sz) {
00187         <a class="code" href="api_8cpp.html#a3">VERIFY_INITIALIZED</a>(<span class="stringliteral">"Scale"</span>);
00188         <a class="code" href="api_8cpp.html#a7">curTransform</a> = <a class="code" href="api_8cpp.html#a7">curTransform</a> * <a class="code" href="transform_8cpp.html#a2">Scale</a>(sx, sy, sz);
00189 }
<a name="l00190"></a><a class="code" href="api_8h.html#a4">00190</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8h.html#a4">pbrtLookAt</a>(<span class="keywordtype">float</span> ex, <span class="keywordtype">float</span> ey, <span class="keywordtype">float</span> ez, <span class="keywordtype">float</span> lx, <span class="keywordtype">float</span> ly,
00191         <span class="keywordtype">float</span> lz, <span class="keywordtype">float</span> ux, <span class="keywordtype">float</span> uy, <span class="keywordtype">float</span> uz) {
00192         <a class="code" href="api_8cpp.html#a3">VERIFY_INITIALIZED</a>(<span class="stringliteral">"LookAt"</span>);
00193         <a class="code" href="api_8cpp.html#a7">curTransform</a> = <a class="code" href="api_8cpp.html#a7">curTransform</a> * <a class="code" href="transform_8cpp.html#a7">LookAt</a>(<a class="code" href="classPoint.html">Point</a>(ex, ey, ez), <a class="code" href="classPoint.html">Point</a>(lx, ly, lz),
00194                 <a class="code" href="classVector.html">Vector</a>(ux, uy, uz));
00195 }
<a name="l00196"></a><a class="code" href="api_8h.html#a7">00196</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8h.html#a7">pbrtCoordinateSystem</a>(<span class="keyword">const</span> string &amp;name) {
00197         <a class="code" href="api_8cpp.html#a3">VERIFY_INITIALIZED</a>(<span class="stringliteral">"CoordinateSystem"</span>);
00198         <a class="code" href="api_8cpp.html#a8">namedCoordinateSystems</a>[name] = <a class="code" href="api_8cpp.html#a7">curTransform</a>;
00199 }
<a name="l00200"></a><a class="code" href="api_8h.html#a8">00200</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8h.html#a8">pbrtCoordSysTransform</a>(<span class="keyword">const</span> string &amp;name) {
00201         <a class="code" href="api_8cpp.html#a3">VERIFY_INITIALIZED</a>(<span class="stringliteral">"CoordSysTransform"</span>);
00202         <span class="keywordflow">if</span> (<a class="code" href="api_8cpp.html#a8">namedCoordinateSystems</a>.find(name) !=
00203             <a class="code" href="api_8cpp.html#a8">namedCoordinateSystems</a>.end())
00204                 <a class="code" href="api_8cpp.html#a7">curTransform</a> = <a class="code" href="api_8cpp.html#a8">namedCoordinateSystems</a>[name];
00205 }
<a name="l00206"></a><a class="code" href="api_8h.html#a9">00206</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8h.html#a9">pbrtPixelFilter</a>(<span class="keyword">const</span> string &amp;name,
00207                            <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;params) {
00208         <a class="code" href="api_8cpp.html#a4">VERIFY_OPTIONS</a>(<span class="stringliteral">"PixelFilter"</span>);
00209         <a class="code" href="api_8cpp.html#a9">renderOptions</a>-&gt;<a class="code" href="structRenderOptions.html#o0">FilterName</a> = name;
00210         <a class="code" href="api_8cpp.html#a9">renderOptions</a>-&gt;<a class="code" href="structRenderOptions.html#o1">FilterParams</a> = params;
00211 }
<a name="l00212"></a><a class="code" href="api_8h.html#a10">00212</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8h.html#a10">pbrtFilm</a>(<span class="keyword">const</span> string &amp;type, <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;params) {
00213         <a class="code" href="api_8cpp.html#a4">VERIFY_OPTIONS</a>(<span class="stringliteral">"Film"</span>);
00214         <a class="code" href="api_8cpp.html#a9">renderOptions</a>-&gt;<a class="code" href="structRenderOptions.html#o3">FilmParams</a> = params;
00215         <a class="code" href="api_8cpp.html#a9">renderOptions</a>-&gt;<a class="code" href="structRenderOptions.html#o2">FilmName</a> = type;
00216 }
<a name="l00217"></a><a class="code" href="api_8h.html#a11">00217</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8h.html#a11">pbrtSampler</a>(<span class="keyword">const</span> string &amp;name, <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;params) {
00218         <a class="code" href="api_8cpp.html#a4">VERIFY_OPTIONS</a>(<span class="stringliteral">"Sampler"</span>);
00219         <a class="code" href="api_8cpp.html#a9">renderOptions</a>-&gt;<a class="code" href="structRenderOptions.html#o4">SamplerName</a> = name;
00220         <a class="code" href="api_8cpp.html#a9">renderOptions</a>-&gt;<a class="code" href="structRenderOptions.html#o5">SamplerParams</a> = params;
00221 }
<a name="l00222"></a><a class="code" href="api_8h.html#a12">00222</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="pbrtparse_8y.html#a44">pbrtAccelerator</a>(<span class="keyword">const</span> string &amp;name, <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;params) {
00223         <a class="code" href="api_8cpp.html#a4">VERIFY_OPTIONS</a>(<span class="stringliteral">"Accelerator"</span>);
00224         <a class="code" href="api_8cpp.html#a9">renderOptions</a>-&gt;<a class="code" href="structRenderOptions.html#o6">AcceleratorName</a> = name;
00225         <a class="code" href="api_8cpp.html#a9">renderOptions</a>-&gt;<a class="code" href="structRenderOptions.html#o7">AcceleratorParams</a> = params;
00226 }
<a name="l00227"></a><a class="code" href="api_8h.html#a13">00227</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8h.html#a13">pbrtSurfaceIntegrator</a>(<span class="keyword">const</span> string &amp;name, <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;params) {
00228         <a class="code" href="api_8cpp.html#a4">VERIFY_OPTIONS</a>(<span class="stringliteral">"SurfaceIntegrator"</span>);
00229         <a class="code" href="api_8cpp.html#a9">renderOptions</a>-&gt;<a class="code" href="structRenderOptions.html#o8">SurfIntegratorName</a> = name;
00230         <a class="code" href="api_8cpp.html#a9">renderOptions</a>-&gt;<a class="code" href="structRenderOptions.html#o10">SurfIntegratorParams</a> = params;
00231 }
<a name="l00232"></a><a class="code" href="api_8h.html#a14">00232</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8h.html#a14">pbrtVolumeIntegrator</a>(<span class="keyword">const</span> string &amp;name, <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;params) {
00233         <a class="code" href="api_8cpp.html#a4">VERIFY_OPTIONS</a>(<span class="stringliteral">"VolumeIntegrator"</span>);
00234         <a class="code" href="api_8cpp.html#a9">renderOptions</a>-&gt;<a class="code" href="structRenderOptions.html#o9">VolIntegratorName</a> = name;
00235         <a class="code" href="api_8cpp.html#a9">renderOptions</a>-&gt;<a class="code" href="structRenderOptions.html#o11">VolIntegratorParams</a> = params;
00236 }
<a name="l00237"></a><a class="code" href="api_8h.html#a15">00237</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8h.html#a15">pbrtCamera</a>(<span class="keyword">const</span> string &amp;name,
00238                        <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;params) {
00239         <a class="code" href="api_8cpp.html#a4">VERIFY_OPTIONS</a>(<span class="stringliteral">"Camera"</span>);
00240         <a class="code" href="api_8cpp.html#a9">renderOptions</a>-&gt;<a class="code" href="structRenderOptions.html#o12">CameraName</a> = name;
00241         <a class="code" href="api_8cpp.html#a9">renderOptions</a>-&gt;<a class="code" href="structRenderOptions.html#o13">CameraParams</a> = params;
00242         <a class="code" href="api_8cpp.html#a9">renderOptions</a>-&gt;<a class="code" href="structRenderOptions.html#o14">WorldToCamera</a> = <a class="code" href="api_8cpp.html#a7">curTransform</a>;
00243         <a class="code" href="api_8cpp.html#a8">namedCoordinateSystems</a>[<span class="stringliteral">"camera"</span>] =
00244                 <a class="code" href="api_8cpp.html#a7">curTransform</a>.<a class="code" href="classTransform.html#a4">GetInverse</a>();
00245 }
<a name="l00246"></a><a class="code" href="api_8h.html#a16">00246</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8h.html#a16">pbrtSearchPath</a>(<span class="keyword">const</span> string &amp;path) {
00247         <a class="code" href="api_8cpp.html#a4">VERIFY_OPTIONS</a>(<span class="stringliteral">"SearchPath"</span>);
00248         <a class="code" href="dynload_8h.html#a0">UpdatePluginPath</a>(path);
00249         <a class="code" href="api_8cpp.html#a9">renderOptions</a>-&gt;<a class="code" href="structRenderOptions.html#o15">gotSearchPath</a> = <span class="keyword">true</span>;
00250 }
<a name="l00251"></a><a class="code" href="api_8h.html#a17">00251</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#a32">pbrtWorldBegin</a>() {
00252         <a class="code" href="api_8cpp.html#a4">VERIFY_OPTIONS</a>(<span class="stringliteral">"WorldBegin"</span>);
00253         <a class="code" href="api_8cpp.html#a6">currentApiState</a> = <a class="code" href="api_8cpp.html#a2">STATE_WORLD_BLOCK</a>;
00254         <a class="code" href="api_8cpp.html#a7">curTransform</a> = <a class="code" href="classTransform.html">Transform</a>();
00255         <a class="code" href="api_8cpp.html#a8">namedCoordinateSystems</a>[<span class="stringliteral">"world"</span>] = <a class="code" href="api_8cpp.html#a7">curTransform</a>;
00256 }
<a name="l00257"></a><a class="code" href="api_8h.html#a18">00257</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#a33">pbrtAttributeBegin</a>() {
00258         <a class="code" href="api_8cpp.html#a5">VERIFY_WORLD</a>(<span class="stringliteral">"AttributeBegin"</span>);
00259         <a class="code" href="api_8cpp.html#a11">pushedGraphicsStates</a>.push_back(<a class="code" href="api_8cpp.html#a10">graphicsState</a>);
00260         <a class="code" href="api_8cpp.html#a12">pushedTransforms</a>.push_back(<a class="code" href="api_8cpp.html#a7">curTransform</a>);
00261 }
<a name="l00262"></a><a class="code" href="api_8h.html#a19">00262</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#a34">pbrtAttributeEnd</a>() {
00263         <a class="code" href="api_8cpp.html#a5">VERIFY_WORLD</a>(<span class="stringliteral">"AttributeEnd"</span>);
00264         <span class="keywordflow">if</span> (!<a class="code" href="api_8cpp.html#a11">pushedGraphicsStates</a>.size()) {
00265                 <a class="code" href="util_8cpp.html#a16">Error</a>(<span class="stringliteral">"Unmatched pbrtAttributeEnd() encountered. "</span>
00266                         <span class="stringliteral">"Ignoring it."</span>);
00267                 <span class="keywordflow">return</span>;
00268         }
00269         <a class="code" href="api_8cpp.html#a10">graphicsState</a> = <a class="code" href="api_8cpp.html#a11">pushedGraphicsStates</a>.back();
00270         <a class="code" href="api_8cpp.html#a7">curTransform</a> = <a class="code" href="api_8cpp.html#a12">pushedTransforms</a>.back();
00271         <a class="code" href="api_8cpp.html#a11">pushedGraphicsStates</a>.pop_back();
00272         <a class="code" href="api_8cpp.html#a12">pushedTransforms</a>.pop_back();
00273 }
<a name="l00274"></a><a class="code" href="api_8h.html#a20">00274</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#a35">pbrtTransformBegin</a>() {
00275         <a class="code" href="api_8cpp.html#a5">VERIFY_WORLD</a>(<span class="stringliteral">"TransformBegin"</span>);
00276         <a class="code" href="api_8cpp.html#a12">pushedTransforms</a>.push_back(<a class="code" href="api_8cpp.html#a7">curTransform</a>);
00277 }
<a name="l00278"></a><a class="code" href="api_8h.html#a21">00278</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#a36">pbrtTransformEnd</a>() {
00279         <a class="code" href="api_8cpp.html#a5">VERIFY_WORLD</a>(<span class="stringliteral">"TransformEnd"</span>);
00280         <span class="keywordflow">if</span> (!<a class="code" href="api_8cpp.html#a12">pushedTransforms</a>.size()) {
00281                 <a class="code" href="util_8cpp.html#a16">Error</a>(<span class="stringliteral">"Unmatched pbrtTransformEnd() encountered. "</span>
00282                         <span class="stringliteral">"Ignoring it."</span>);
00283                 <span class="keywordflow">return</span>;
00284         }
00285         <a class="code" href="api_8cpp.html#a7">curTransform</a> = <a class="code" href="api_8cpp.html#a12">pushedTransforms</a>.back();
00286         <a class="code" href="api_8cpp.html#a12">pushedTransforms</a>.pop_back();
00287 }
<a name="l00288"></a><a class="code" href="api_8h.html#a22">00288</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8h.html#a22">pbrtTexture</a>(<span class="keyword">const</span> string &amp;name,
00289                          <span class="keyword">const</span> string &amp;type,
00290                                                  <span class="keyword">const</span> string &amp;texname,
00291                                                  <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;params) {
00292         <a class="code" href="api_8cpp.html#a5">VERIFY_WORLD</a>(<span class="stringliteral">"Texture"</span>);
00293         <a class="code" href="classTextureParams.html">TextureParams</a> tp(params, params,
00294                          <a class="code" href="api_8cpp.html#a10">graphicsState</a>.<a class="code" href="structGraphicsState.html#o0">floatTextures</a>,
00295                              <a class="code" href="api_8cpp.html#a10">graphicsState</a>.<a class="code" href="structGraphicsState.html#o1">spectrumTextures</a>);
00296         <span class="keywordflow">if</span> (type == <span class="stringliteral">"float"</span>)  {
00297                 <span class="comment">// Create _float_ texture and store in _floatTextures_</span>
00298                 <span class="keywordflow">if</span> (<a class="code" href="api_8cpp.html#a10">graphicsState</a>.<a class="code" href="structGraphicsState.html#o0">floatTextures</a>.find(name) !=
00299                     <a class="code" href="api_8cpp.html#a10">graphicsState</a>.<a class="code" href="structGraphicsState.html#o0">floatTextures</a>.end())
00300                         <a class="code" href="util_8cpp.html#a15">Warning</a>(<span class="stringliteral">"Texture \"%s\" being redefined"</span>, name.c_str());
00301                 <a class="code" href="classReference.html">Reference&lt;Texture&lt;float&gt;</a> &gt; ft = <a class="code" href="dynload_8h.html#a3">MakeFloatTexture</a>(texname,
00302                         <a class="code" href="api_8cpp.html#a7">curTransform</a>, tp);
00303                 <span class="keywordflow">if</span> (ft) <a class="code" href="api_8cpp.html#a10">graphicsState</a>.<a class="code" href="structGraphicsState.html#o0">floatTextures</a>[name] = ft;
00304         }
00305         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == <span class="stringliteral">"color"</span>)  {
00306                 <span class="comment">// Create _color_ texture and store in _spectrumTextures_</span>
00307                 <span class="keywordflow">if</span> (<a class="code" href="api_8cpp.html#a10">graphicsState</a>.<a class="code" href="structGraphicsState.html#o1">spectrumTextures</a>.find(name) != <a class="code" href="api_8cpp.html#a10">graphicsState</a>.<a class="code" href="structGraphicsState.html#o1">spectrumTextures</a>.end())
00308                         <a class="code" href="util_8cpp.html#a15">Warning</a>(<span class="stringliteral">"Texture \"%s\" being redefined"</span>, name.c_str());
00309                 <a class="code" href="classReference.html">Reference&lt;Texture&lt;Spectrum&gt;</a> &gt; st = <a class="code" href="dynload_8h.html#a4">MakeSpectrumTexture</a>(texname,
00310                         <a class="code" href="api_8cpp.html#a7">curTransform</a>, tp);
00311                 <span class="keywordflow">if</span> (st) <a class="code" href="api_8cpp.html#a10">graphicsState</a>.<a class="code" href="structGraphicsState.html#o1">spectrumTextures</a>[name] = st;
00312         }
00313         <span class="keywordflow">else</span>
00314                 <a class="code" href="util_8cpp.html#a16">Error</a>(<span class="stringliteral">"Texture type \"%s\" unknown."</span>, type.c_str());
00315 }
<a name="l00316"></a><a class="code" href="api_8h.html#a23">00316</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8h.html#a23">pbrtMaterial</a>(<span class="keyword">const</span> string &amp;name, <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;params) {
00317         <a class="code" href="api_8cpp.html#a5">VERIFY_WORLD</a>(<span class="stringliteral">"Material"</span>);
00318         <a class="code" href="api_8cpp.html#a10">graphicsState</a>.<a class="code" href="structGraphicsState.html#o3">material</a> = name;
00319         <a class="code" href="api_8cpp.html#a10">graphicsState</a>.<a class="code" href="structGraphicsState.html#o2">materialParams</a> = params;
00320 }
<a name="l00321"></a><a class="code" href="api_8h.html#a24">00321</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8h.html#a24">pbrtLightSource</a>(<span class="keyword">const</span> string &amp;name,
00322                              <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;params) {
00323         <a class="code" href="api_8cpp.html#a5">VERIFY_WORLD</a>(<span class="stringliteral">"LightSource"</span>);
00324         <a class="code" href="classLight.html">Light</a> *lt = <a class="code" href="dynload_8h.html#a5">MakeLight</a>(name, <a class="code" href="api_8cpp.html#a7">curTransform</a>, params);
00325         <span class="keywordflow">if</span> (lt == NULL)
00326                 <a class="code" href="util_8cpp.html#a16">Error</a>(<span class="stringliteral">"pbrtLightSource: light type "</span>
00327                       <span class="stringliteral">"\"%s\" unknown."</span>, name.c_str());
00328         <span class="keywordflow">else</span>
00329                 <a class="code" href="api_8cpp.html#a9">renderOptions</a>-&gt;<a class="code" href="structRenderOptions.html#o16">lights</a>.push_back(lt);
00330 }
<a name="l00331"></a><a class="code" href="api_8h.html#a25">00331</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8h.html#a25">pbrtAreaLightSource</a>(<span class="keyword">const</span> string &amp;name,
00332                                  <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;params) {
00333         <a class="code" href="api_8cpp.html#a5">VERIFY_WORLD</a>(<span class="stringliteral">"AreaLightSource"</span>);
00334         <a class="code" href="api_8cpp.html#a10">graphicsState</a>.<a class="code" href="structGraphicsState.html#o5">areaLight</a> = name;
00335         <a class="code" href="api_8cpp.html#a10">graphicsState</a>.<a class="code" href="structGraphicsState.html#o4">areaLightParams</a> = params;
00336 }
<a name="l00337"></a><a class="code" href="api_8h.html#a26">00337</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8h.html#a26">pbrtShape</a>(<span class="keyword">const</span> string &amp;name,
00338                        <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;params) {
00339         <a class="code" href="api_8cpp.html#a5">VERIFY_WORLD</a>(<span class="stringliteral">"Shape"</span>);
00340         <a class="code" href="classReference.html">Reference&lt;Shape&gt;</a> shape = <a class="code" href="dynload_8h.html#a1">MakeShape</a>(name,
00341                 <a class="code" href="api_8cpp.html#a7">curTransform</a>, <a class="code" href="api_8cpp.html#a10">graphicsState</a>.<a class="code" href="structGraphicsState.html#o6">reverseOrientation</a>,
00342                 params);
00343         <span class="keywordflow">if</span> (!shape) <span class="keywordflow">return</span>;
00344         params.<a class="code" href="classParamSet.html#a38">ReportUnused</a>();
00345         <span class="comment">// Initialize area light for shape</span>
00346         <a class="code" href="classAreaLight.html">AreaLight</a> *area = NULL;
00347         <span class="keywordflow">if</span> (<a class="code" href="api_8cpp.html#a10">graphicsState</a>.<a class="code" href="structGraphicsState.html#o5">areaLight</a> != <span class="stringliteral">""</span>)
00348                 area = <a class="code" href="dynload_8h.html#a6">MakeAreaLight</a>(<a class="code" href="api_8cpp.html#a10">graphicsState</a>.<a class="code" href="structGraphicsState.html#o5">areaLight</a>,
00349                 <a class="code" href="api_8cpp.html#a7">curTransform</a>, <a class="code" href="api_8cpp.html#a10">graphicsState</a>.<a class="code" href="structGraphicsState.html#o4">areaLightParams</a>, shape);
00350         <span class="comment">// Initialize material for shape</span>
00351         <a class="code" href="classTextureParams.html">TextureParams</a> mp(params,
00352                          <a class="code" href="api_8cpp.html#a10">graphicsState</a>.<a class="code" href="structGraphicsState.html#o2">materialParams</a>,
00353                                          <a class="code" href="api_8cpp.html#a10">graphicsState</a>.<a class="code" href="structGraphicsState.html#o0">floatTextures</a>,
00354                                          <a class="code" href="api_8cpp.html#a10">graphicsState</a>.<a class="code" href="structGraphicsState.html#o1">spectrumTextures</a>);
00355         <a class="code" href="classReference.html">Reference&lt;Texture&lt;float&gt;</a> &gt; bump = NULL;
00356         <a class="code" href="classReference.html">Reference&lt;Material&gt;</a> mtl =
00357                 <a class="code" href="dynload_8h.html#a2">MakeMaterial</a>(<a class="code" href="api_8cpp.html#a10">graphicsState</a>.<a class="code" href="structGraphicsState.html#o3">material</a>,
00358                              <a class="code" href="api_8cpp.html#a7">curTransform</a>, mp);
00359         <span class="keywordflow">if</span> (!mtl)
00360                 mtl = <a class="code" href="dynload_8h.html#a2">MakeMaterial</a>(<span class="stringliteral">"matte"</span>, <a class="code" href="api_8cpp.html#a7">curTransform</a>, mp);
00361         <span class="keywordflow">if</span> (!mtl)
00362                 <a class="code" href="util_8cpp.html#a17">Severe</a>(<span class="stringliteral">"Unable to create \"matte\" material?!"</span>);
00363         <span class="comment">// Create primitive and add to scene or current instance</span>
00364         <a class="code" href="classReference.html">Reference&lt;Primitive&gt;</a> prim =
00365                 <span class="keyword">new</span> <a class="code" href="classGeometricPrimitive.html">GeometricPrimitive</a>(shape, mtl, area);
00366         <span class="keywordflow">if</span> (<a class="code" href="api_8cpp.html#a9">renderOptions</a>-&gt;<a class="code" href="structRenderOptions.html#o20">currentInstance</a>) {
00367                 <span class="keywordflow">if</span> (area)
00368                         <a class="code" href="util_8cpp.html#a15">Warning</a>(<span class="stringliteral">"Area lights not supported "</span>
00369                                 <span class="stringliteral">"with object instancing"</span>);
00370                 <a class="code" href="api_8cpp.html#a9">renderOptions</a>-&gt;<a class="code" href="structRenderOptions.html#o20">currentInstance</a>-&gt;push_back(prim);
00371         }
00372         <span class="keywordflow">else</span> {
00373                 <a class="code" href="api_8cpp.html#a9">renderOptions</a>-&gt;<a class="code" href="structRenderOptions.html#o17">primitives</a>.push_back(prim);
00374                 <span class="keywordflow">if</span> (area != NULL) {
00375                         <span class="comment">// Add area light for primitive to light vector</span>
00376                         <a class="code" href="api_8cpp.html#a9">renderOptions</a>-&gt;<a class="code" href="structRenderOptions.html#o16">lights</a>.push_back(area);
00377                 }
00378         }
00379 }
<a name="l00380"></a><a class="code" href="api_8h.html#a27">00380</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#a42">pbrtReverseOrientation</a>() {
00381         <a class="code" href="api_8cpp.html#a5">VERIFY_WORLD</a>(<span class="stringliteral">"ReverseOrientation"</span>);
00382         <a class="code" href="api_8cpp.html#a10">graphicsState</a>.<a class="code" href="structGraphicsState.html#o6">reverseOrientation</a> =
00383                 !<a class="code" href="api_8cpp.html#a10">graphicsState</a>.<a class="code" href="structGraphicsState.html#o6">reverseOrientation</a>;
00384 }
<a name="l00385"></a><a class="code" href="api_8h.html#a28">00385</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8h.html#a28">pbrtVolume</a>(<span class="keyword">const</span> string &amp;name,
00386                         <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;params) {
00387         <a class="code" href="api_8cpp.html#a5">VERIFY_WORLD</a>(<span class="stringliteral">"Volume"</span>);
00388         <a class="code" href="classVolumeRegion.html">VolumeRegion</a> *vr = <a class="code" href="dynload_8h.html#a7">MakeVolumeRegion</a>(name,
00389                 <a class="code" href="api_8cpp.html#a7">curTransform</a>, params);
00390         <span class="keywordflow">if</span> (vr) <a class="code" href="api_8cpp.html#a9">renderOptions</a>-&gt;<a class="code" href="structRenderOptions.html#o18">volumeRegions</a>.push_back(vr);
00391 }
<a name="l00392"></a><a class="code" href="api_8h.html#a29">00392</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8h.html#a29">pbrtObjectBegin</a>(<span class="keyword">const</span> string &amp;name) {
00393         <a class="code" href="api_8cpp.html#a5">VERIFY_WORLD</a>(<span class="stringliteral">"ObjectBegin"</span>);
00394         <a class="code" href="api_8cpp.html#a33">pbrtAttributeBegin</a>();
00395         <span class="keywordflow">if</span> (<a class="code" href="api_8cpp.html#a9">renderOptions</a>-&gt;<a class="code" href="structRenderOptions.html#o20">currentInstance</a>)
00396                 <a class="code" href="util_8cpp.html#a16">Error</a>(<span class="stringliteral">"ObjectBegin called inside "</span>
00397                       <span class="stringliteral">"of instance definition"</span>);
00398         <a class="code" href="api_8cpp.html#a9">renderOptions</a>-&gt;<a class="code" href="structRenderOptions.html#o19">instances</a>[name] =
00399                 vector&lt;Reference&lt;Primitive&gt; &gt;();
00400         <a class="code" href="api_8cpp.html#a9">renderOptions</a>-&gt;<a class="code" href="structRenderOptions.html#o20">currentInstance</a> =
00401                 &amp;<a class="code" href="api_8cpp.html#a9">renderOptions</a>-&gt;<a class="code" href="structRenderOptions.html#o19">instances</a>[name];
00402 }
<a name="l00403"></a><a class="code" href="api_8h.html#a30">00403</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#a45">pbrtObjectEnd</a>() {
00404         <a class="code" href="api_8cpp.html#a5">VERIFY_WORLD</a>(<span class="stringliteral">"ObjectEnd"</span>);
00405         <span class="keywordflow">if</span> (!<a class="code" href="api_8cpp.html#a9">renderOptions</a>-&gt;<a class="code" href="structRenderOptions.html#o20">currentInstance</a>)
00406                 <a class="code" href="util_8cpp.html#a16">Error</a>(<span class="stringliteral">"ObjectEnd called outside "</span>
00407                       <span class="stringliteral">"of instance definition"</span>);
00408         <a class="code" href="api_8cpp.html#a9">renderOptions</a>-&gt;<a class="code" href="structRenderOptions.html#o20">currentInstance</a> = NULL;
00409         <a class="code" href="api_8cpp.html#a34">pbrtAttributeEnd</a>();
00410 }
<a name="l00411"></a><a class="code" href="api_8h.html#a31">00411</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8h.html#a31">pbrtObjectInstance</a>(<span class="keyword">const</span> string &amp;name) {
00412         <a class="code" href="api_8cpp.html#a5">VERIFY_WORLD</a>(<span class="stringliteral">"ObjectInstance"</span>);
00413         <span class="comment">// Object instance error checking</span>
00414         <span class="keywordflow">if</span> (<a class="code" href="api_8cpp.html#a9">renderOptions</a>-&gt;<a class="code" href="structRenderOptions.html#o20">currentInstance</a>) {
00415                 <a class="code" href="util_8cpp.html#a16">Error</a>(<span class="stringliteral">"ObjectInstance can't be called inside instance definition"</span>);
00416                 <span class="keywordflow">return</span>;
00417         }
00418         <span class="keywordflow">if</span> (<a class="code" href="api_8cpp.html#a9">renderOptions</a>-&gt;<a class="code" href="structRenderOptions.html#o19">instances</a>.find(name) == <a class="code" href="api_8cpp.html#a9">renderOptions</a>-&gt;<a class="code" href="structRenderOptions.html#o19">instances</a>.end()) {
00419                 <a class="code" href="util_8cpp.html#a16">Error</a>(<span class="stringliteral">"Unable to find instance named \"%s\""</span>, name.c_str());
00420                 <span class="keywordflow">return</span>;
00421         }
00422         vector&lt;Reference&lt;Primitive&gt; &gt; &amp;in =
00423                 <a class="code" href="api_8cpp.html#a9">renderOptions</a>-&gt;<a class="code" href="structRenderOptions.html#o19">instances</a>[name];
00424         <span class="keywordflow">if</span> (in.size() == 0) <span class="keywordflow">return</span>;
00425         <span class="keywordflow">if</span> (in.size() &gt; 1 || !in[0]-&gt;CanIntersect()) {
00426                 <span class="comment">// Refine instance _Primitive_s and create aggregate</span>
00427                 <a class="code" href="classReference.html">Reference&lt;Primitive&gt;</a> accel =
00428                         <a class="code" href="dynload_8h.html#a10">MakeAccelerator</a>(<a class="code" href="api_8cpp.html#a9">renderOptions</a>-&gt;<a class="code" href="structRenderOptions.html#o6">AcceleratorName</a>,
00429                                        in, <a class="code" href="api_8cpp.html#a9">renderOptions</a>-&gt;<a class="code" href="structRenderOptions.html#o7">AcceleratorParams</a>);
00430                 <span class="keywordflow">if</span> (!accel)
00431                         accel = <a class="code" href="dynload_8h.html#a10">MakeAccelerator</a>(<span class="stringliteral">"kdtree"</span>, in, <a class="code" href="classParamSet.html">ParamSet</a>());
00432                 <span class="keywordflow">if</span> (!accel)
00433                         <a class="code" href="util_8cpp.html#a17">Severe</a>(<span class="stringliteral">"Unable to find \"kdtree\" accelerator"</span>);
00434                 in.erase(in.begin(), in.end());
00435                 in.push_back(accel);
00436         }
00437         <a class="code" href="classReference.html">Reference&lt;Primitive&gt;</a> prim = <span class="keyword">new</span> <a class="code" href="classInstancePrimitive.html">InstancePrimitive</a>(in[0],
00438                 <a class="code" href="api_8cpp.html#a7">curTransform</a>);
00439         <a class="code" href="api_8cpp.html#a9">renderOptions</a>-&gt;<a class="code" href="structRenderOptions.html#o17">primitives</a>.push_back(prim);
00440 }
<a name="l00441"></a><a class="code" href="api_8h.html#a32">00441</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#a47">pbrtWorldEnd</a>() {
00442         <a class="code" href="api_8cpp.html#a5">VERIFY_WORLD</a>(<span class="stringliteral">"WorldEnd"</span>);
00443         <span class="comment">// Ensure the search path was set</span>
00444         <span class="keywordflow">if</span> (!<a class="code" href="api_8cpp.html#a9">renderOptions</a>-&gt;<a class="code" href="structRenderOptions.html#o15">gotSearchPath</a>)
00445                 <a class="code" href="util_8cpp.html#a17">Severe</a>(<span class="stringliteral">"PBRT_SEARCHPATH environment variable "</span>
00446                                   <span class="stringliteral">"wasn't set and a plug-in\n"</span>
00447                                       <span class="stringliteral">"search path wasn't given in the "</span>
00448                                                   <span class="stringliteral">"input (with the SearchPath "</span>
00449                                                   <span class="stringliteral">"directive).\n"</span>);
00450         <span class="comment">// Ensure there are no pushed graphics states</span>
00451         <span class="keywordflow">while</span> (<a class="code" href="api_8cpp.html#a11">pushedGraphicsStates</a>.size()) {
00452                 <a class="code" href="util_8cpp.html#a15">Warning</a>(<span class="stringliteral">"Missing end to pbrtAttributeBegin()"</span>);
00453                 <a class="code" href="api_8cpp.html#a11">pushedGraphicsStates</a>.pop_back();
00454                 <a class="code" href="api_8cpp.html#a12">pushedTransforms</a>.pop_back();
00455         }
00456         <span class="comment">// Create scene and render</span>
00457         <a class="code" href="classScene.html">Scene</a> *scene = <a class="code" href="api_8cpp.html#a9">renderOptions</a>-&gt;<a class="code" href="structRenderOptions.html#a1">MakeScene</a>();
00458         <span class="keywordflow">if</span> (scene) scene-&gt;<a class="code" href="classScene.html#a0">Render</a>();
00459         <span class="keyword">delete</span> scene;
00460         <span class="comment">// Clean up after rendering</span>
00461         <a class="code" href="api_8cpp.html#a6">currentApiState</a> = <a class="code" href="api_8cpp.html#a1">STATE_OPTIONS_BLOCK</a>;
00462         <a class="code" href="util_8cpp.html#a22">StatsPrint</a>(stdout);
00463         <a class="code" href="api_8cpp.html#a7">curTransform</a> = <a class="code" href="classTransform.html">Transform</a>();
00464         <a class="code" href="api_8cpp.html#a8">namedCoordinateSystems</a>.erase(<a class="code" href="api_8cpp.html#a8">namedCoordinateSystems</a>.begin(),
00465                 <a class="code" href="api_8cpp.html#a8">namedCoordinateSystems</a>.end());
00466 }
<a name="l00467"></a><a class="code" href="structRenderOptions.html#a1">00467</a> <a class="code" href="classScene.html">Scene</a> *<a class="code" href="structRenderOptions.html#a1">RenderOptions::MakeScene</a>()<span class="keyword"> const </span>{
00468         <span class="comment">// Create scene objects from API settings</span>
00469         <a class="code" href="classFilter.html">Filter</a> *filter = <a class="code" href="dynload_8h.html#a13">MakeFilter</a>(<a class="code" href="structRenderOptions.html#o0">FilterName</a>, <a class="code" href="structRenderOptions.html#o1">FilterParams</a>);
00470         <a class="code" href="classFilm.html">Film</a> *film = <a class="code" href="dynload_8h.html#a15">MakeFilm</a>(<a class="code" href="structRenderOptions.html#o2">FilmName</a>, <a class="code" href="structRenderOptions.html#o3">FilmParams</a>, filter);
00471         <a class="code" href="classCamera.html">Camera</a> *camera = <a class="code" href="dynload_8h.html#a11">MakeCamera</a>(<a class="code" href="structRenderOptions.html#o12">CameraName</a>, <a class="code" href="structRenderOptions.html#o13">CameraParams</a>,
00472                 <a class="code" href="structRenderOptions.html#o14">WorldToCamera</a>, film);
00473         <a class="code" href="classSampler.html">Sampler</a> *sampler = <a class="code" href="dynload_8h.html#a12">MakeSampler</a>(<a class="code" href="structRenderOptions.html#o4">SamplerName</a>, <a class="code" href="structRenderOptions.html#o5">SamplerParams</a>, film);
00474         <a class="code" href="classSurfaceIntegrator.html">SurfaceIntegrator</a> *surfaceIntegrator = <a class="code" href="dynload_8h.html#a8">MakeSurfaceIntegrator</a>(<a class="code" href="structRenderOptions.html#o8">SurfIntegratorName</a>,
00475                 <a class="code" href="structRenderOptions.html#o10">SurfIntegratorParams</a>);
00476         <a class="code" href="classVolumeIntegrator.html">VolumeIntegrator</a> *volumeIntegrator = <a class="code" href="dynload_8h.html#a9">MakeVolumeIntegrator</a>(<a class="code" href="structRenderOptions.html#o9">VolIntegratorName</a>,
00477                 <a class="code" href="structRenderOptions.html#o11">VolIntegratorParams</a>);
00478         <a class="code" href="classPrimitive.html">Primitive</a> *accelerator = <a class="code" href="dynload_8h.html#a10">MakeAccelerator</a>(<a class="code" href="structRenderOptions.html#o6">AcceleratorName</a>,
00479                 <a class="code" href="structRenderOptions.html#o17">primitives</a>, <a class="code" href="structRenderOptions.html#o7">AcceleratorParams</a>);
00480         <span class="keywordflow">if</span> (!accelerator) {
00481                 <a class="code" href="classParamSet.html">ParamSet</a> ps;
00482                 accelerator = <a class="code" href="dynload_8h.html#a10">MakeAccelerator</a>(<span class="stringliteral">"kdtree"</span>, <a class="code" href="structRenderOptions.html#o17">primitives</a>, ps);
00483         }
00484         <span class="keywordflow">if</span> (!accelerator)
00485                 <a class="code" href="util_8cpp.html#a17">Severe</a>(<span class="stringliteral">"Unable to find \"kdtree\" accelerator"</span>);
00486         <span class="comment">// Initialize _volumeRegion_ from volume region(s)</span>
00487         <a class="code" href="classVolumeRegion.html">VolumeRegion</a> *volumeRegion;
00488         <span class="keywordflow">if</span> (<a class="code" href="structRenderOptions.html#o18">volumeRegions</a>.size() == 0)
00489                 volumeRegion = NULL;
00490         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="structRenderOptions.html#o18">volumeRegions</a>.size() == 1)
00491                 volumeRegion = <a class="code" href="structRenderOptions.html#o18">volumeRegions</a>[0];
00492         <span class="keywordflow">else</span>
00493                 volumeRegion = <span class="keyword">new</span> <a class="code" href="classAggregateVolume.html">AggregateVolume</a>(volumeRegions);
00494         <span class="comment">// Make sure all plugins initialized properly</span>
00495         <span class="keywordflow">if</span> (!camera || !sampler || !film || !accelerator ||
00496                 !filter || !surfaceIntegrator || !volumeIntegrator) {
00497                 <a class="code" href="util_8cpp.html#a17">Severe</a>(<span class="stringliteral">"Unable to create scene due "</span>
00498                        <span class="stringliteral">"to missing plug-ins"</span>);
00499                 <span class="keywordflow">return</span> NULL;
00500         }
00501         <a class="code" href="classScene.html">Scene</a> *ret = <span class="keyword">new</span> <a class="code" href="classScene.html">Scene</a>(camera,
00502             surfaceIntegrator, volumeIntegrator,
00503                 sampler, accelerator, <a class="code" href="structRenderOptions.html#o16">lights</a>, volumeRegion);
00504         <span class="comment">// Erase primitives, lights, and volume regions from _RenderOptions_</span>
00505         <a class="code" href="structRenderOptions.html#o17">primitives</a>.erase(<a class="code" href="structRenderOptions.html#o17">primitives</a>.begin(),
00506                         <a class="code" href="structRenderOptions.html#o17">primitives</a>.end());
00507         <a class="code" href="structRenderOptions.html#o16">lights</a>.erase(<a class="code" href="structRenderOptions.html#o16">lights</a>.begin(),
00508                     <a class="code" href="structRenderOptions.html#o16">lights</a>.end());
00509         volumeRegions.erase(volumeRegions.begin(),
00510                           volumeRegions.end());
00511         <span class="keywordflow">return</span> ret;
00512 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Mon Apr 25 19:00:19 2005 for pbrt by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
