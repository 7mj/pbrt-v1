<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>pbrt: texture.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>texture.cpp</h1><a href="texture_8cpp.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 
00002 <span class="comment">/*</span>
00003 <span class="comment"> * pbrt source code Copyright(c) 1998-2005 Matt Pharr and Greg Humphreys</span>
00004 <span class="comment"> *</span>
00005 <span class="comment"> * All Rights Reserved.</span>
00006 <span class="comment"> * For educational use only; commercial use expressly forbidden.</span>
00007 <span class="comment"> * NO WARRANTY, express or implied, for this software.</span>
00008 <span class="comment"> * (See file License.txt for complete license)</span>
00009 <span class="comment"> */</span>
00010 
00011 <span class="comment">// texture.cpp*</span>
00012 <span class="preprocessor">#include "<a class="code" href="texture_8h.html">texture.h</a>"</span>
00013 <span class="preprocessor">#include "<a class="code" href="shape_8h.html">shape.h</a>"</span>
00014 <span class="comment">// Texture Forward Declarations</span>
00015 <span class="keyword">inline</span> <span class="keywordtype">float</span> <a class="code" href="texture_8cpp.html#a2">Grad</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">int</span> z, <span class="keywordtype">float</span> dx, <span class="keywordtype">float</span> dy, <span class="keywordtype">float</span> dz);
00016 <span class="keyword">inline</span> <span class="keywordtype">float</span> <a class="code" href="texture_8cpp.html#a3">NoiseWeight</a>(<span class="keywordtype">float</span> t);
00017 <span class="comment">// Perlin Noise Data</span>
<a name="l00018"></a><a class="code" href="texture_8cpp.html#a0">00018</a> <span class="preprocessor">#define NOISE_PERM_SIZE 256</span>
<a name="l00019"></a><a class="code" href="texture_8cpp.html#a1">00019</a> <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="texture_8cpp.html#a1">NoisePerm</a>[2 * <a class="code" href="texture_8cpp.html#a0">NOISE_PERM_SIZE</a>] = {
00020         151, 160, 137, 91, 90, 15, 131, 13, 201, 95, 96,
00021         53, 194, 233, 7, 225, 140, 36, 103, 30, 69, 142,
00022         <span class="comment">// Rest of noise permutation table</span>
00023         8, 99, 37, 240, 21, 10, 23,
00024            190,  6, 148, 247, 120, 234, 75, 0, 26, 197, 62, 94, 252, 219, 203, 117, 35, 11, 32, 57, 177, 33,
00025            88, 237, 149, 56, 87, 174, 20, 125, 136, 171, 168,  68, 175, 74, 165, 71, 134, 139, 48, 27, 166,
00026            77, 146, 158, 231, 83, 111, 229, 122, 60, 211, 133, 230, 220, 105, 92, 41, 55, 46, 245, 40, 244,
00027            102, 143, 54,  65, 25, 63, 161,  1, 216, 80, 73, 209, 76, 132, 187, 208,  89, 18, 169, 200, 196,
00028            135, 130, 116, 188, 159, 86, 164, 100, 109, 198, 173, 186,  3, 64, 52, 217, 226, 250, 124, 123,
00029            5, 202, 38, 147, 118, 126, 255, 82, 85, 212, 207, 206, 59, 227, 47, 16, 58, 17, 182, 189, 28, 42,
00030            223, 183, 170, 213, 119, 248, 152,  2, 44, 154, 163,  70, 221, 153, 101, 155, 167,  43, 172, 9,
00031            129, 22, 39, 253,  19, 98, 108, 110, 79, 113, 224, 232, 178, 185,  112, 104, 218, 246, 97, 228,
00032            251, 34, 242, 193, 238, 210, 144, 12, 191, 179, 162, 241,  81, 51, 145, 235, 249, 14, 239, 107,
00033            49, 192, 214,  31, 181, 199, 106, 157, 184,  84, 204, 176, 115, 121, 50, 45, 127,  4, 150, 254,
00034            138, 236, 205, 93, 222, 114, 67, 29, 24, 72, 243, 141, 128, 195, 78, 66, 215, 61, 156, 180,
00035            151, 160, 137, 91, 90, 15,
00036            131, 13, 201, 95, 96, 53, 194, 233, 7, 225, 140, 36, 103, 30, 69, 142, 8, 99, 37, 240, 21, 10, 23,
00037            190,  6, 148, 247, 120, 234, 75, 0, 26, 197, 62, 94, 252, 219, 203, 117, 35, 11, 32, 57, 177, 33,
00038            88, 237, 149, 56, 87, 174, 20, 125, 136, 171, 168,  68, 175, 74, 165, 71, 134, 139, 48, 27, 166,
00039            77, 146, 158, 231, 83, 111, 229, 122, 60, 211, 133, 230, 220, 105, 92, 41, 55, 46, 245, 40, 244,
00040            102, 143, 54,  65, 25, 63, 161,  1, 216, 80, 73, 209, 76, 132, 187, 208,  89, 18, 169, 200, 196,
00041            135, 130, 116, 188, 159, 86, 164, 100, 109, 198, 173, 186,  3, 64, 52, 217, 226, 250, 124, 123,
00042            5, 202, 38, 147, 118, 126, 255, 82, 85, 212, 207, 206, 59, 227, 47, 16, 58, 17, 182, 189, 28, 42,
00043            223, 183, 170, 213, 119, 248, 152,  2, 44, 154, 163,  70, 221, 153, 101, 155, 167,  43, 172, 9,
00044            129, 22, 39, 253,  19, 98, 108, 110, 79, 113, 224, 232, 178, 185,  112, 104, 218, 246, 97, 228,
00045            251, 34, 242, 193, 238, 210, 144, 12, 191, 179, 162, 241,  81, 51, 145, 235, 249, 14, 239, 107,
00046            49, 192, 214,  31, 181, 199, 106, 157, 184,  84, 204, 176, 115, 121, 50, 45, 127,  4, 150, 254,
00047            138, 236, 205, 93, 222, 114, 67, 29, 24, 72, 243, 141, 128, 195, 78, 66, 215, 61, 156, 180
00048 };
00049 <span class="comment">// Texture Method Definitions</span>
<a name="l00050"></a><a class="code" href="classUVMapping2D.html#a0">00050</a> <a class="code" href="classUVMapping2D.html#a0">UVMapping2D::UVMapping2D</a>(<span class="keywordtype">float</span> _su, <span class="keywordtype">float</span> _sv,
00051                 <span class="keywordtype">float</span> _du, <span class="keywordtype">float</span> _dv) {
00052         <a class="code" href="classUVMapping2D.html#r0">su</a> = _su; <a class="code" href="classUVMapping2D.html#r1">sv</a> = _sv;
00053         <a class="code" href="classUVMapping2D.html#r2">du</a> = _du; <a class="code" href="classUVMapping2D.html#r3">dv</a> = _dv;
00054 }
<a name="l00055"></a><a class="code" href="classUVMapping2D.html#a1">00055</a> <span class="keywordtype">void</span> <a class="code" href="classUVMapping2D.html#a1">UVMapping2D::Map</a>(<span class="keyword">const</span> <a class="code" href="structDifferentialGeometry.html">DifferentialGeometry</a> &amp;dg,
00056                 <span class="keywordtype">float</span> *s, <span class="keywordtype">float</span> *t, <span class="keywordtype">float</span> *dsdx, <span class="keywordtype">float</span> *dtdx,
00057                 <span class="keywordtype">float</span> *dsdy, <span class="keywordtype">float</span> *dtdy)<span class="keyword"> const </span>{
00058         *s = <a class="code" href="classUVMapping2D.html#r0">su</a> * dg.<a class="code" href="structDifferentialGeometry.html#o2">u</a> + <a class="code" href="classUVMapping2D.html#r2">du</a>;
00059         *t = <a class="code" href="classUVMapping2D.html#r1">sv</a> * dg.<a class="code" href="structDifferentialGeometry.html#o3">v</a> + <a class="code" href="classUVMapping2D.html#r3">dv</a>;
00060         <span class="comment">// Compute texture differentials for 2D identity mapping</span>
00061         *dsdx = <a class="code" href="classUVMapping2D.html#r0">su</a> * dg.<a class="code" href="structDifferentialGeometry.html#o11">dudx</a>;
00062         *dtdx = <a class="code" href="classUVMapping2D.html#r1">sv</a> * dg.<a class="code" href="structDifferentialGeometry.html#o12">dvdx</a>;
00063         *dsdy = <a class="code" href="classUVMapping2D.html#r0">su</a> * dg.<a class="code" href="structDifferentialGeometry.html#o13">dudy</a>;
00064         *dtdy = <a class="code" href="classUVMapping2D.html#r1">sv</a> * dg.<a class="code" href="structDifferentialGeometry.html#o14">dvdy</a>;
00065 }
<a name="l00066"></a><a class="code" href="classSphericalMapping2D.html#a1">00066</a> <span class="keywordtype">void</span> <a class="code" href="classSphericalMapping2D.html#a1">SphericalMapping2D::Map</a>(<span class="keyword">const</span> <a class="code" href="structDifferentialGeometry.html">DifferentialGeometry</a> &amp;dg,
00067                 <span class="keywordtype">float</span> *s, <span class="keywordtype">float</span> *t, <span class="keywordtype">float</span> *dsdx, <span class="keywordtype">float</span> *dtdx,
00068                 <span class="keywordtype">float</span> *dsdy, <span class="keywordtype">float</span> *dtdy)<span class="keyword"> const </span>{
00069         <a class="code" href="classSphericalMapping2D.html#d0">sphere</a>(dg.<a class="code" href="structDifferentialGeometry.html#o0">p</a>, s, t);
00070         <span class="comment">// Compute texture coordinate differentials for sphere $(u,v)$ mapping</span>
00071         <span class="keywordtype">float</span> sx, tx, sy, ty;
00072         <span class="keyword">const</span> <span class="keywordtype">float</span> delta = .1f;
00073         <a class="code" href="classSphericalMapping2D.html#d0">sphere</a>(dg.<a class="code" href="structDifferentialGeometry.html#o0">p</a> + delta * dg.<a class="code" href="structDifferentialGeometry.html#o9">dpdx</a>, &amp;sx, &amp;tx);
00074         *dsdx = (sx - *s) / delta;
00075         *dtdx = (tx - *t) / delta;
00076         <span class="keywordflow">if</span> (*dtdx &gt; .5) *dtdx = 1.f - *dtdx;
00077         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*dtdx &lt; -.5f) *dtdx = -(*dtdx + 1);
00078         <a class="code" href="classSphericalMapping2D.html#d0">sphere</a>(dg.<a class="code" href="structDifferentialGeometry.html#o0">p</a> + delta * dg.<a class="code" href="structDifferentialGeometry.html#o10">dpdy</a>, &amp;sy, &amp;ty);
00079         *dsdy = (sy - *s) / delta;
00080         *dtdy = (ty - *t) / delta;
00081         <span class="keywordflow">if</span> (*dtdy &gt; .5) *dtdy = 1.f - *dtdy;
00082         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*dtdy &lt; -.5f) *dtdy = -(*dtdy + 1);
00083 }
<a name="l00084"></a><a class="code" href="classSphericalMapping2D.html#d0">00084</a> <span class="keywordtype">void</span> <a class="code" href="classSphericalMapping2D.html#d0">SphericalMapping2D::sphere</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point</a> &amp;p, <span class="keywordtype">float</span> *s,
00085                 <span class="keywordtype">float</span> *t)<span class="keyword"> const </span>{
00086         <a class="code" href="classVector.html">Vector</a> vec =
00087                 <a class="code" href="geometry_8h.html#a14">Normalize</a>(<a class="code" href="classSphericalMapping2D.html#r0">WorldToTexture</a>(p) - <a class="code" href="classPoint.html">Point</a>(0,0,0));
00088         <span class="keywordtype">float</span> theta = <a class="code" href="geometry_8h.html#a26">SphericalTheta</a>(vec);
00089         <span class="keywordtype">float</span> phi = <a class="code" href="geometry_8h.html#a27">SphericalPhi</a>(vec);
00090         *s = theta * <a class="code" href="pbrt_8h.html#a7">INV_PI</a>;
00091         *t = phi * <a class="code" href="pbrt_8h.html#a8">INV_TWOPI</a>;
00092 }
00093 <span class="keywordtype">void</span>
<a name="l00094"></a><a class="code" href="classCylindricalMapping2D.html#a1">00094</a> <a class="code" href="classCylindricalMapping2D.html#a1">CylindricalMapping2D::Map</a>(<span class="keyword">const</span> <a class="code" href="structDifferentialGeometry.html">DifferentialGeometry</a> &amp;dg,
00095                 <span class="keywordtype">float</span> *s, <span class="keywordtype">float</span> *t, <span class="keywordtype">float</span> *dsdx, <span class="keywordtype">float</span> *dtdx,
00096                 <span class="keywordtype">float</span> *dsdy, <span class="keywordtype">float</span> *dtdy)<span class="keyword"> const </span>{
00097         <a class="code" href="classCylindricalMapping2D.html#d0">cylinder</a>(dg.<a class="code" href="structDifferentialGeometry.html#o0">p</a>, s, t);
00098         <span class="comment">// Compute texture coordinate differentials for cylinder $(u,v)$ mapping</span>
00099         <span class="keywordtype">float</span> sx, tx, sy, ty;
00100         <span class="keyword">const</span> <span class="keywordtype">float</span> delta = .01f;
00101         <a class="code" href="classCylindricalMapping2D.html#d0">cylinder</a>(dg.<a class="code" href="structDifferentialGeometry.html#o0">p</a> + delta * dg.<a class="code" href="structDifferentialGeometry.html#o9">dpdx</a>, &amp;sx, &amp;tx);
00102         *dsdx = (sx - *s) / delta;
00103         *dtdx = (tx - *t) / delta;
00104         <span class="keywordflow">if</span> (*dtdx &gt; .5) *dtdx = 1.f - *dtdx;
00105         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*dtdx &lt; -.5f) *dtdx = -(*dtdx + 1);
00106         <a class="code" href="classCylindricalMapping2D.html#d0">cylinder</a>(dg.<a class="code" href="structDifferentialGeometry.html#o0">p</a> + delta * dg.<a class="code" href="structDifferentialGeometry.html#o10">dpdy</a>, &amp;sy, &amp;ty);
00107         *dsdy = (sy - *s) / delta;
00108         *dtdy = (ty - *t) / delta;
00109         <span class="keywordflow">if</span> (*dtdy &gt; .5) *dtdy = 1.f - *dtdy;
00110         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*dtdy &lt; -.5f) *dtdx = -(*dtdy + 1);
00111 }
<a name="l00112"></a><a class="code" href="classCylindricalMapping2D.html#d0">00112</a> <span class="keywordtype">void</span> <a class="code" href="classCylindricalMapping2D.html#d0">CylindricalMapping2D::cylinder</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point</a> &amp;p,
00113                 <span class="keywordtype">float</span> *s, <span class="keywordtype">float</span> *t)<span class="keyword"> const </span>{
00114         <a class="code" href="classVector.html">Vector</a> vec =
00115                 <a class="code" href="geometry_8h.html#a14">Normalize</a>(<a class="code" href="classCylindricalMapping2D.html#r0">WorldToTexture</a>(p) - <a class="code" href="classPoint.html">Point</a>(0,0,0));
00116         *s = (<a class="code" href="pbrt_8h.html#a6">M_PI</a> + atan2f(vec.<a class="code" href="classVector.html#o1">y</a>, vec.<a class="code" href="classVector.html#o0">x</a>)) / (2.f * <a class="code" href="pbrt_8h.html#a6">M_PI</a>);
00117         *t = vec.<a class="code" href="classVector.html#o2">z</a>;
00118 }
<a name="l00119"></a><a class="code" href="classPlanarMapping2D.html#a0">00119</a> <a class="code" href="classPlanarMapping2D.html#a0">PlanarMapping2D::PlanarMapping2D</a>(<span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a> &amp;_v1,
00120                 <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a> &amp;_v2, <span class="keywordtype">float</span> _ds, <span class="keywordtype">float</span> _dt) {
00121         <a class="code" href="classPlanarMapping2D.html#r0">vs</a> = _v1;
00122         <a class="code" href="classPlanarMapping2D.html#r1">vt</a> = _v2;
00123         <a class="code" href="classPlanarMapping2D.html#r2">ds</a> = _ds;
00124         <a class="code" href="classPlanarMapping2D.html#r3">dt</a> = _dt;
00125 }
<a name="l00126"></a><a class="code" href="classPlanarMapping2D.html#a1">00126</a> <span class="keywordtype">void</span> <a class="code" href="classPlanarMapping2D.html#a1">PlanarMapping2D::Map</a>(<span class="keyword">const</span> <a class="code" href="structDifferentialGeometry.html">DifferentialGeometry</a> &amp;dg,
00127                 <span class="keywordtype">float</span> *s, <span class="keywordtype">float</span> *t, <span class="keywordtype">float</span> *dsdx, <span class="keywordtype">float</span> *dtdx,
00128                 <span class="keywordtype">float</span> *dsdy, <span class="keywordtype">float</span> *dtdy)<span class="keyword"> const </span>{
00129         <a class="code" href="classVector.html">Vector</a> vec = dg.<a class="code" href="structDifferentialGeometry.html#o0">p</a> - <a class="code" href="classPoint.html">Point</a>(0,0,0);
00130         *s = <a class="code" href="classPlanarMapping2D.html#r2">ds</a> + <a class="code" href="geometry_8h.html#a17">Dot</a>(vec, <a class="code" href="classPlanarMapping2D.html#r0">vs</a>);
00131         *t = <a class="code" href="classPlanarMapping2D.html#r3">dt</a> + <a class="code" href="geometry_8h.html#a17">Dot</a>(vec, <a class="code" href="classPlanarMapping2D.html#r1">vt</a>);
00132         *dsdx = <a class="code" href="geometry_8h.html#a17">Dot</a>(dg.<a class="code" href="structDifferentialGeometry.html#o9">dpdx</a>, <a class="code" href="classPlanarMapping2D.html#r0">vs</a>);
00133         *dtdx = <a class="code" href="geometry_8h.html#a17">Dot</a>(dg.<a class="code" href="structDifferentialGeometry.html#o9">dpdx</a>, <a class="code" href="classPlanarMapping2D.html#r1">vt</a>);
00134         *dsdy = <a class="code" href="geometry_8h.html#a17">Dot</a>(dg.<a class="code" href="structDifferentialGeometry.html#o10">dpdy</a>, <a class="code" href="classPlanarMapping2D.html#r0">vs</a>);
00135         *dtdy = <a class="code" href="geometry_8h.html#a17">Dot</a>(dg.<a class="code" href="structDifferentialGeometry.html#o10">dpdy</a>, <a class="code" href="classPlanarMapping2D.html#r1">vt</a>);
00136 }
<a name="l00137"></a><a class="code" href="classIdentityMapping3D.html#a1">00137</a> <a class="code" href="classPoint.html">Point</a> <a class="code" href="classIdentityMapping3D.html#a1">IdentityMapping3D::Map</a>(<span class="keyword">const</span> <a class="code" href="structDifferentialGeometry.html">DifferentialGeometry</a> &amp;dg,
00138                 <a class="code" href="classVector.html">Vector</a> *dpdx, <a class="code" href="classVector.html">Vector</a> *dpdy)<span class="keyword"> const </span>{
00139         *dpdx = <a class="code" href="classIdentityMapping3D.html#r0">WorldToTexture</a>(dg.<a class="code" href="structDifferentialGeometry.html#o9">dpdx</a>);
00140         *dpdy = WorldToTexture(dg.<a class="code" href="structDifferentialGeometry.html#o10">dpdy</a>);
00141         <span class="keywordflow">return</span> WorldToTexture(dg.<a class="code" href="structDifferentialGeometry.html#o0">p</a>);
00142 }
<a name="l00143"></a><a class="code" href="texture_8cpp.html#a4">00143</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">float</span> <a class="code" href="texture_8cpp.html#a5">Noise</a>(<span class="keywordtype">float</span> x, <span class="keywordtype">float</span> y, <span class="keywordtype">float</span> z) {
00144         <span class="comment">// Compute noise cell coordinates and offsets</span>
00145         <span class="keywordtype">int</span> ix = <a class="code" href="pbrt_8h.html#a106">Floor2Int</a>(x);
00146         <span class="keywordtype">int</span> iy = <a class="code" href="pbrt_8h.html#a106">Floor2Int</a>(y);
00147         <span class="keywordtype">int</span> iz = <a class="code" href="pbrt_8h.html#a106">Floor2Int</a>(z);
00148         <span class="keywordtype">float</span> dx = x - ix, dy = y - iy, dz = z - iz;
00149         <span class="comment">// Compute gradient weights</span>
00150         ix &amp;= (<a class="code" href="texture_8cpp.html#a0">NOISE_PERM_SIZE</a>-1);
00151         iy &amp;= (<a class="code" href="texture_8cpp.html#a0">NOISE_PERM_SIZE</a>-1);
00152         iz &amp;= (<a class="code" href="texture_8cpp.html#a0">NOISE_PERM_SIZE</a>-1);
00153         <span class="keywordtype">float</span> w000 = <a class="code" href="texture_8cpp.html#a2">Grad</a>(ix,   iy,   iz,   dx,   dy,   dz);
00154         <span class="keywordtype">float</span> w100 = <a class="code" href="texture_8cpp.html#a2">Grad</a>(ix+1, iy,   iz,   dx-1, dy,   dz);
00155         <span class="keywordtype">float</span> w010 = <a class="code" href="texture_8cpp.html#a2">Grad</a>(ix,   iy+1, iz,   dx,   dy-1, dz);
00156         <span class="keywordtype">float</span> w110 = <a class="code" href="texture_8cpp.html#a2">Grad</a>(ix+1, iy+1, iz,   dx-1, dy-1, dz);
00157         <span class="keywordtype">float</span> w001 = <a class="code" href="texture_8cpp.html#a2">Grad</a>(ix,   iy,   iz+1, dx,   dy,   dz-1);
00158         <span class="keywordtype">float</span> w101 = <a class="code" href="texture_8cpp.html#a2">Grad</a>(ix+1, iy,   iz+1, dx-1, dy,   dz-1);
00159         <span class="keywordtype">float</span> w011 = <a class="code" href="texture_8cpp.html#a2">Grad</a>(ix,   iy+1, iz+1, dx,   dy-1, dz-1);
00160         <span class="keywordtype">float</span> w111 = <a class="code" href="texture_8cpp.html#a2">Grad</a>(ix+1, iy+1, iz+1, dx-1, dy-1, dz-1);
00161         <span class="comment">// Compute trilinear interpolation of weights</span>
00162         <span class="keywordtype">float</span> wx = <a class="code" href="texture_8cpp.html#a3">NoiseWeight</a>(dx);
00163         <span class="keywordtype">float</span> wy = <a class="code" href="texture_8cpp.html#a3">NoiseWeight</a>(dy);
00164         <span class="keywordtype">float</span> wz = <a class="code" href="texture_8cpp.html#a3">NoiseWeight</a>(dz);
00165         <span class="keywordtype">float</span> x00 = <a class="code" href="pbrt_8h.html#a94">Lerp</a>(wx, w000, w100);
00166         <span class="keywordtype">float</span> x10 = <a class="code" href="pbrt_8h.html#a94">Lerp</a>(wx, w010, w110);
00167         <span class="keywordtype">float</span> x01 = <a class="code" href="pbrt_8h.html#a94">Lerp</a>(wx, w001, w101);
00168         <span class="keywordtype">float</span> x11 = <a class="code" href="pbrt_8h.html#a94">Lerp</a>(wx, w011, w111);
00169         <span class="keywordtype">float</span> y0 = <a class="code" href="pbrt_8h.html#a94">Lerp</a>(wy, x00, x10);
00170         <span class="keywordtype">float</span> y1 = <a class="code" href="pbrt_8h.html#a94">Lerp</a>(wy, x01, x11);
00171         <span class="keywordflow">return</span> <a class="code" href="pbrt_8h.html#a94">Lerp</a>(wz, y0, y1);
00172 }
<a name="l00173"></a><a class="code" href="texture_8cpp.html#a5">00173</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">float</span> <a class="code" href="texture_8cpp.html#a5">Noise</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point</a> &amp;P) {
00174         <span class="keywordflow">return</span> <a class="code" href="texture_8cpp.html#a5">Noise</a>(P.<a class="code" href="classPoint.html#o0">x</a>, P.<a class="code" href="classPoint.html#o1">y</a>, P.<a class="code" href="classPoint.html#o2">z</a>);
00175 }
<a name="l00176"></a><a class="code" href="texture_8cpp.html#a2">00176</a> <span class="keyword">inline</span> <span class="keywordtype">float</span> <a class="code" href="texture_8cpp.html#a2">Grad</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">int</span> z, <span class="keywordtype">float</span> dx,
00177                 <span class="keywordtype">float</span> dy, <span class="keywordtype">float</span> dz) {
00178         <span class="keywordtype">int</span> h = <a class="code" href="texture_8cpp.html#a1">NoisePerm</a>[<a class="code" href="texture_8cpp.html#a1">NoisePerm</a>[<a class="code" href="texture_8cpp.html#a1">NoisePerm</a>[x]+y]+z];
00179         h &amp;= 15;
00180         <span class="keywordtype">float</span> u = h&lt;8 || h==12 || h==13 ? dx : dy;
00181         <span class="keywordtype">float</span> v = h&lt;4 || h==12 || h==13 ? dy : dz;
00182         <span class="keywordflow">return</span> ((h&amp;1) ? -u : u) + ((h&amp;2) ? -v : v);
00183 }
<a name="l00184"></a><a class="code" href="texture_8cpp.html#a3">00184</a> <span class="keyword">inline</span> <span class="keywordtype">float</span> <a class="code" href="texture_8cpp.html#a3">NoiseWeight</a>(<span class="keywordtype">float</span> t) {
00185         <span class="keywordtype">float</span> t3 = t*t*t;
00186         <span class="keywordtype">float</span> t4 = t3*t;
00187         <span class="keywordflow">return</span> 6.f*t4*t - 15.f*t4 + 10.f*t3;
00188 }
<a name="l00189"></a><a class="code" href="texture_8cpp.html#a6">00189</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">float</span> <a class="code" href="texture_8cpp.html#a6">FBm</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point</a> &amp;P, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a> &amp;dpdx,
00190                 <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a> &amp;dpdy, <span class="keywordtype">float</span> omega, <span class="keywordtype">int</span> maxOctaves) {
00191         <span class="comment">// Compute number of octaves for anti-aliased FBm</span>
00192         <span class="keywordtype">float</span> s2 = max(dpdx.<a class="code" href="classVector.html#a14">LengthSquared</a>(), dpdy.<a class="code" href="classVector.html#a14">LengthSquared</a>());
00193         <span class="keywordtype">float</span> foctaves = min((<span class="keywordtype">float</span>)maxOctaves,
00194                              1.f - .5f * <a class="code" href="pbrt_8h.html#a100">Log2</a>(s2));
00195         <span class="keywordtype">int</span> octaves = <a class="code" href="pbrt_8h.html#a106">Floor2Int</a>(foctaves);
00196         <span class="comment">// Compute sum of octaves of noise for FBm</span>
00197         <span class="keywordtype">float</span> sum = 0., lambda = 1., o = 1.;
00198         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; octaves; ++i) {
00199                 sum += o * <a class="code" href="texture_8cpp.html#a5">Noise</a>(lambda * P);
00200                 lambda *= 1.99f;
00201                 o *= omega;
00202         }
00203         <span class="keywordtype">float</span> partialOctave = foctaves - octaves;
00204         sum += o * <a class="code" href="pbrt_8h.html#a111">SmoothStep</a>(.3f, .7f, partialOctave) *
00205                <a class="code" href="texture_8cpp.html#a5">Noise</a>(lambda * P);
00206         <span class="keywordflow">return</span> sum;
00207 }
<a name="l00208"></a><a class="code" href="texture_8cpp.html#a7">00208</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">float</span> <a class="code" href="texture_8cpp.html#a7">Turbulence</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point</a> &amp;P, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a> &amp;dpdx,
00209                 <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a> &amp;dpdy, <span class="keywordtype">float</span> omega, <span class="keywordtype">int</span> maxOctaves) {
00210         <span class="comment">// Compute number of octaves for anti-aliased FBm</span>
00211         <span class="keywordtype">float</span> s2 = max(dpdx.<a class="code" href="classVector.html#a14">LengthSquared</a>(), dpdy.<a class="code" href="classVector.html#a14">LengthSquared</a>());
00212         <span class="keywordtype">float</span> foctaves = min((<span class="keywordtype">float</span>)maxOctaves,
00213                              1.f - .5f * <a class="code" href="pbrt_8h.html#a100">Log2</a>(s2));
00214         <span class="keywordtype">int</span> octaves = <a class="code" href="pbrt_8h.html#a106">Floor2Int</a>(foctaves);
00215         <span class="comment">// Compute sum of octaves of noise for turbulence</span>
00216         <span class="keywordtype">float</span> sum = 0., lambda = 1., o = 1.;
00217         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; octaves; ++i) {
00218                 sum += o * fabsf(<a class="code" href="texture_8cpp.html#a5">Noise</a>(lambda * P));
00219                 lambda *= 1.99f;
00220                 o *= omega;
00221         }
00222         <span class="keywordtype">float</span> partialOctave = foctaves - octaves;
00223         sum += o * <a class="code" href="pbrt_8h.html#a111">SmoothStep</a>(.3f, .7f, partialOctave) *
00224                fabsf(<a class="code" href="texture_8cpp.html#a5">Noise</a>(lambda * P));
00225         <span class="keywordflow">return</span> sum;
00226 }
00227 <span class="comment">// Texture Function Definitions</span>
<a name="l00228"></a><a class="code" href="texture_8cpp.html#a8">00228</a> <a class="code" href="pbrt_8h.html#a1">COREDLL</a> <span class="keywordtype">float</span> <a class="code" href="texture_8cpp.html#a8">Lanczos</a>(<span class="keywordtype">float</span> x, <span class="keywordtype">float</span> tau) {
00229         x = fabsf(x);
00230         <span class="keywordflow">if</span> (x &lt; 1e-5) <span class="keywordflow">return</span> 1;
00231         <span class="keywordflow">if</span> (x &gt; 1.)    <span class="keywordflow">return</span> 0;
00232         x *= <a class="code" href="pbrt_8h.html#a6">M_PI</a>;
00233         <span class="keywordtype">float</span> s = sinf(x * tau) / (x * tau);
00234         <span class="keywordtype">float</span> lanczos = sinf(x) / x;
00235         <span class="keywordflow">return</span> s * lanczos;
00236 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Mon Apr 25 19:00:25 2005 for pbrt by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
