<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>pbrt: transform.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>transform.h</h1><a href="transform_8h.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 
00002 <span class="comment">/*</span>
00003 <span class="comment"> * pbrt source code Copyright(c) 1998-2005 Matt Pharr and Greg Humphreys</span>
00004 <span class="comment"> *</span>
00005 <span class="comment"> * All Rights Reserved.</span>
00006 <span class="comment"> * For educational use only; commercial use expressly forbidden.</span>
00007 <span class="comment"> * NO WARRANTY, express or implied, for this software.</span>
00008 <span class="comment"> * (See file License.txt for complete license)</span>
00009 <span class="comment"> */</span>
00010 
00011 <span class="preprocessor">#ifndef PBRT_TRANSFORM_H</span>
00012 <span class="preprocessor"></span><span class="preprocessor">#define PBRT_TRANSFORM_H</span>
00013 <span class="preprocessor"></span><span class="comment">// transform.h*</span>
00014 <span class="preprocessor">#include "<a class="code" href="pbrt_8h.html">pbrt.h</a>"</span>
00015 <span class="preprocessor">#include "<a class="code" href="geometry_8h.html">geometry.h</a>"</span>
00016 <span class="comment">// Transform Declarations</span>
<a name="l00017"></a><a class="code" href="classTransform.html">00017</a> <span class="keyword">class </span><a class="code" href="pbrt_8h.html#a1">COREDLL</a> Transform {
00018 <span class="keyword">public</span>:
00019         <span class="comment">// Transform Public Methods</span>
<a name="l00020"></a><a class="code" href="classTransform.html#a0">00020</a>         Transform() {
00021                 m = mInv = <span class="keyword">new</span> <a class="code" href="structMatrix4x4.html">Matrix4x4</a>;
00022         }
<a name="l00023"></a><a class="code" href="classTransform.html#a1">00023</a>         Transform(<span class="keywordtype">float</span> mat[4][4]) {
00024                 m=<span class="keyword">new</span> <a class="code" href="structMatrix4x4.html">Matrix4x4</a>(mat[0][0],mat[0][1],mat[0][2],mat[0][3],
00025                                 mat[1][0],mat[1][1],mat[1][2],mat[1][3],
00026                                 mat[2][0],mat[2][1],mat[2][2],mat[2][3],
00027                                 mat[3][0],mat[3][1],mat[3][2],mat[3][3]);
00028                 mInv = m-&gt;Inverse();
00029         }
<a name="l00030"></a><a class="code" href="classTransform.html#a2">00030</a>         Transform(<span class="keyword">const</span> <a class="code" href="classReference.html">Reference&lt;Matrix4x4&gt;</a> &amp;mat) {
00031                 m = mat;
00032                 mInv = m-&gt;Inverse();
00033         }
<a name="l00034"></a><a class="code" href="classTransform.html#a3">00034</a>         Transform(<span class="keyword">const</span> <a class="code" href="classReference.html">Reference&lt;Matrix4x4&gt;</a> &amp;mat,
00035                   <span class="keyword">const</span> <a class="code" href="classReference.html">Reference&lt;Matrix4x4&gt;</a> &amp;minv) {
00036                 m = mat;
00037                 mInv = minv;
00038         }
00039         <span class="keyword">friend</span> ostream &amp;<a class="code" href="transform_8cpp.html#a0">operator&lt;&lt;</a>(ostream &amp;, <span class="keyword">const</span> Transform &amp;);
<a name="l00040"></a><a class="code" href="classTransform.html#a4">00040</a>         Transform GetInverse()<span class="keyword"> const </span>{
00041                 <span class="keywordflow">return</span> Transform(mInv, m);
00042         }
00043         <span class="keywordtype">bool</span> HasScale() const;
00044         inline <a class="code" href="classPoint.html">Point</a> operator()(const <a class="code" href="classPoint.html">Point</a> &amp;pt) const;
00045         inline <span class="keywordtype">void</span> operator()(const <a class="code" href="classPoint.html">Point</a> &amp;pt,<a class="code" href="classPoint.html">Point</a> *ptrans) const;
00046         inline <a class="code" href="classVector.html">Vector</a> operator()(const <a class="code" href="classVector.html">Vector</a> &amp;v) const;
00047         inline <span class="keywordtype">void</span> operator()(const <a class="code" href="classVector.html">Vector</a> &amp;v, <a class="code" href="classVector.html">Vector</a> *vt) const;
00048         inline <a class="code" href="classNormal.html">Normal</a> operator()(const <a class="code" href="classNormal.html">Normal</a> &amp;) const;
00049         inline <span class="keywordtype">void</span> operator()(const <a class="code" href="classNormal.html">Normal</a> &amp;, Normal *nt) const;
00050         inline <a class="code" href="classRay.html">Ray</a> operator()(const <a class="code" href="classRay.html">Ray</a> &amp;r) const;
00051         inline <span class="keywordtype">void</span> operator()(const <a class="code" href="classRay.html">Ray</a> &amp;r, <a class="code" href="classRay.html">Ray</a> *rt) const;
00052         <a class="code" href="classBBox.html">BBox</a> operator()(const <a class="code" href="classBBox.html">BBox</a> &amp;b) const;
00053         Transform operator*(const Transform &amp;t2) const;
00054         <span class="keywordtype">bool</span> SwapsHandedness() const;
00055 private:
00056         <span class="comment">// Transform Private Data</span>
<a name="l00057"></a><a class="code" href="classTransform.html#r1">00057</a>         <a class="code" href="classReference.html">Reference</a>&lt;<a class="code" href="structMatrix4x4.html">Matrix4x4</a>&gt; m, mInv;
00058 };
00059 <span class="comment">// Transform Inline Functions</span>
<a name="l00060"></a><a class="code" href="classTransform.html#a6">00060</a> inline <a class="code" href="classPoint.html">Point</a> Transform::operator()(const <a class="code" href="classPoint.html">Point</a> &amp;pt)<span class="keyword"> const </span>{
00061         <span class="keywordtype">float</span> x = pt.x, y = pt.y, z = pt.z;
00062         <span class="keywordtype">float</span> xp = m-&gt;m[0][0]*x + m-&gt;m[0][1]*y + m-&gt;m[0][2]*z + m-&gt;m[0][3];
00063         <span class="keywordtype">float</span> yp = m-&gt;m[1][0]*x + m-&gt;m[1][1]*y + m-&gt;m[1][2]*z + m-&gt;m[1][3];
00064         <span class="keywordtype">float</span> zp = m-&gt;m[2][0]*x + m-&gt;m[2][1]*y + m-&gt;m[2][2]*z + m-&gt;m[2][3];
00065         <span class="keywordtype">float</span> wp = m-&gt;m[3][0]*x + m-&gt;m[3][1]*y + m-&gt;m[3][2]*z + m-&gt;m[3][3];
00066 
00067         <a class="code" href="pbrt_8h.html#a14">Assert</a>(wp != 0);
00068         <span class="keywordflow">if</span> (wp == 1.) <span class="keywordflow">return</span> <a class="code" href="classPoint.html">Point</a>(xp, yp, zp);
00069         <span class="keywordflow">else</span>          <span class="keywordflow">return</span> <a class="code" href="classPoint.html">Point</a>(xp, yp, zp)/wp;
00070 }
<a name="l00071"></a><a class="code" href="classTransform.html#a7">00071</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classTransform.html#a6">Transform::operator()</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point</a> &amp;pt,
00072                 <a class="code" href="classPoint.html">Point</a> *ptrans)<span class="keyword"> const </span>{
00073         <span class="keywordtype">float</span> x = pt.<a class="code" href="classPoint.html#o0">x</a>, y = pt.<a class="code" href="classPoint.html#o1">y</a>, z = pt.<a class="code" href="classPoint.html#o2">z</a>;
00074         ptrans-&gt;<a class="code" href="classPoint.html#o0">x</a> = <a class="code" href="classTransform.html#r0">m</a>-&gt;m[0][0]*x + <a class="code" href="classTransform.html#r0">m</a>-&gt;m[0][1]*y + <a class="code" href="classTransform.html#r0">m</a>-&gt;m[0][2]*z + <a class="code" href="classTransform.html#r0">m</a>-&gt;m[0][3];
00075         ptrans-&gt;<a class="code" href="classPoint.html#o1">y</a> = <a class="code" href="classTransform.html#r0">m</a>-&gt;m[1][0]*x + <a class="code" href="classTransform.html#r0">m</a>-&gt;m[1][1]*y + <a class="code" href="classTransform.html#r0">m</a>-&gt;m[1][2]*z + <a class="code" href="classTransform.html#r0">m</a>-&gt;m[1][3];
00076         ptrans-&gt;<a class="code" href="classPoint.html#o2">z</a> = <a class="code" href="classTransform.html#r0">m</a>-&gt;m[2][0]*x + <a class="code" href="classTransform.html#r0">m</a>-&gt;m[2][1]*y + <a class="code" href="classTransform.html#r0">m</a>-&gt;m[2][2]*z + <a class="code" href="classTransform.html#r0">m</a>-&gt;m[2][3];
00077         <span class="keywordtype">float</span> w   = <a class="code" href="classTransform.html#r0">m</a>-&gt;m[3][0]*x + <a class="code" href="classTransform.html#r0">m</a>-&gt;m[3][1]*y + <a class="code" href="classTransform.html#r0">m</a>-&gt;m[3][2]*z + <a class="code" href="classTransform.html#r0">m</a>-&gt;m[3][3];
00078         <span class="keywordflow">if</span> (w != 1.) *ptrans /= w;
00079 }
<a name="l00080"></a><a class="code" href="classTransform.html#a8">00080</a> <span class="keyword">inline</span> <a class="code" href="classVector.html">Vector</a> <a class="code" href="classTransform.html#a6">Transform::operator()</a>(<span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a> &amp;v)<span class="keyword"> const </span>{
00081   <span class="keywordtype">float</span> x = v.<a class="code" href="classVector.html#o0">x</a>, y = v.<a class="code" href="classVector.html#o1">y</a>, z = v.<a class="code" href="classVector.html#o2">z</a>;
00082   <span class="keywordflow">return</span> <a class="code" href="classVector.html">Vector</a>(<a class="code" href="classTransform.html#r0">m</a>-&gt;m[0][0]*x + <a class="code" href="classTransform.html#r0">m</a>-&gt;m[0][1]*y + <a class="code" href="classTransform.html#r0">m</a>-&gt;m[0][2]*z,
00083                             <a class="code" href="classTransform.html#r0">m</a>-&gt;m[1][0]*x + <a class="code" href="classTransform.html#r0">m</a>-&gt;m[1][1]*y + <a class="code" href="classTransform.html#r0">m</a>-&gt;m[1][2]*z,
00084                             <a class="code" href="classTransform.html#r0">m</a>-&gt;m[2][0]*x + <a class="code" href="classTransform.html#r0">m</a>-&gt;m[2][1]*y + <a class="code" href="classTransform.html#r0">m</a>-&gt;m[2][2]*z);
00085 }
<a name="l00086"></a><a class="code" href="classTransform.html#a9">00086</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classTransform.html#a6">Transform::operator()</a>(<span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a> &amp;v,
00087                 <a class="code" href="classVector.html">Vector</a> *vt)<span class="keyword"> const </span>{
00088   <span class="keywordtype">float</span> x = v.<a class="code" href="classVector.html#o0">x</a>, y = v.<a class="code" href="classVector.html#o1">y</a>, z = v.<a class="code" href="classVector.html#o2">z</a>;
00089   vt-&gt;<a class="code" href="classVector.html#o0">x</a> = <a class="code" href="classTransform.html#r0">m</a>-&gt;m[0][0] * x + <a class="code" href="classTransform.html#r0">m</a>-&gt;m[0][1] * y + <a class="code" href="classTransform.html#r0">m</a>-&gt;m[0][2] * z;
00090   vt-&gt;<a class="code" href="classVector.html#o1">y</a> = <a class="code" href="classTransform.html#r0">m</a>-&gt;m[1][0] * x + <a class="code" href="classTransform.html#r0">m</a>-&gt;m[1][1] * y + <a class="code" href="classTransform.html#r0">m</a>-&gt;m[1][2] * z;
00091   vt-&gt;<a class="code" href="classVector.html#o2">z</a> = <a class="code" href="classTransform.html#r0">m</a>-&gt;m[2][0] * x + <a class="code" href="classTransform.html#r0">m</a>-&gt;m[2][1] * y + <a class="code" href="classTransform.html#r0">m</a>-&gt;m[2][2] * z;
00092 }
<a name="l00093"></a><a class="code" href="classTransform.html#a10">00093</a> <span class="keyword">inline</span> <a class="code" href="classNormal.html">Normal</a> <a class="code" href="classTransform.html#a6">Transform::operator()</a>(<span class="keyword">const</span> <a class="code" href="classNormal.html">Normal</a> &amp;n)<span class="keyword"> const </span>{
00094         <span class="keywordtype">float</span> x = n.<a class="code" href="classNormal.html#o0">x</a>, y = n.<a class="code" href="classNormal.html#o1">y</a>, z = n.<a class="code" href="classNormal.html#o2">z</a>;
00095         <span class="keywordflow">return</span> <a class="code" href="classNormal.html">Normal</a>(<a class="code" href="classTransform.html#r1">mInv</a>-&gt;m[0][0]*x + <a class="code" href="classTransform.html#r1">mInv</a>-&gt;m[1][0]*y + <a class="code" href="classTransform.html#r1">mInv</a>-&gt;m[2][0]*z,
00096                   <a class="code" href="classTransform.html#r1">mInv</a>-&gt;m[0][1]*x + <a class="code" href="classTransform.html#r1">mInv</a>-&gt;m[1][1]*y + <a class="code" href="classTransform.html#r1">mInv</a>-&gt;m[2][1]*z,
00097                   <a class="code" href="classTransform.html#r1">mInv</a>-&gt;m[0][2]*x + <a class="code" href="classTransform.html#r1">mInv</a>-&gt;m[1][2]*y + <a class="code" href="classTransform.html#r1">mInv</a>-&gt;m[2][2]*z);
00098 }
<a name="l00099"></a><a class="code" href="classTransform.html#a11">00099</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classTransform.html#a6">Transform::operator()</a>(<span class="keyword">const</span> <a class="code" href="classNormal.html">Normal</a> &amp;n,
00100                 <a class="code" href="classNormal.html">Normal</a> *nt)<span class="keyword"> const </span>{
00101         <span class="keywordtype">float</span> x = n.<a class="code" href="classNormal.html#o0">x</a>, y = n.<a class="code" href="classNormal.html#o1">y</a>, z = n.<a class="code" href="classNormal.html#o2">z</a>;
00102         nt-&gt;<a class="code" href="classNormal.html#o0">x</a> = <a class="code" href="classTransform.html#r1">mInv</a>-&gt;m[0][0]*x + <a class="code" href="classTransform.html#r1">mInv</a>-&gt;m[1][0]*y + <a class="code" href="classTransform.html#r1">mInv</a>-&gt;m[2][0]*z;
00103         nt-&gt;<a class="code" href="classNormal.html#o1">y</a> = <a class="code" href="classTransform.html#r1">mInv</a>-&gt;m[0][1]*x + <a class="code" href="classTransform.html#r1">mInv</a>-&gt;m[1][1]*y + <a class="code" href="classTransform.html#r1">mInv</a>-&gt;m[2][1]*z;
00104         nt-&gt;<a class="code" href="classNormal.html#o2">z</a> = <a class="code" href="classTransform.html#r1">mInv</a>-&gt;m[0][2]*x + <a class="code" href="classTransform.html#r1">mInv</a>-&gt;m[1][2]*y + <a class="code" href="classTransform.html#r1">mInv</a>-&gt;m[2][2]*z;
00105 }
<a name="l00106"></a><a class="code" href="classTransform.html#a12">00106</a> <span class="keyword">inline</span> <a class="code" href="classRay.html">Ray</a> <a class="code" href="classTransform.html#a6">Transform::operator()</a>(<span class="keyword">const</span> <a class="code" href="classRay.html">Ray</a> &amp;r)<span class="keyword"> const </span>{
00107         <a class="code" href="classRay.html">Ray</a> ret;
00108         (*this)(r.<a class="code" href="classRay.html#o0">o</a>, &amp;ret.<a class="code" href="classRay.html#o0">o</a>);
00109         (*this)(r.<a class="code" href="classRay.html#o1">d</a>, &amp;ret.<a class="code" href="classRay.html#o1">d</a>);
00110         ret.<a class="code" href="classRay.html#o2">mint</a> = r.<a class="code" href="classRay.html#o2">mint</a>;
00111         ret.<a class="code" href="classRay.html#o3">maxt</a> = r.<a class="code" href="classRay.html#o3">maxt</a>;
00112         ret.<a class="code" href="classRay.html#o4">time</a> = r.<a class="code" href="classRay.html#o4">time</a>;
00113         <span class="keywordflow">return</span> ret;
00114 }
<a name="l00115"></a><a class="code" href="classTransform.html#a13">00115</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classTransform.html#a6">Transform::operator()</a>(<span class="keyword">const</span> <a class="code" href="classRay.html">Ray</a> &amp;r,
00116                                   <a class="code" href="classRay.html">Ray</a> *rt)<span class="keyword"> const </span>{
00117         (*this)(r.<a class="code" href="classRay.html#o0">o</a>, &amp;rt-&gt;<a class="code" href="classRay.html#o0">o</a>);
00118         (*this)(r.<a class="code" href="classRay.html#o1">d</a>, &amp;rt-&gt;<a class="code" href="classRay.html#o1">d</a>);
00119         rt-&gt;<a class="code" href="classRay.html#o2">mint</a> = r.<a class="code" href="classRay.html#o2">mint</a>;
00120         rt-&gt;<a class="code" href="classRay.html#o3">maxt</a> = r.<a class="code" href="classRay.html#o3">maxt</a>;
00121         rt-&gt;<a class="code" href="classRay.html#o4">time</a> = r.<a class="code" href="classRay.html#o4">time</a>;
00122 }
00123 <span class="preprocessor">#endif // PBRT_TRANSFORM_H</span>
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Mon Apr 25 19:00:25 2005 for pbrt by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
